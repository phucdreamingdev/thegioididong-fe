function empty(n){var t;if(n===""||n===null||n===!1||n===undefined||n==="undefined"||n==="Khách hàng"||n==="null")return!0;if(typeof n=="object"){for(t in n)if(typeof n[t]!="function")return!1;return!0}return!1}function checkempty(n){return n===""||n===null||n===!1||n===undefined||n==="undefined"||n==="null"?"":n}function textAreaAdjust(){}function h(n){var t=$("#chatclient .chatinputarea").height();t<79&&($(n).css({height:"auto","overflow-y":"scroll"}).height(n.scrollHeight),resizeChatCode())}function getGender(n){if(n){if(n==1)return"Anh ";if(n==2)return"Chị "}return"Bạn"}function deletecookiechat(){chatSetCookie("chat.username","",-1,"www."+sitedomain);chatSetCookie("chat.username","",-1,"."+sitedomain);chatSetCookie("chat.username","",-1,"rtm."+sitedomain);chatSetCookie(cookie_info,"",365,"."+sitedomain);chatSetCookie("chat.username","",365,"."+sitedomain)}function getExtcdnfilename(n){return CHAT_TESTTYPE==1||CHAT_TESTTYPE==2?""+n+"?v="+CHAT_CDNV:"."+CHAT_CDNV+""+n}function showchatpagecmt(n){if($("#chatclientcmt .pages .page").hide(),$("#chatclientcmt .pages .page"+n).show(),$("#chatclientcmt .navbar").show(),$("#chatclientcmt .pages").show(),n=="chat"&&($("#notifychatmsg").hide(),$("#chatclientcmt .operator-info").show(),$("#chatclientcmt .messages").show(),$("#chatclientcmt .chatinput").show(),$messagescmt.show(),$("#chatclientcmt .chatinputarea").show(),$("#chatclientcmt .chatfunctionscontrainer").show(),$("#chatclientcmt .titlechat .c").show(),$("#chatclientcmt .operator-info").show(),addChatInfoMessageCMT(),getMessageComment(),$inputMessagecmt.focus()),n=="collect",n=="close"){var t='<div class="continuechat"  onclick="continueChatCMT()">&lt; Quay lại chat<\/div><div class="operator-info-endchat"><p  class="endchatmsg">Mời '+getGender(gender)+' đánh giá chất lượng tư vấn hỗ trợ<\/p> <div  id="divchatrating"><div><p  ><textarea rows="4" cols="50" class="moreinfo" id="chat_moremsg" style="display:none" placeholder="Nhận xét về việc tư vấn (không bắt buộc)"><\/textarea> <input type="button" class="btn btn-sm btn-warning btnstopbad" value="Không hài lòng" onclick="rateBadCMT()" /> <input type="button" class="btn btn-primary btnstopgood" value="Hài lòng" onclick="rateGoodCMT()" /> <\/p> <p>hoặc<\/p><span onclick="rateIngoreCMT()" class="rateingrelink">Đóng chat ngay<\/span> <\/div>';t=t.replace("{ad_name}",theOpposite);t=t.replace("{ad_avatar}",ad_avatar);$("#chatclientcmt #chatcloseconfirm").html(t)}}function showchatpage(n){if($("#chatclient .pages .page").hide(),$("#chatclient .pages .page"+n).show(),$("#chatclient .navbar").show(),$("#chatclient .pages").show(),n=="chat"&&($("#notifychatmsg").hide(),$("#chatclient .operator-info").show(),$("#chatclient .messages").show(),$("#chatclient  .chatinput").show(),$messages.show(),$("#chatclient .chatinputarea").show(),$("#chatclient .chatfunctionscontrainer").show(),$("#chatclient .titlechat .c").show(),$("#chatclient .operator-info").show(),addChatInfoMessage(),getMessageComment()),n=="collect"&&(LoadUserInfo(),$("#chatclient #collectdata").show(),$("#txtchat_fullname").val(Customername),$("#txtchat_phone").val(phone),$("#txtchat_email").val(email),$("#txtchat_gender").val(gender),$("#chatclient #collectdata").show()),n=="close"){var t='<div class="continuechat"  onclick="continueChat()">&lt; Quay lại chat<\/div><div class="operator-info-endchat"><p  class="endchatmsg">Mời '+CHAT_DANHXUNG+' đánh giá chất lượng tư vấn hỗ trợ<\/p><div class="avatarto"><img src="{ad_avatar}"/><\/div><span>{ad_name}<\/span><div  id="divchatrating"><div><p  ><textarea rows="4" cols="50" class="moreinfo" id="chat_moremsg" style="display:none" placeholder="Nhận xét về việc tư vấn (không bắt buộc)"><\/textarea> <input type="button" class="btn btn-sm btn-warning btnstopbad" value="Không hài lòng" onclick="rateBad()" /> <input type="button" class="btn btn-primary btnstopgood" value="Hài lòng" onclick="rateGood()" /> <\/p> <p>hoặc<\/p><span onclick="rateIngore()" class="rateingrelink">Đóng chat ngay<\/span> <\/div>';t=t.replace("{ad_name}",theOpposite);t=t.replace("{ad_avatar}",ad_avatar);$("#chatclient #chatcloseconfirm").html(t)}}function enablechat(n){n==1?($inputMessage.removeAttr("disabled"),$inputMessagecmt.removeAttr("disabled"),$inputMessage.attr("placeholder","Nhập nội dung "+CHAT_DANHXUNG+" muốn gửi và nhấn Gửi"),$inputMessagecmt.attr("placeholder","Nhập nội dung "+CHAT_DANHXUNG+" muốn gửi và nhấn Gửi")):($inputMessage.attr("disabled","disabled"),$inputMessagecmt.attr("disabled","disabled"),$inputMessage.attr("placeholder","Kết nối bị gián đoạn, vui lòng đợi trong giây lát hoặc tải lại trang"),$inputMessagecmt.attr("placeholder","Kết nối bị gián đoạn, vui lòng đợi trong giây lát hoặc tải lại trang"))}function shochatwmsg(n,t){n==1?($("#chatclient .chatwait").show(),$("#chatclient .chatwait").html(t),$("#chatclientcmt .chatwait").show(),$("#chatclientcmt .chatwait").html(t)):($("#chatclient .chatwait").hide(),$("#chatclient .chatwait").html(""),$("#chatclientcmt .chatwait").hide(),$("#chatclientcmt .chatwait").html(""));resizeChatCode();resizeChatCodeCMT(CHAT_TOP,CHAT_LEFT,CHAT_WIDTH)}function reseth(){$("#chatclient .chatinputarea").height(50);$("#chatclient .chatinputarea .chatinput ").height(36);resizeChatCode();$("#chatclient .chatinputarea").css({height:"auto"})}function numbersOnly(n,t){var i=String.fromCharCode(t.charCode),r=/\./.test(n.value);return t.charCode===0||/\d/.test(i)||/\./.test(i)&&!r}function changeTitlePage(n){document.title=n}function checkvisible(n){return $(n).is(":visible")?!0:!1}function enablechatinput(){enablechat(1)}function CheckIsMobile(){return $(this).width()<=450?!0:!1}function resizeChatCode(){var u=$("#chatclient  navbar "),n=500;$(this).width()<=450?(CHAT_ISMOBILE=1,n=$(this).height()/2):(CHAT_ISMOBILE=0,n=500);u.height(n);var f=$("#chatclient .messages"),o=$("#chatclient #chatwait"),e=$("#chatclient .chatArea"),i=$("#chatclient .chatinputarea").height(),r=40,t=n-i-r-5;checkvisible("#chatclient #chatwait")&&(t=n-i-r-27);$("#chatclient #collectdata").height(n);$("#chatclient .pages").height(n);$("#chatclient .page").height(n);f.height(t);e.height(t);checkvisible("#collectdata")?($("#chatclient  .operator-info .linkimg img").hide(),$("#chatclient  .operator-info .linkimg").css("width","2px")):($("#chatclient  .operator-info .linkimg img").show(),$("#chatclient  .operator-info .linkimg").css("width","36px"));checkvisible("#chatclient  navbar")&&$("#notifychatmsg").hide();CHAT_ISMOBILE==1?(fnMoveChat("#chatclient  .navbar",0,0,0,2),CHAT_SITEID==2?(fnMoveChat("#notifychatmsg",56,2,0,0),fnMoveChat("#chattooltipmsg",56,2,0,0),$("#notifychatmsg  .notifyChat2 ").css("opacity","0.8"),.5):CHAT_SITEID==8?(fnMoveChat("#notifychatmsg",56,2,0,0),fnMoveChat("#chattooltipmsg",56,2,0,0),$("#notifychatmsg  .notifyChat2 ").css("opacity","0.8"),.5):(fnMoveChat("#notifychatmsg",5,2,0,0),fnMoveChat("#chattooltipmsg",5,2,0,0))):(fnMoveChat("#chatclient .navbar",2,0,0,0),fnMoveChat("#notifychatmsg",100,0,2,0),fnMoveChat("#chattooltipmsg",100,0,2,0))}function resizeChatCodeCMT(n,t,i){var s=$("#chatclientcmt  .navbar"),r=500,o;$(this).width()<=450?(CHAT_ISMOBILE=1,r=400):(CHAT_ISMOBILE=0,r=500);s.height(r);i>0&&$("#chatclientcmt  .navbar").width(i);var h=$("#chatclientcmt .messages"),l=$("#chatclientcmt #chatwait"),c=$("#chatclientcmt .chatArea"),f=$("#chatclientcmt .chatinputarea").height(),e=40,u=r-f-e-5;checkvisible("#chatclientcmt #chatwait")&&(u=r-f-e-27);$("#chatclientcmt #collectdata").height(r);$("#chatclientcmt .pages").height(r);$("#chatclientcmt .page").height(r);$("#chatclientcmt .pagechat").height(r);$("#chatclientcmt .pageclose").height(r);$("#chatclientcmt #chatcloseconfirm").height(r);h.height(u);c.height(u);checkvisible("#collectdata")?($("#chatclientcmt  .operator-info .linkimg img").hide(),$("#chatclientcmt  .operator-info .linkimg").css("width","2px")):($("#chatclientcmt  .operator-info .linkimg img").show(),$("#chatclientcmt  .operator-info .linkimg").css("width","36px"));checkvisible("#chatclientcmt  navbar")&&$("#notifychatmsg").hide();CHAT_ISMOBILE==1?(fnMoveChat("#chatclientcmt  .navbar",0,0,0,2),CHAT_SITEID==2?(fnMoveChat("#notifychatmsg",56,2,0,0),fnMoveChat("#chattooltipmsg",56,2,0,0),$("#notifychatmsg  .notifyChat2 ").css("opacity","0.8"),.5):CHAT_SITEID==8?(fnMoveChat("#notifychatmsg",56,2,0,0),fnMoveChat("#chattooltipmsg",56,2,0,0),$("#notifychatmsg  .notifyChat2 ").css("opacity","0.8"),.5):(fnMoveChat("#notifychatmsg",5,2,0,0),fnMoveChat("#chattooltipmsg",5,2,0,0))):(o=$(this).width()/2-350,t>0?fnMoveChat("#chatclientcmt .navbar",n,t,0,20):fnMoveChat("#chatclientcmt .navbar",n,o,0,20))}function resizeChat(){var n=$(window).on("resize",function(){resizeChatCode();$("#notifychatnewmsg").center()}).trigger("resize")}function startTimer(n){function t(){if(runTimmer==1)if(n--,$(".startbutton p").show(),$("#invitetime").html(n),n>0)setTimeout(t,1e3);else{ChatStopAll();$("#notifychatmsg").hide();runTimmer=0;return}}t()}function SetAutoInfo(){ad_avatar=$chatCDN+"/iconchattgdd"+getExtcdnfilename(".png")+"";var n='<ul><li><div href="javascript:void();" class="linkimg"><img src="{ad_avatar}" width="56" class="avatar"/><\/div><\/li><li style="width:148px"><span class="operator-role"  >Chat với Tư Vấn Bán Hàng <span class="operator-name">{ad_name}<\/span><\/span><\/li><li class="last"> <a  href="javascript:void(0)" onclick="minizeChatWindow()"  data-toggle="tooltip" data-placement="bottom" title="Thu gọn"><img src="'+$chatCDN+"/minimize_"+CHAT_SITEID+""+getExtcdnfilename(".png")+'" /><\/a><a class="stopchat"  data-toggle="tooltip" data-placement="bottom" title="Đóng" href="javascript:void(0)" onclick="closeAndStopChat()"><img class="closeAndStopChatimg" src="'+$chatCDN+"/iconstop_"+CHAT_SITEID+""+getExtcdnfilename(".png")+'" /><\/a><\/li><\/ul>';n=n.replace("{name}",""+CHAT_DANHXUNG_HOA+" đang chat với Tư Vấn Bán Hàng ");n=n.replace("{ad_name}","");n=n.replace("{ad_avatar}",ad_avatar);$(".operator-info").html(n);$(".operator-info-min").html('<img src="'+ad_avatar+'" class="avatar"/>');$(".chat .operator-info").css("height","80px;");collecthtml=collecthtml.replace("{ad_name}","");collecthtml=collecthtml.replace("{ad_avatar}",ad_avatar);$("#chatclient #collectdata").html(collecthtml);LoadUserInfo();empty(name)||$("#txtchat_fullname").val(name)}function fnMoveChat_(n,t,i){$(".navbar").css("bottom",n+"px");$("#notifychatmsg").css("bottom",t+"px");$("#chattooltipmsg").css("bottom",i+"px")}function fnMoveChat(n,t,i,r,u){t>0&&($(n).css("bottom",t+"px"),$(n).css("top","auto"));u>0&&($(n).css("bottom","auto"),$(n).css("top",u+"px"));i>0&&($(n).css("right","auto"),$(n).css("left",i+"px"));r>0&&($(n).css("right",r+"px"),$(n).css("left","auto"))}function showChatPanel(){requestChatAuto("")}function fnViewInviteChat(){if(!checkvisible("#chattooltipmsg .operator-info-min")&&(!checkvisible("#notifychatmsg")||!checkvisible("#notifychatmsg .cmtnotifyChat"))){var n=chatGetCookie("chat.ismininvitechat");n&&(ismininvitechat=n);ismininvitechat?checkvisible("#notifychatmsgmin")||($("#notifychatmsg").hide(),$("#notifychatmsgmin").show(),$("#notifychatmsgmin").html(auhtmlinvitechatmini),$("#notifychatmsgmin").focus()):checkvisible("#notifychatmsg")||($("#notifychatmsg").show(),$("#notifychatmsgmin").hide(),$("#notifychatmsg").html(auhtmlinvitechat),$("#notifychatmsg").focus());resizeChatCode()}}function HideInviteChat(){if(AutoShowChat())return!0;chatSetCookie("chat.notifychatmsg","",365,"."+sitedomain);$("#notifychatmsg").hide();$("#notifychatmsgmin").hide();CHAT_SITEID==1;CHAT_SITEID==2&&$(".buychat").hide();CHAT_SITEID==8&&$("#chatnow").hide()}function ViewInviteChat(){if(CHAT_INVITE==1&&CHAT_ENABLED==1&&CHAT_IN_CMT!=1&&(isOutOfWork=CheckOutOfWork(),isOutOfWork==0)){if(CHAT_SITEID==1)if(CHAT_ENABLED==1)fnViewInviteChat();else if("undefined"!=typeof GL_CATEGORYID&&"undefined"!=typeof product)(GL_CATEGORYID==522||GL_CATEGORYID==44||product.url.indexOf("iphone")>0)&&fnViewInviteChat();else"https://www.thegioididong.com/phu-kien/,https://www.thegioididong.com/may-tinh-bang/,https://www.thegioididong.com/laptop/,https://www.thegioididong.com/dtdd-apple-iphone/,".indexOf(location.href)>=0&&fnViewInviteChat();CHAT_SITEID==2&&("undefined"!=typeof CHAT_ENABLED?CHAT_ENABLED==1&&(fnViewInviteChat(),$(".buychat").show()):(fnViewInviteChat(),$(".buychat").show()));CHAT_SITEID==8&&("undefined"!=typeof CHAT_ENABLED?CHAT_ENABLED==1&&($("#chatnow").show(),fnViewInviteChat()):($("#chatnow").show(),fnViewInviteChat()));CHAT_SITEID==11&&("undefined"!=typeof CHAT_ENABLED?CHAT_ENABLED==1&&($("#chatnow").show(),fnViewInviteChat()):($("#chatnow").show(),fnViewInviteChat()))}}function CheckOutOfWork(){var r=new Date("2018-02-15 24:00:00").getTime(),u=new Date("2018-02-18 24:00:00").getTime(),t=(new Date).getTime(),n,i;return t>=r&&t<=u?1:(n=(new Date).getHours(),i=(new Date).getMinutes(),n>=22&&n<=24&&(isOutOfWork=1),n>=0&&n<=7&&(isOutOfWork=n<7?1:i>30?0:1),isOutOfWork)}function htmlEncodeCustomerName(n){return String(n).replace(/[<>./&^!]/gi,function(n){return"&#"+n.charCodeAt(0)+";"})}function loadTitleChatInfoToUI(n){var i,t,r;n&&(ad_avatar=n.ava?$avatarCDN+"/"+n.ava:$avatarCDN+"/nopic"+getExtcdnfilename(".png")+"",Customername=empty(Customername)?"Khách hàng":htmlEncodeCustomerName(Customername),empty(theOpposite)&&(theOpposite="Tư Vấn"),i='<div class="continuechat"><input type="button"  value="< Quay lại chat" onclick="continueChat()" /><\/div><div class="operator-info-endchat"><p  class="endchatmsg">Mời '+CHAT_DANHXUNG+' đánh giá chất lượng tư vấn hỗ trợ<\/p><div class="avatarto"><img src="{ad_avatar}"/><\/div><span>{ad_name}<\/span><div  id="divchatrating"><div><p  ><textarea rows="4" cols="50" class="moreinfo" id="chat_moremsg" style="display:none" placeholder="Nhận xét về việc tư vấn (không bắt buộc)"><\/textarea> <input type="button" class="btn btn-sm btn-warning btnstopbad" value="Không hài lòng" onclick="rateBad()" /> <input type="button" class="btn btn-primary btnstopgood" value="Hài lòng" onclick="rateGood()" /> <\/p> <p>hoặc<\/p><span onclick="rateIngore()" class="rateingrelink">Đóng chat ngay<\/span> <\/div>',i=i.replace("{ad_name}",theOpposite),i=i.replace("{ad_avatar}",ad_avatar),$("#chatclient #chatcloseconfirm").html(i),t='<ul><li><div href="javascript:void();" class="linkimg"><img src="{ad_avatar}" width="56" class="avatar"/><\/div><\/li><li style="width:160px"><span class="operator-role"  >Chat với Tư Vấn Bán Hàng <span class="operator-name">{ad_name}<\/span><\/span><\/li><li class="last"> <a  href="javascript:void(0)" onclick="minizeChatWindow()"  data-toggle="tooltip" data-placement="bottom" title="Thu gọn"><img src="'+$chatCDN+"/minimize_"+CHAT_SITEID+""+getExtcdnfilename(".png")+'" /><\/a><a class="stopchat"  data-toggle="tooltip" data-placement="bottom" title="Đóng" href="javascript:void(0)" onclick="closeAndStopChat()"><img src="'+$chatCDN+"/iconstop_"+CHAT_SITEID+""+getExtcdnfilename(".png")+'" /><\/a><\/li><\/ul>',t=t.replace("{name}",""+CHAT_DANHXUNG_HOA+" đang chat với Tư Vấn Bán Hàng "),t=t.replace("{ad_name}",n.fnm),t=t.replace("{ad_avatar}",ad_avatar),$("#chatclient .operator-info").html(t),$("#chatclient .operator-info-endchat").html('<div  ><div  class="endchatmsg"><span class="msg">Mời '+CHAT_DANHXUNG+' <span class="namecmt">'+Customername+'<\/span> đánh giá chất lượng tư vấn hỗ trợ?<\/span><img src="'+ad_avatar+'" class="avatar"/><span class="operator-name">'+theOpposite+'<\/span><\/div><div  id="divchatrating"><div><img  class="hailong"   onclick="rateGood()" src="'+$chatCDN+"/hailong"+getExtcdnfilename(".png")+'" /> <img  src="'+$chatCDN+"/khonghailong"+getExtcdnfilename(".png")+'" class="khonghailong" onclick="rateBad()" /><\/div><div><span onclick="rateIngore()" class="rateingrelink">Đóng chat ngay<\/span><\/div><\/div>'),$("#chatclient .operator-info-min").html('<img src="'+ad_avatar+'" class="avatar"/>'),$("#chatclient .chat .operator-info").css("height","80px;"),collecthtml=collecthtml.replace("{ad_name}",n.fnm),collecthtml=collecthtml.replace("{ad_avatar}",ad_avatar),$("#chatclient #collectdata").html(collecthtml));r="<ul><li>Chào "+getGender(gender)+'<span  class="namecmt">'+Customername+"<\/span>. Chúc "+getGender(gender)+' một ngày tốt lành! <\/li><li class="last"> <a class="stopchat"   title="Đóng" href="javascript:void(0)" onclick="closeAndStopChatCMT()"><img class="closeAndStopChatimg" src="'+$chatCDN+"/iconstopcmt_"+CHAT_SITEID+""+getExtcdnfilename(".png")+'" /><\/a><\/li><\/ul>';$("#chatclientcmt .operator-info").html(r)}function prepairUICMT(){if(!($("#chatclientcmt").length>0)){LoadUserInfo();var n=chatGetCookie("chat.username");if(!n||!(n.indexOf("@")>=0)||CHAT_BOT!=0){$("body").append($(chat_dialog_cmt));$messagescommentcmt=$("#chatclientcmt .messagescomment");$messagescmt=$("#chatclientcmt .messages");$inputMessagecmt=$("#chatclientcmt .chatinput");$minimizePagecmt=$("#chatclientcmt .minimize");$chatPagecmt=$("#chatclientcmt .navbar");loadTitleChatInfoToUI(null);$inputMessagecmt.on("input",function(){CHAT_IN_CMT=!0;updateTyping()});$inputMessagecmt.click(function(){$inputMessagecmt.focus();CHAT_IN_CMT=!0});$("#sendchatcmt").click(function(){CHAT_IN_CMT=!0;sendMessage();socket.emit("stop typing");typing=!1});$inputMessagecmt.on("keyup",function(n){n.which===13&&(sendMessage(),socket.emit("stop typing"),typing=!1)});empty(Customername)||empty(phone)||gender<=0?enablechat(0):enablechat(1);$("#chatclientcmt .chatinputarea").show();$("#chatclientcmt .chatinput").show();empty(Customername)||empty(phone)||gender<=0;resizeChatCodeCMT(CHAT_TOP,CHAT_LEFT,CHAT_WIDTH)}}}function prepairUI(){var n,u,t,i,r;if((isOutOfWork=CheckOutOfWork(),isOutOfWork!=1)&&(LoadUserInfo(),n=chatGetCookie("chat.isadmin"),u=chatGetCookie("chat.notifychatmsg"),n&&(isAdmin=n),isAdmin=1,isInitUi!=1)&&(isInitUi=1,t=chatGetCookie("chat.isminimize"),t&&(isMinimizing=t),i=chatGetCookie("chat.username"),!i||!(i.indexOf("@")>=0)||CHAT_BOT!=0)){chatSiteTitle=document.title;r=chatGetCookie("chat.unread");r&&(unreadCount=r);$("body").append($(notifychatmsg));$("body").append($(notifychatmsgmin));$("body").append($(notifychatnewmsg));$("body").append($(popup_dialog));$("body").append($(chat_dialog));$("body").append($(chatclientbackfull));"undefined"!=typeof document.categoryId&&(g_cateid=document.categoryId);"undefined"!=typeof categoryID&&(g_cateid=categoryID);"undefined"!=typeof GL_CATEGORYID&&(g_cateid=GL_CATEGORYID);"undefined"!=typeof GL_MANUFACTUREID&&(g_manuid=GL_MANUFACTUREID);"undefined"!=typeof GL_PRODUCTID&&(g_productid=GL_PRODUCTID);"undefined"!=typeof GL_PRODUCTPRICE&&(g_productprice=GL_PRODUCTPRICE);"undefined"!=typeof GL_GROUPCATEGORYNAME&&(g_groupcategoryname=GL_GROUPCATEGORYNAME);"undefined"!=typeof GL_CATEGORYNAME&&(g_categoryname=GL_CATEGORYNAME);"undefined"!=typeof ProductID&&(g_productid=ProductID);$messagescomment=$("#chatclient .messagescomment");$messages=$("#chatclient .messages");$inputMessage=$("#chatclient .chatinput");$minimizePage=$("#chatclient .minimize");$chatPage=$("#chatclient .navbar");$inputMessage.on("input",function(){h(this);updateTyping()});$inputMessage.click(function(){$inputMessage.focus()});$("#sendchat").click(function(){sendMessage();socket.emit("stop typing");typing=!1});$inputMessage.on("keyup",function(n){changeTitlePage(chatSiteTitle);h(this);n.which===13&&(sendMessage(),socket.emit("stop typing"),typing=!1)});$(document).on("focus","body",function(){changeTitlePage(chatSiteTitle)});if($("#chatclient #upload-image").html5Uploader({name:"upload-image",postUrl:"/chat/home/PostImage",onServerProgress:function(){},onSuccess:function(n){var t=$.parseJSON(n.currentTarget.response);t.message=="upload sucessfully"&&$inputMessage.val(t.imageUrl);t.message=="maximum size upload"&&alert("Dung lượng file upload quá lớn. Tối đa 500KB.");t.message=="maximum file upload"&&alert(""+CHAT_DANHXUNG_HOA+" chỉ được phép thêm tối đa 5 hình.")},onServerError:function(){}}),empty(Customername)||empty(phone)||empty(gender),getOnlineSupporterAuto(),resizeChat(),resizeChatCode(),u){setTimeout(function(){socket.emit("chat recheckinvite",{usr:username})},100);return}setTimeout(function(){try{prepairInitialData();RcmTracking()}catch(n){}},2e3)}}function chatDelCookie(n){chatSetCookie(n,"",-1,"www."+sitedomain);chatSetCookie(n,"",-1,"."+sitedomain)}function chatSetCookie(n,t,i,r){var u,f;r=r.replace("www.","");u=new Date;u.setDate(u.getDate()+i);f=escape(t)+(i==null?"":"; visited=true; "+(r?"domain="+r:"")+"; path=/; expires="+u.toUTCString()+";");document.cookie=n+"="+f}function chatGetCookie2(n){for(var r="",u,f,i=document.cookie.split(";"),t=0;t<i.length;t++)if(u=i[t].substr(0,i[t].indexOf("=")),f=i[t].substr(i[t].indexOf("=")+1),u=u.replace(/^\s+|\s+$/g,""),u==n){r=unescape(f);try{r=f}catch(e){}return r=="undefined"?"":r}return""}function chatGetCookie(n){for(var i="",u,f,r=document.cookie.split(";"),t=0;t<r.length;t++)if(u=r[t].substr(0,r[t].indexOf("=")),f=r[t].substr(r[t].indexOf("=")+1),u=u.replace(/^\s+|\s+$/g,""),u==n){i=unescape(f);try{i=decodeURIComponent(f)}catch(e){}return i=="undefined"?"":(n=="chat.username"&&i.indexOf("undefined")>=0,i)}return""}function prepairInitialData(){LoadUserInfo();empty(Customername)&&(Customername="Khách hàng");username=chatGetCookie("chat.username");username.indexOf("undefined")>=0&&(username="");room=username;(empty(username)||username=="undefined")&&!empty(myskid)&&myskid.indexOf("undefined")<0&&CHAT_ISSETMYID==!1&&(CHAT_ISSETMYID=!0,myskid=GetDateToStringUsingCookie()+myskid,username=myskid,room=myskid,chatSetCookie("chat.username",myskid,365,"."+sitedomain))}function GetDateToStringUsingCookie(){var i=new Date,r=i.getFullYear(),n=i.getMonth(),t=i.getDay();return t<10&&(t="0"+t),n<10&&(n="0"+n),r+""+n+t}function setInitialData(n){theOpposite=n.fnm;ad_avatar=n.ava;ad_avatar=n.ava?$avatarCDN+"/"+n.ava:$avatarCDN+"/nopic"+getExtcdnfilename(".png")+"";empty(Customername)&&(Customername="Khách hàng");empty(theOpposite)&&(theOpposite="Tư Vấn");loadTitleChatInfoToUI(n);LoadUserInfo();empty(Customername)||$("#txtchat_fullname").val(Customername);empty(phone)||$("#txtchat_phone").val(phone);empty(gender)||$("#txtchat_gender").val(gender);CheckIsMobile()||$('[data-toggle="tooltip"]').tooltip()}function fnChatConnecting(){var n=chatGetCookie("chat.username");n&&n.indexOf("@")>=0&&CHAT_BOT==0||(CMD_CHATCONNECTING_RUNING=1,connecting&&(socket.emit(CMD_CHATCONNECTING,CMD_CHATCONNECTING_DATA),enablechat(0),shochatwmsg(1,"<span>Hiện các nhân viên đang bận, vui lòng đợi ["+connectcount+"]<\/span>")),setTimeout(function(){connectcount++;fnChatConnecting()},5e3))}function ChatConnecting(n,t){connectcount=1;connecting=!0;CMD_CHATCONNECTING=n;CMD_CHATCONNECTING_DATA=t;CMD_CHATCONNECTING_RUNING==0&&fnChatConnecting()}function checkvalidatechat(n,t){var i=".vali"+t;empty(n)?($(i).show(),$(i).html("")):($(i).show(),$(i).html('<span style="color:red">'+n+"<\/span>"))}function iniChat(){if(Customername=$("#txtchat_fullname").val(),phone=$("#txtchat_phone").val(),email=$("#txtchat_email").val(),gender=$("#txtchat_gender").val(),empty(gender)){checkvalidatechat("Vui lòng chọn giới tính","fullname");return}runTimmer=0;jQuery.ajax({type:"POST",url:sitechaturl+"/Home/validator",data:"gender="+gender+"&phone="+phone+"&name="+Customername+"&email="+email+"&admininvite="+isadmininvite,success:function(n){n.c=="1"?(checkvalidatechat(n.phone),SaveCookieUserInfo("","","",0),setTimeout(function(){},3e3)):n.c=="2"?(checkvalidatechat(n.fullname,"fullname"),checkvalidatechat(n.phone,"phone"),checkvalidatechat(n.email,"email"),SaveCookieUserInfo("","","",0)):($("#inimsg").hide(),$("#inimsg").html(""),SaveCookieUserInfo(Customername,email,phone,gender),iseditinfo==1?socket.emit("action changeinfo",{rid:username,name:Customername,phone:phone,gender:gender,email:email}):isInviteChat==1?(connecting=!0,addLineMessage(),CHAT_ISCHATING=1,setcoookieChating(CHAT_ISCHATING),ChatConnecting("chat requestalltoadmin",{sourcechat:"",catid:g_cateid,cmtid:chat_commentid,siteid:CHAT_SITEID,rid:username,usr:username,fnm:Customername,phone:phone,gender:gender,email:email,tid:"u",aid:supporter,url:window.location.href})):isautochat==1?(connecting=!0,addLineMessage(),CHAT_ISCHATING=1,setcoookieChating(CHAT_ISCHATING),ChatConnecting(CMD_CHAT_REQUEST,{isbotrnd:CHAT_BOT_RND,isbot:CHAT_BOT,sourcechat:CHAT_SOURCE,catid:g_cateid,cmtid:chat_commentid,siteid:CHAT_SITEID,rid:username,usr:username,fnm:Customername,phone:phone,gender:gender,email:email,tid:userType,aid:supporter,url:window.location.href})):(CHAT_ISCHATING=1,setcoookieChating(CHAT_ISCHATING),addLineMessage(),ChatConnecting(CMD_CHAT_REQUEST,{isbotrnd:CHAT_BOT_RND,isbot:CHAT_BOT,sourcechat:CHAT_SOURCE,catid:g_cateid,cmtid:chat_commentid,siteid:CHAT_SITEID,rid:username,usr:username,fnm:Customername,phone:phone,gender:gender,email:email,tid:userType,aid:supporter,url:window.location.href})),showchatpage("chat"),resizeChatCode(),addChatInfoMessage(),iseditinfo=0)}})}function startChat(n){$inputMessage[0].disabled=!1;$(".chatinput").show();$(".chat-start").hide();n==1&&socket.emit("greeting")}function refreshTimeAgo(){clearInterval(intervalRefresh);intervalRefresh=0;intervalRefresh=setInterval("resetTimeAgo()",5e3)}function formatDateSent(n){var r=new Date(parseInt(n)),i=Math.floor((new Date-n)/1e3),t=Math.floor(i/31536e3);return t>1?r.toString("HH:mm dddd, dd/MM"):(t=Math.floor(i/2592e3),t>1)?r.toString("HH:mm dddd, dd/MM"):(t=Math.floor(i/86400),t>1)?r.toString("HH:mm dddd, dd/MM"):(t=Math.floor(i/3600),t>12)?r.toString("HH:mm dddd, dd/MM"):t>=1?t+" giờ trước":(t=Math.floor(i/60),t>1)?t+" phút trước":(t=Math.floor(i),t<5)?"Vừa mới gửi":t<30?t+" giây trước":t<60?"Gần 1 phút trước":"1 phút trước"}function minizeChatWindow(){$chatPage.hide();$minimizePage.show();isMinimizing=1;chatSetCookie("chat.isminimize",1,365,"."+sitedomain);$(".msgalert").hide();$(".msgalert").html("");$("#chatclient #notifychatmsgmin").hide();$("#chatclient #tooltip349481").hide();$("#chatclient #notifychatmsg").hide()}function ChatStopAll(){$chatPage.hide();$minimizePage.hide();$(".msgalert").hide();$(".msgalert").html("");chatSetCookie("chat.notifychatmsg","",365,"."+sitedomain)}function maximizeChatWindow(){$chatPage.show();$minimizePage.hide();isMinimizing=0;chatSetCookie("chat.isminimize",0,365,"."+sitedomain);unreadCount=0;chatSetCookie("chat.unread",0,365,"."+sitedomain);$(".msgalert").hide();$(".msgalert").html("");$("#chatclient #tooltip349481").hide();resizeChatCode();$inputMessage.focus();$messages[0].scrollTop=$messages[0].scrollHeight}function closeAndStopChatCMT(){var r;showchatpagecmt("close");var t="",i=$("#chatclientcmt ul.messages").html(),n=i.split("~");if(t=n.length>=2?n[n.length-1]:i,r=(t.match(new RegExp('class="me"',"g"))||[]).length,r<=0){socket.emit("stop chat",username);closechatCMT3();return}}function closeAndStopChat(){var r;showchatpage("close");var t="",i=$("#chatclient ul.messages").html(),n=i.split("~");if(t=n.length>=2?n[n.length-1]:i,r=(t.match(new RegExp('class="me"',"g"))||[]).length,r<=0){socket.emit("stop chat",username);closechat3();return}}function continueStopChat(){CHAT_ISCHATING=0;setcoookieChating(CHAT_ISCHATING);socket.emit("stop chat",username);userLeftChat({username:""},CHAT_DANHXUNG_HOA);hidechat()}function continueChat(){CHAT_ISCHATING=1;setcoookieChating(CHAT_ISCHATING);showchatpage("chat")}function rateGood(){CHAT_ISCHATING=0;setcoookieChating(CHAT_ISCHATING);socket.emit("stop chat",username);$("#chatclient #chatcloseconfirm").html('<div  class="chatthanks" ><h3>CÁM ƠN<\/h3><p>Cảm ơn '+CHAT_DANHXUNG+' đã sử dụng và đánh giá chất lượng tư vấn<\/p><img src="'+$chatCDN+"/close3"+getExtcdnfilename(".png")+'" onclick="closechat3()" /><\/div>');socket.emit("chat rate",{usr:username,rate:1,note:$("#chat_moremsg").val(),siteid:CHAT_SITEID});$("#chatclient .pages").fadeOut(3e3,function(){closechat3()})}function rateBad(){$("#chatclient #chatcloseconfirm").show();$("#chatclient #divchatrating").html('<div class="rateBad" ><p>Xin lỗi đã chưa phục vụ tốt! '+sitename+' rất mong nhận được đánh giá của quý khách!<\/p> <p> <input type="radio" name="chat_rate_check" id="chat_rate_check" value="3"> Lỗi ứng dụng chat, website<\/p> <p> <input type="radio" name="chat_rate_check" value="4"> Kiến thức của nhân viên tư vấn<\/p> <p> <input type="radio" name="chat_rate_check" value="6"> Hướng xử lý của nhân viên tư vấn<\/p> <p> <input type="radio" name="chat_rate_check" value="5"> <textarea  placeholder="Ý kiến khác"  id="chat_rate_note"><\/textarea><\/p> <p> <span onclick="rateIngore()" class="rateingrelink" style="width: 113px;   float: left;">Đóng chat ngay<\/span> <input type="button" name="chat_rate_ht" value="HOÀN TẤT" class="chat_rate_ht" onclick="rateBad2()"> <\/p><\/div>')}function rateBad2(){var n=$('input[name = "chat_rate_check"]:checked').val(),t;if(!n){alert("Mời "+CHAT_DANHXUNG+" chọn đánh giá ");return}CHAT_ISCHATING=0;setcoookieChating(CHAT_ISCHATING);socket.emit("stop chat",username);t=$("#chatclient #chat_rate_note").val();socket.emit("chat rate",{usr:username,rate:n,note:t,siteid:CHAT_SITEID});$("#chatclient #chatcloseconfirm").html('<div class="chatthanks" ><h3>CÁM ƠN<\/h3><p>Cảm ơn '+CHAT_DANHXUNG+' đã sử dụng và đánh giá chất lượng tư vấn<\/p><img src="'+$chatCDN+"/close3"+getExtcdnfilename(".png")+'" onclick="closechat3()" /> <\/div>');$("#chatclient .pages").fadeOut(3e3,function(){closechat3()})}function closechat3(){hidechat()}function rateIngore(){$("#chatclient #chatcloseconfirm").html('<div class="chatthanks" ><h3>CÁM ƠN<\/h3><p>Cảm ơn '+CHAT_DANHXUNG+' đã sử dụng và đánh giá chất lượng tư vấn<\/p><img src="'+$chatCDN+"/close3"+getExtcdnfilename(".png")+'" onclick="closechat3()" /> <\/div>');socket.emit("chat rate",{usr:username,rate:0,siteid:CHAT_SITEID});socket.emit("stop chat",username);CHAT_ISCHATING=0;setcoookieChating(CHAT_ISCHATING);$("#chatclient .pages").fadeOut(3e3,function(){closechat3()})}function continueStopChatCMT(){CHAT_ISCHATING=0;setcoookieChating(CHAT_ISCHATING);socket.emit("stop chat",username);userLeftChat({username:""},CHAT_DANHXUNG_HOA);$("#chatclientcmt #chatcloseconfirm").hide();$("#chatclientcmt #chatrating").show()}function continueChatCMT(){console.log("_5");CHAT_ISCHATING=1;setcoookieChating(CHAT_ISCHATING);showchatpagecmt("chat")}function rateGoodCMT(){CHAT_ISCHATING=0;setcoookieChating(CHAT_ISCHATING);socket.emit("stop chat",username);$("#chatclientcmt #chatcloseconfirm").html('<div  class="chatthanks" ><h3>CÁM ƠN<\/h3><p>Cảm ơn '+CHAT_DANHXUNG+' đã sử dụng và đánh giá chất lượng tư vấn<\/p><img src="'+$chatCDN+"/close3"+getExtcdnfilename(".png")+'" onclick="closechatCMT3()" /><\/div>');socket.emit("chat rate",{usr:username,rate:1,note:$("#chat_moremsg").val(),siteid:CHAT_SITEID});$("#chatclientcmt .pages").fadeOut(3e3,function(){closechatCMT3()})}function rateBadCMT(){$("#chatclientcmt #chatcloseconfirm").show();$("#chatclientcmt #divchatrating").html('<div class="rateBad" ><p>Xin lỗi đã chưa phục vụ tốt! '+sitename+' rất mong nhận được đánh giá của quý khách!<\/p> <p> <input type="radio" name="chat_rate_check" id="chat_rate_check" value="3"> Lỗi ứng dụng chat, website<\/p> <p> <input type="radio" name="chat_rate_check" value="4"> Kiến thức của nhân viên tư vấn<\/p> <p> <input type="radio" name="chat_rate_check" value="6"> Hướng xử lý của nhân viên tư vấn<\/p> <p> <input type="radio" name="chat_rate_check" value="5"> <textarea  placeholder="Ý kiến khác"  id="chat_rate_note"><\/textarea><\/p> <p> <span onclick="rateIngoreCMT()" class="rateingrelink" style="width: 113px;   float: left;">Đóng chat ngay<\/span> <input type="button" name="chat_rate_ht" value="HOÀN TẤT" class="chat_rate_ht" onclick="rateBadCMT2()"> <\/p><\/div>')}function rateBadCMT2(){var n=$('input[name = "chat_rate_check"]:checked').val(),t;if(!n){alert("Mời "+CHAT_DANHXUNG+" chọn đánh giá ");return}CHAT_ISCHATING=0;setcoookieChating(CHAT_ISCHATING);socket.emit("stop chat",username);t=$("#chatclientcmt #chat_rate_note").val();socket.emit("chat rate",{usr:username,rate:n,note:t,siteid:CHAT_SITEID});$("#chatclientcmt #chatcloseconfirm").html('<div class="chatthanks" ><h3>CÁM ƠN<\/h3><p>Cảm ơn '+CHAT_DANHXUNG+' đã sử dụng và đánh giá chất lượng tư vấn<\/p><img src="'+$chatCDN+"/close3"+getExtcdnfilename(".png")+'" onclick="closechatCMT3()" /> <\/div>');$("#chatclientcmt .pages").fadeOut(3e3,function(){closechatCMT3()})}function closechatCMT3(){$("#chatclientcmt .navbar").hide();CHAT_IN_CMT=0}function rateIngoreCMT(){$("#chatclientcmt #chatcloseconfirm").html('<div class="chatthanks" ><h3>CÁM ƠN<\/h3><p>Cảm ơn '+CHAT_DANHXUNG+' đã sử dụng và đánh giá chất lượng tư vấn<\/p><img src="'+$chatCDN+"/close3"+getExtcdnfilename(".png")+'" onclick="closechatCMT3()" /> <\/div>');socket.emit("chat rate",{usr:username,rate:0,siteid:CHAT_SITEID});socket.emit("stop chat",username);CHAT_ISCHATING=0;setcoookieChating(CHAT_ISCHATING);$("#chatclient .pages").fadeOut(3e3,function(){closechatCMT3()})}function resetTimeAgo(){$("#chatclient .msg_sent_at").each(function(){var n=formatDateSent($(this).attr("sent-at"));$(this).text()!=n&&$(this).fadeOut(100,function(){$(this).text(n).fadeIn(800)})})}function setUsername(){username&&($chatPage.show(),$inputMessage=$inputMessage.focus())}function toTimestamp(n){var t=n.replace("/Date(",""),i;return t=t.replace(")/index.html",""),i=t,i/1e3}function dateParser(n){var t,i;if(typeof n=="string"){if(t=reISO.exec(n),t)return n;if(t=reMsAjax.exec(n),t)return i=t[1].split(/[-+,.]/),i[0]?+i[0]:0-+i[1]}return n}function getMessageComment(){chat_commentid>0&&($.ajax({url:sitechaturl+"/Home/getMessageComment?ParentID="+chat_commentid,success:function(n){var r,i,u,t;adminMsgList={};r=JSON.parse(n);i="";for(u in r)t=r[u],i=t.CreatedCustomerID?i+GetItemChatMessageComment({username:"admin",fullname:t.UserProfile,message:t.Content,sentAt:dateParser(t.CreatedDate)}):i+GetItemChatMessageComment({username:username,fullname:t.UserProfile,message:t.Content,sentAt:dateParser(t.CreatedDate)});$("#chatmsg_info_cmt_cmt").html(i);$("#chatmsg_info_cmt").html(i)}}),isloadcommnet=1)}function ratingCommentShow(){$(".popratecmt").show()}function ratingComment(n,t){$.ajax({url:sitechaturl+"/Home/ajaxRatingComment?type="+t+"&commentid="+n,success:function(){alert("Đã đánh giá thành công")}});$(".popratecmt").hide();$("#notifychatnewmsg").hide();CloseReply()}function ratingNoteComment(n){var t=$(".popratecmt #popratecmttxt").val(),i=$(".popratecmt #popratecmtname").val(),r=$(".popratecmt #popratecmtphone").val();t.length>10?($.ajax({url:sitechaturl+"/Home/ajaxRatingComment2?type=2&commentid="+n+"&note="+t+"&name="+i+"&phone="+r,success:function(){alert("Đã đánh giá thành công")}}),$(".popratecmt").hide(),$("#notifychatnewmsg").hide(),CloseReply()):alert("Nội dung nhận nhận xét quá ngắn .")}function replyBotChat(n,t){var r,i,u;return connected&&(r="",i="chatmsg_"+(new Date).getTime(),$inputMessage.val(""),u={elements:[{buttons:[{title:t,payload:n}]}]},addChatMessage({username:username,fullname:name,message:"",sentAt:(new Date).getTime(),msgid:i,messagetype:"template",messagecontentobject:u,isUserPressButton:!0}),socket.emit("new message",{postbackobject:{title:t,payload:n},isbotrnd:CHAT_BOT_RND,messagetype:"payload",siteid:CHAT_SITEID,msgid:i,msg:r,tid:userType,fnm:Customername,curl:location.href,supporter:supporter},function(){})),reseth(),!1}function sendMessage(){var n=$inputMessage.val(),t;(CHAT_IN_CMT&&(n=$inputMessagecmt.val()),n=cleanInput(n).trim(),empty(n))||(n&&connected&&(t="chatmsg_"+(new Date).getTime(),$inputMessage.val(""),$inputMessagecmt.val(""),addChatMessage({username:username,fullname:name,message:n,sentAt:(new Date).getTime(),msgid:t}),n.indexOf("/stop")>=0&&socket.emit("stop chat",username),socket.emit("new message",{isbotrnd:CHAT_BOT_RND,supporter:supporter,isbot:CHAT_BOT,msgid:t,msg:n,tid:userType,fnm:Customername,curl:location.href},function(n){n&&alert("Gởi không thành công["+n+"]")})),reseth())}function chatuserinfo(){showchatpage("collect");$("#chatclient .startbutton span").html("LƯU LẠI");iseditinfo=1}function addChatInfoMessageCMT(){var n,t,i;LoadUserInfo();n=$("#chatmsg_info_cmt_cmt");n.length>0?$("#chatmsg_info_cmt_cmt").html(""):(t=$('<li id="chatmsg_info_cmt_cmt" class="chatcmtinfo"/>').html(""),i=$(t),$messagescmt.prepend(i),$messagescmt[0].scrollTop=$messagescmt[0].scrollHeight)}function addChatInfoMessage(){var n,t,i,r;LoadUserInfo();n='<div><p><span class="cname">'+getGender(gender)+" "+Customername+' <\/span><span class="cphone">'+phone+'<\/span> <a href="javascript:void(0)" onclick="chatuserinfo()">Sửa<\/a><\/p><p class="email">'+email+"<\/p><\/div>";t=$("#chatmsg_info");t.length>0?$("#chatmsg_info").html(n):(i=$('<li id="chatmsg_info" class="chatuserinfo">'+n+'<\/li><li id="chatmsg_info_cmt" class="chatcmtinfo"/>'),r=$(i),$messages.prepend(r),$messages[0].scrollTop=$messages[0].scrollHeight)}function expandchat(n){var t=$("#exb"+n+" ").html();t=="xem thêm"?($("#ex"+n+"  ").css("overflow","auto"),$("#ex"+n+" ").css("height","auto"),$("#exb"+n+" ").html("thu nhỏ")):($("#ex"+n+"  ").css("overflow","hidden"),$("#ex"+n+" ").css("height","153px"),$("#exb"+n+" ").html("xem thêm"))}function addChatMessage(n,t){var l=getTypingMessages(n),a=getMeTypingMessages(n),h,r,e,o,v,c,p,f,u;if(t=t||{},l.length!==0&&(t.fade=!1,l.remove()),a.length!==0&&(t.fade=!1,a.remove()),h=n.typing?"typing":"",r="chatmsg_"+(new Date).getTime(),n.msgid&&(r=n.msgid),e="",n.typing)e='<div><p class="msg_content">'+n.message+"<\/p><\/div>",u=$('<li id="'+r+'" class="'+(n.username==username?"me":"you")+'" />').data("username",n.username).html(e).addClass(h),CHAT_IN_CMT?addMessageElementCMT(u,t):addMessageElement(u,t);else if(empty(n.messagetype)||n.messagetype=="text"){if(CHAT_IN_CMT==!1&&(o=n.message,o.length>150&&(o=o.substr(0,150)),isMinimizing))for($("#tooltip349481").show(),$("#tooltip349481 .tooltip-inner").html("<p><span>"+o+"<\/span><\/p>"),v=$("#tooltip349481 .tooltip-inner").height(),c=$("#tooltip349481 .tooltip-inner p span");c.outerHeight(!0)>v;)c.text(function(n,t){return t.replace(/\W*\s(\S)*$/,"...")});e=n.username==lastmgsuser?"<div  >"+(n.fullname=="MSG"?"":" <span class='msg_sent_at'    sent-at='"+n.sentAt+"'>"+formatDateSent(n.sentAt)+"<\/span>")+'<p class="msg_content"   >'+n.message+"<\/p><\/div>":"<div  >"+(n.fullname=="MSG"?"":"<span class='msg_fnm'   >"+(!n.fullname||n.fullname=="undefined"?"Khách hàng":n.fullname)+"<\/span> <span  class='msg_sent_at' sent-at='"+n.sentAt+"'>"+formatDateSent(n.sentAt)+"<\/span>")+'<p class="msg_content"  >'+n.message+"<\/p><\/div>";lastmgsuser=n.username;u=$('<li id="'+r+'" class="'+(n.username==username?"me":"you")+'" />').data("username",n.username).html(e).addClass(h);CHAT_IN_CMT?addMessageElementCMT(u,t):addMessageElement(u,t);empty(n.messagetype)&&extractMetaInfo(r)}else if(n.messagetype=="template"){lastmgsuser=n.username;var w=n.messagecontentobject,s=n.messagecontentobject.elements[0].buttons,y=n.messagecontentobject.elements[0].title,i="";if(empty(y)||(i=' <span style="font-weight:bold;display: block;font-size: 12px;">'+y+"<\/span>"),s&&s.length>0)for(p in s)f=s[p],i=f.type=="web_url"?i+'<a  href="'+f.url+'" target=_blank   class="botbutton" style="color:blue !important">'+f.title+"<\/a>":n.isUserPressButton?i+'<a  href="javascript:void(0)"  class="botbutton">'+f.title+"<\/a>":i+'<a  href="javascript:void(0)" onclick="replyBotChat(\''+f.payload+"','"+f.title+'\')" class="botbutton">'+f.title+"<\/a>";i=i+" ";s.length>5&&(i='<p class="collap" id="ex'+r+'"  >'+i+'<\/p><span id="exb'+r+'"  class="expandbtn" onclick="expandchat(\''+r+"')\">xem thêm<\/span>");e=n.username==lastmgsuser?"<div  ><span class='msg_sent_at'    sent-at='"+n.sentAt+"'>"+formatDateSent(n.sentAt)+'<\/span><p class="msg_content"   >'+i+"<\/p><\/div>":"<div  ><span class='msg_fnm'   >"+n.fullname+"<\/span> <span  class='msg_sent_at' sent-at='"+n.sentAt+"'>"+formatDateSent(n.sentAt)+'<\/span><p class="msg_content"  >'+i+"<\/p><\/div>";u=$('<li id="'+r+'" class="'+(n.username==username?"me":"you")+'" />').data("username",n.username).html(e).addClass(h);CHAT_IN_CMT?addMessageElementCMT(u,t):addMessageElement(u,t)}}function addChatMessageComment(n,t){var u="chatmsg_"+(new Date).getTime(),i="",r;i=n.username==lastmgsuser?"<div>"+(n.fullname=="MSG"?"":"<span class='msg_fnm' >&nbsp;<\/span> <p class='msg_sent_at' sent-at='"+n.sentAt+"'>"+formatDateSent(n.sentAt)+"<\/p>")+'<p class="msg_content">'+n.message+"<\/p><\/div>":"<div>"+(n.fullname=="MSG"?"":"<span class='msg_fnm' >"+(!n.fullname||n.fullname=="undefined"?"Khách hàng":n.fullname)+"<\/span> <p class='msg_sent_at' sent-at='"+n.sentAt+"'>"+formatDateSent(n.sentAt)+"<\/p>")+'<p class="msg_content">'+n.message+"<\/p><\/div>";lastmgsuser=n.username;r=$('<li id="'+u+'" class="'+(n.username==username?"me":"you")+'"/>').data("username",n.username).html(i).addClass("");addMessageCommentElement(r,t)}function GetItemChatMessageComment(n){var i="chatmsg_"+(new Date).getTime(),t="";return t=n.username==lastmgsuser?"<div>"+(n.fullname=="MSG"?"":"<span class='msg_fnm' >&nbsp;<\/span> <p class='msg_sent_at' sent-at='"+n.sentAt+"'>"+formatDateSent(n.sentAt)+"<\/p>")+'<p class="msg_content">'+n.message+"<\/p><\/div>":"<div>"+(n.fullname=="MSG"?"":"<span class='msg_fnm' >"+(!n.fullname||n.fullname=="undefined"?"Khách hàng":n.fullname)+"<\/span> <p class='msg_sent_at' sent-at='"+n.sentAt+"'>"+formatDateSent(n.sentAt)+"<\/p>")+'<p class="msg_content">'+n.message+"<\/p><\/div>",lastmgsuser=n.username,'<li id="'+i+'" class="'+(n.username==username?"me":"you")+'">'+t+"<\/li>"}function extractMetaInfo(n){var t=$("#"+n+" .msg_content").html(),i=linkify(t);i.length>0&&placeWidgetInContent(t,i,n)}function placeWidgetInContent(n,t,i){t.length>0?$.ajax({method:"POST",url:sitechaturl+"/home/MetaExtractUrl",data:{url:t[0]}}).done(function(r){if(r.m=="url"){if(n=n.replace(t[0],"<a  href='"+t[0]+"' title='"+r.t+"'>"+t[0]+"<\/a>"),t.splice(0,1),t.length>0)return placeWidgetInContent(n,t,i);$("#"+i+" .msg_content").html(n)}if(r.m=="img"){var u=$widget_pattern_img;if(r.i&&(u=u.replace("{$img}","<a href='"+r.i+"' target=_blank><img src='"+r.i+"' alt='"+r.t+"' title='"+r.t+"' /><\/a>")),n=n.replace(t[0],u),t.splice(0,1),t.length>0)return placeWidgetInContent(n,t);$("#"+i).html(n)}}):$("#"+i).html(n)}function linkify(n){var t=[];return n.replace(/(\b(https?|ftp|file):\/\/[-A-Z0-9+&@@#\/%?=~_|!:,.;]*[-A-Z0-9+&@@#\/%=~_|])/ig,function(n){t.push(n)}),t}function addChatTyping(n){n.typing=!0;n.fullname=theOpposite;n.message="<em>"+theOpposite+" đang trả lời...<\/em>";addChatMessage(n)}function removeChatTyping(n){getTypingMessages(n).fadeOut(function(){$(this).remove()});getMeTypingMessages(n).fadeOut(function(){$(this).remove()})}function addMessageElement(n,t){var i=$(n);console.log("===el===",n);t||(t={});typeof t.fade=="undefined"&&(t.fade=!0);typeof t.prepend=="undefined"&&(t.prepend=!1);t.fade&&i.hide().fadeIn(FADE_TIME);t.prepend?$messages.prepend(i):$messages.append(i);$messages[0].scrollTop=$messages[0].scrollHeight}function addMessageElementCMT(n,t){var i=$(n);t||(t={});typeof t.fade=="undefined"&&(t.fade=!0);typeof t.prepend=="undefined"&&(t.prepend=!1);t.fade&&i.hide().fadeIn(FADE_TIME);t.prepend?$messagescmt.prepend(i):$messagescmt.append(i);$messagescmt[0].scrollTop=$messagescmt[0].scrollHeight}function addMessageCommentElement(n,t){var i=$(n);t||(t={});typeof t.fade=="undefined"&&(t.fade=!0);typeof t.prepend=="undefined"&&(t.prepend=!1);t.fade&&i.hide().fadeIn(FADE_TIME);CHAT_IN_CMT?($messagescmt.prepend(i),$messagescmt[0].scrollTop=$messagescmt[0].scrollHeight):($messages.prepend(i),$messages[0].scrollTop=$messages[0].scrollHeight)}function striphtml(n){var t=document.createElement("DIV");return t.innerHTML=n,t.textContent||t.innerText||""}function cleanInput(n){return striphtml(n)}function updateTyping(){var n=$inputMessage.val();(n=cleanInput(n).trim(),empty(n))||connected&&(typing||(typing=!0,socket.emit("typing",{tid:userType,rid:username,content:n})),lastTypingTime=(new Date).getTime(),setTimeout(function(){var n=(new Date).getTime(),t=n-lastTypingTime;t>=TYPING_TIMER_LENGTH&&typing&&(socket.emit("stop typing"),typing=!1)},TYPING_TIMER_LENGTH))}function getTypingMessages(n){return $(".you.typing").filter(function(){return $(this).data("username")===n.username})}function getMeTypingMessages(n){return $(".me.typing").filter(function(){return $(this).data("username")===n.username})}function SendCallMeInfo(){}function userLeftChat(n,t){CHAT_ISCHATING=0;setcoookieChating(CHAT_ISCHATING);connecting=!1;shochatwmsg(1,'<span style="color:red">'+t+" đã dừng cuộc hội thoại này<\/span>");enablechat(0)}function acceptChat(){}function tryRequestChat(){$("#chatclient  #chatclient .pages").show();$("#chatclient #divmsg").html("");requestChat(supporter,chat_commentid)}function MinInvitechat(){chatSetCookie("chat.ismininvitechat",1,365,"."+sitedomain);$("#notifychatmsg").hide();$("#notifychatmsgmin").show();$("#notifychatmsgmin").html(auhtmlinvitechatmini);$("#notifychatmsgmin").focus()}function addLineMessage(){var n=$('<li class="linehismessage" style="height:2px;"><\/li>').html('<span style="font-size:0px;">~<\/span>');addMessageElement(n)}function requestChatInvite(n){if(chatSetCookie("chat.notifychatmsg","",365,"."+sitedomain),connected==!1){alert("Không thể kết nối đến máy chủ chat");return}prepairUI();prepairInitialData();supporter=n;refreshTimeAgo();connected=!0;$inputMessage.focus();runTimmer=0;showchatpage("chat");addLineMessage();CHAT_ISCHATING=1;setcoookieChating(CHAT_ISCHATING);ChatConnecting("chat request",{cmtid:0,siteid:CHAT_SITEID,phone:phone,gender:gender,email:email,usr:username,fnm:Customername,url:window.location.href,tid:userType,aid:supporter})}function requestChat(n,t){if(chatSetCookie("chat.notifychatmsg","",365,"."+sitedomain),connected==!1){alert("Không thể kết nối đến máy chủ chat");return}chat_commentid=t;prepairUI();prepairInitialData();supporter=n;LoadUserInfo();empty(Customername)||empty(phone);refreshTimeAgo();connected=!0;$("#notifychatmsg").hide();empty(Customername)||empty(phone)?(showchatpage("collect"),runTimmer=1):(runTimmer=0,showchatpage("chat"));$inputMessage.focus();CHAT_ISCHATING=1;setcoookieChating(CHAT_ISCHATING);empty(Customername)||empty(phone)?socket.emit("chat getinfo",{username:supporter}):(addLineMessage(),socket.emit("chat request",{cmtid:chat_commentid,siteid:CHAT_SITEID,phone:phone,email:email,gender:gender,usr:username,fnm:Customername,url:window.location.href,tid:userType,aid:supporter}),addChatInfoMessage())}function requestChatAuto(n){if(CHAT_SOURCE=n,isautochat=1,connected==!1){alert("Không thể kết nối đến máy chủ chat");return}chat_commentid=0;prepairUI();prepairInitialData();supporter="";LoadUserInfo();empty(Customername)||empty(phone);CHAT_ISCHATING=1;setcoookieChating(CHAT_ISCHATING);refreshTimeAgo();connected=!0;empty(Customername)||empty(phone)||gender<=0?(showchatpage("collect"),runTimmer=1):(runTimmer=0,showchatpage("chat"));!empty(Customername)&&!empty(phone)&&gender>0?(addLineMessage(),CHAT_BOT==1?ChatConnecting(CMD_CHAT_REQUEST,{isbot:CHAT_BOT,sourcechat:CHAT_SOURCE,catid:g_cateid,cmtid:chat_commentid,siteid:CHAT_SITEID,phone:phone,email:email,usr:username,fnm:Customername,gender:gender,url:window.location.href,tid:userType,aid:"chatbottgdd"}):ChatConnecting(CMD_CHAT_REQUEST,{isbotrnd:CHAT_BOT_RND,isbot:CHAT_BOT,sourcechat:CHAT_SOURCE,catid:g_cateid,cmtid:chat_commentid,siteid:CHAT_SITEID,phone:phone,email:email,usr:username,fnm:Customername,gender:gender,url:window.location.href,tid:userType,aid:""}),addChatInfoMessage()):SetAutoInfo();resizeChatCode();var t=0;typeof GL_PRODUCTID!="undefined"&&GL_PRODUCTID>0?t=1:typeof GL_CATEGORYID!="undefined"&&GL_CATEGORYID>0&&(t=2);try{RCMTrackingOnClickChat(t)}catch(i){console.log("RCMTrackingOnClickChat",i)}}function hidechat(){$("#chatclient .navbar").hide()}function hideregchat(){$("#chatclient #collectdata").hide();$("#chatclient .messages").show();$("#chatclient .chatinputarea").show()}function showregchat(){$("#chatclient #collectdata").show();$("#chatclient .messages").hide();$("#chatclient .chatinputarea").hide()}function chatRecheckInfo(n,t){(CHAT_SITEID==8||CHAT_SITEID==2)&&(empty(n)||empty(t))&&($messages.hide(),$("#chatclient #collectdata").show(),$("#chatclient .chatinputarea").hide())}function formatCategory(n){return n[n.length-1]==","&&(n=n.substr(0,n.length-1)),n.replace("TV","Tivi").replace(/,/g,", ")}function getOnlineSupporter(){socket.emit(CMD_CHAT_ONLINESUPPORTER,{siteid:CHAT_SITEID,catid:g_cateid,url:window.location.href});window.clearTimeout(tmoOnlineSupporter);tmoOnlineSupporter=0}function ChatInviteMe(n){var t=chatGetCookie("chat.username"),i;empty(t)?Console.log("cookieuserempti"):(i={security_token:"",username:t,usernamecustomer:t,avatar:"",action:"CHAT",item:"",content:"",ChannelID:"",commentid:n,url:window.location.href,cateid:g_cateid,siteid:CHAT_SITEID},socket.emit("chat inviteme",i))}function getOnlineSupporterAuto(){CHAT_BOT==1?getOnlineSupporter():(isOutOfWork=CheckOutOfWork(),isOutOfWork==0&&(tmoOnlineSupporter=window.setTimeout(function(){getOnlineSupporter()},CHAT_LOAT_INVITE_TIME)))}function ChatReply(n){$(".chatnotifytoolbox").html('<div class="chatnotifytoolbox"> <textarea  placeholder="Nhập nội dung trả lời"  id="chatreplycomment"><\/textarea> <a class="btnReply" href="javascript:void(0)" onclick="ajaxChatReply('+n+');">Trả lời<\/a> ')}function CloseReply(){$("#notifychatnewmsg").hide()}function ajaxChatReply(n){CloseReply();var t=$("#chatreplycomment").val();jQuery.ajax({type:"POST",url:sitechaturl+"/Home/AjaxInsertComment",data:"commentid="+n+"&strContent="+t,success:function(n){n.c=="1"?alert("Đã gởi thành công"):$(".chatnotifytoolbox").html('<div class="chatnotifytoolbox">Có lỗi xảy ra<\/div>')}})}function SaveCookieUserInfo(n,t,i,r){var u={};u.name=n;u.phone=i;u.email=t;u.gender=r;empty(n)||empty(r)||chatSetCookie(cookie_info,JSON.stringify(u),365,"."+sitedomain)}function LoadCokieUserInfo(){var t=chatGetCookie(cookie_info),n;empty(t)||(n=JSON.parse(t),n&&(empty(n.name)||(Customername=checkempty(n.name),phone=checkempty(n.phone),email=checkempty(n.email),gender=checkempty(n.gender))))}function LoadUserInfo(){var h=0,r={},s=chatGetCookie(cookie_info),o,n,u;empty(s)||(r=JSON.parse(s),empty(r)||empty(r.name)||(h=1,Customername=checkempty(r.name),phone=checkempty(r.phone),email=checkempty(r.email),gender=checkempty(r.gender)));var i="",f="",e="",t=0;CHAT_SITEID==1?(i=Htmlentities(chatGetCookie("tgdd_fullname")),f=chatGetCookie("tgdd_phone"),e=chatGetCookie("tgdd_email"),t=chatGetCookie("tgdd_gender")):CHAT_SITEID==2?(o=chatGetCookie("DMX_Personal"),empty(o)||(n=JSON.parse(o),n&&(u=checkempty(n.CustomerSex),u==""&&(t=0),u=="0"&&(t=1),u=="1"&&(t=2),i=checkempty(n.CustomerName),f=checkempty(n.CustomerPhone),e=checkempty(n.CustomerEmail))),empty(i)&&(i=chatGetCookie("dm_fullname"),f=chatGetCookie("dm_phone"),e=chatGetCookie("dm_email"),t=chatGetCookie("dm_gender"))):CHAT_SITEID==8?(o=chatGetCookie("vv_vcrif"),empty(o)||(n=JSON.parse(o),n&&(u=checkempty(n.Gender),empty(u)&&(t=0),u=="1"&&(t=1),u=="0"&&(t=2),i=checkempty(n.Name),f=checkempty(n.Phone),e=checkempty(n.Email))),empty(i)&&(i=chatGetCookie("dm_fullname"),f=chatGetCookie("dm_phone"),e=chatGetCookie("dm_email"),t=chatGetCookie("dm_gender"))):CHAT_SITEID==11?(o=chatGetCookie("bhx_vcrif"),empty(o)||(n=JSON.parse(o),n&&(u=checkempty(n.Gender),empty(u)&&(t=0),u=="1"&&(t=1),u=="0"&&(t=2),i=checkempty(n.Name),f=checkempty(n.Phone),e=checkempty(n.Email))),empty(i)&&(i=chatGetCookie("dm_fullname"),f=chatGetCookie("dm_phone"),e=chatGetCookie("dm_email"),t=chatGetCookie("dm_gender"))):empty(i)&&(i=chatGetCookie("dm_fullname"),f=chatGetCookie("dm_phone"),e=chatGetCookie("dm_email"),t=chatGetCookie("dm_gender"));i==name||empty(i)||(Customername=i);f==phone||empty(f)||(phone=f);e==email||empty(e)||(email=e);t==gender||empty(t)||(gender=t);r.name=Customername;r.phone=phone;r.email=email;r.gender=gender;empty(Customername)||empty(gender)||chatSetCookie(cookie_info,JSON.stringify(r),365,"."+sitedomain)}function RCMTrackingOnClickChat(n){var t="?cmd=trackclickchat&siteid="+CHAT_SITEID+"&type=6&url="+encodeURIComponent(location.href)+"&t="+getRandomInt(),i=0;typeof GL_PRODUCTID!="undefined"&&GL_PRODUCTID>0?(i=1,t+="&productid="+GL_PRODUCTID):t+="&productid=0";typeof GL_CATEGORYID!="undefined"&&GL_CATEGORYID>0?(i=2,t+="&categoryid="+GL_CATEGORYID):t+="&categoryid=0";t+="&wtype="+n;console.log("param",t)}function RcmTrackingReadCampaign(){}function RcmTrackingClickCampaign(){}function RcmTrackingAjax(n){var u=chatGetCookie("chat.username"),r;LoadCokieUserInfo();var i="cmd=trackcustomer&useragent="+navigator.userAgent+"&token="+n+"&username="+u+"&fullname="+encodeURIComponent(name)+"&gender="+gender+"&address="+encodeURIComponent(address)+"&phone="+phone+"&campaignid=&siteid="+CHAT_SITEID+"&type=4&url="+encodeURIComponent(location.href)+"&productid="+g_productid+"&manuid="+g_manuid+"&categoryid="+g_cateid+"&categoryname="+decodeURIComponent(encodeURIComponent(g_categoryname))+"&groupcategoryname="+decodeURIComponent(encodeURIComponent(g_groupcategoryname))+"&productprice="+g_productprice+"&t="+getRandomInt(),t="";(CHAT_SITEID==2||CHAT_SITEID==1)&&(t="https://rtm.thegioididong.com/memtracking?"+i);(CHAT_SITEID==8||CHAT_SITEID==11)&&(t="https://rtm.thegioididong.com/memtracking?"+i);r="<img src='"+t+"' style='height:0px;width:0px;'>";$("body").append($(r))}function getRandomInt5(){var n=Math.floor(Math.random()*100);return(console.log("=========%=========",n),n<=99)?1:0}function getRandomInt(){return Math.floor(Math.random()*1e3)}function RcmTrackingAddToCartAjax(n,t){var u=chatGetCookie("chat.username"),i="https://rtm.thegioididong.com/memtracking?cmd=trackaddtocard&siteid="+CHAT_SITEID+"&type=4&addtocartcatname="+n+"&addtocartgroupcatname="+t+"&t="+getRandomInt(),r="<img src='"+i+"' style='height:0px;width:0px;'>";$("body").append($(r))}function RcmTrackingAjaxPost(n){var u=chatGetCookie("chat.username"),t=new FormData(this),r,i;t.append("username",u);CHAT_SITEID==1?(Customername=Htmlentities(chatGetCookie("tgdd_fullname")),phone=chatGetCookie("tgdd_phone"),email=chatGetCookie("tgdd_email"),gender=chatGetCookie("tgdd_gender")):CHAT_SITEID==2?(r=chatGetCookie("DMX_Personal"),empty(r)||(i=JSON.parse(r),i&&(Customername=checkempty(i.CustomerName),phone=checkempty(i.CustomerPhone),email=checkempty(i.CustomerEmail),gender=checkempty(i.CustomerSex)==0?1:2)),empty(Customername)&&(Customername=chatGetCookie("dm_fullname"),phone=chatGetCookie("dm_phone"),email=chatGetCookie("dm_email"),gender=chatGetCookie("dm_gender"))):CHAT_SITEID==8?(r=chatGetCookie("vv_newccpf"),empty(r)||(i=JSON.parse(r),i&&(Customername=checkempty(i.CustomerName),phone=checkempty(i.CustomerPhone),email=checkempty(i.CustomerEmail),gender=i.Gender==0?1:2)),empty(Customername)&&(Customername=chatGetCookie("dm_fullname"),phone=chatGetCookie("dm_phone"),email=chatGetCookie("dm_email"),gender=chatGetCookie("dm_gender"))):empty(Customername)&&(Customername=chatGetCookie("dm_fullname"),phone=chatGetCookie("dm_phone"),email=chatGetCookie("dm_email"),gender=chatGetCookie("dm_gender"));empty(Customername)||LoadCokieUserInfo();t.append("fullname",Customername);t.append("phone",phone);t.append("email",email);t.append("gender",gender);t.append("siteid",CHAT_SITEID);t.append("useragent",navigator.userAgent);t.append("productID",g_productid);t.append("categoryID",g_cateid);t.append("manufactureID",g_manuid);t.append("token",n);t.append("groupcategoryname",g_groupcategoryname);t.append("categoryname",g_categoryname);t.append("productprice",g_productprice);t.append("url",location.href);$.ajax({url:sitechaturl+"/Home/trackdata",type:"POST",data:t,success:function(){},cache:!1,contentType:!1,processData:!1})}function RcmTracking(){if(location.href.indexOf("cmpid=")>0){var t="",n=username,i=location.href;try{t=i.match(/cmpid=([\w-]+)/)[1];n=i.match(/cmpu=([\w-]+)/)[1]}catch(r){}empty(n)&&(n=username);RcmTrackingClickCampaign(t,n)}if(CHAT_SITEID==11||CHAT_SITEID==8||CHAT_SITEID==2||CHAT_SITEID==1)if("undefined"!=typeof messaging)messaging.requestPermission().then(function(){console.log("Notification permission granted.");messaging.getToken().then(function(n){if(n){console.log(n);RcmTrackingAjax(n);return}RcmTrackingAjax("");return}).catch(function(){RcmTrackingAjax("");return})}).catch(function(){RcmTrackingAjax("");return});else{RcmTrackingAjax("");return}}function registerchatwithcomment(){}function registerchatwithcommentnew(n,t,i,r,u,f,e,o){if(CHAT_TOP=n,CHAT_LEFT=t,CHAT_WIDTH=i,SaveCookieUserInfo(r,e,f,u),Customername=r,email=e,phone=f,gender=u,hidechat(),$("#notifychatmsg").hide(),$("#chattooltipmsg").hide(),CHAT_IN_CMT=!0,chatSetCookie("chat.notifychatmsg","",365,"."+sitedomain),connected==!1){alert("Không thể kết nối đến máy chủ chat");return}chat_commentid=o;isInviteChat=1;isautochat=1;prepairUICMT();prepairInitialData();LoadUserInfo();empty(Customername)||empty(phone);resizeChatCodeCMT(CHAT_TOP,CHAT_LEFT,CHAT_WIDTH);refreshTimeAgo();connected=!0;empty(Customername)||empty(phone)||(runTimmer=0);CHAT_ISCHATING=1;setcoookieChating(CHAT_ISCHATING);CHAT_BOT==1?ChatConnecting(CMD_CHAT_REQUEST,{isbotrnd:CHAT_BOT_RND,isbot:CHAT_BOT,sourcechat:CHAT_SOURCE,catid:g_cateid,cmtid:chat_commentid,siteid:CHAT_SITEID,phone:phone,email:email,usr:username,fnm:Customername,gender:gender,url:window.location.href,tid:userType,aid:"chatbottgdd"}):ChatConnecting(CMD_CHAT_REQUEST,{isbotrnd:CHAT_BOT_RND,isbot:CHAT_BOT,sourcechat:CHAT_SOURCE,catid:g_cateid,cmtid:chat_commentid,siteid:CHAT_SITEID,phone:phone,email:email,usr:username,fnm:Customername,gender:gender,url:window.location.href,tid:userType,aid:""})}function registerchatwithmessage(n,t){if(chatSetCookie("chat.notifychatmsg","",365,"."+sitedomain),connected==!1){alert("Không thể kết nối đến máy chủ chat");return}welcome_msg=t;isInviteChat=1;isautochat=1;prepairUI();prepairInitialData();supporter=n;LoadUserInfo();empty(Customername)||empty(phone);refreshTimeAgo();connected=!0;empty(Customername)||empty(phone)?showchatpage("collect"):(runTimmer=0,showchatpage("chat"));CHAT_ISCHATING=1;setcoookieChating(CHAT_ISCHATING);empty(Customername)||empty(phone)?socket.emit("chat getinfo",{username:supporter}):(addLineMessage(),socket.emit("chat requestalltoadmin",{cmtid:chat_commentid,siteid:CHAT_SITEID,phone:phone,email:email,usr:username,fnm:Customername,url:window.location.href,tid:userType,aid:supporter}),addChatInfoMessage())}function testchatshownotifycmt(){chatshownotifycmt({action:"NEWMESSAGE",avatar:"",ctvusername:"quanghaisoft@yahoo.com",ctvname:"haidam",commentid:"121212",cmtlink:"dasdad",namecustomer:"Văn Hạnh",content:"Tôi muốn mua tiền"})}function chatshownotifycmt(n){var i=n,f=chatGetCookie("chat.username"),r="",t,u;if(r=i.avatar?$avatarCDN+"/"+i.avatar:$avatarCDN+"/nopic"+getExtcdnfilename(".png")+"",i.action=="CHAT")t='<div class="cmtnotifyChat"><img src="{avatar}"><div class="ctNotify"><p>'+CHAT_DANHXUNG_HOA+' có muốn chat ngay với nhân viên tư vấn bán hàng {name}?<\/p><a class="btnRqChat" href="javascript:void(0)" onclick="requestChat(\'{username}\', \'{commentid}\');">CHAT NGAY<\/a><a class="seeCmt" href="javascript:void(0)" onclick="HideInviteChat();">Không, cảm ơn<\/a><\/div><\/div>',t=t.replace("{username}",i.ctvusername),t=t.replace("{name}",i.ctvname),t=t.replace("{avatar}",r),t=t.replace("{commentid}",i.commentid),$("#notifychatmsg").show(),$("#notifychatmsg").html(t),$("#notifychatmsg").focus(),chatSetCookie("chat.notifychatmsg","1",1,"."+sitedomain),i.ctvname&&changeTitlePage("QTV "+i.ctvname+" vừa trả lời bạn:"+i.content),runTimmer=1,startTimer(90);else if(i.action=="NEWMESSAGE"){if(CHAT_SITEID==8){try{vuivui_showcomment(i)}catch(e){}return}if(CHAT_SITEID==2||CHAT_SITEID==1)try{ga("send","event","chat","notify comment","tracking")}catch(e){}t='<div class=\'ccmtnotify-header\'><span class=\'ccmtnotify-title\'>CÂU HỎI CỦA BẠN VỪA CÓ TRẢ LỜI<\/span><img onclick="CloseReply()" class="close" src=\'../cdn.tgdd.vn/dmxchat/cmtclose2x.png\'/>  <\/div><div class="notifyNewChat"><div class="ctNotify"><p><b>{name}<\/b> vừa trả lời cho <b>{namecustomer}:<\/b><\/p><p class=\'ccmtcontent\'>"{content}"<\/p>{cmtlink} <div class="chatnotifytoolbox"><div class="popratecmt"><h4>Mời '+CHAT_DANHXUNG+' góp ý để QTV {name} phục vụ tốt hơn : <\/h4><input id="popratecmttxt"  placeholder="Nội dung góp ý" type="text"><input id="popratecmtname" placeholder="Họ tên" type="text"><input id="popratecmtphone" placeholder="Số điện thoại" type="text"><input type="button" value="GỬI" onclick="ratingNoteComment(\'{commentid}\')"><\/div> <a class="btnReply" href="javascript:void(0)" onclick="ChatReply(\'{commentid}\');">Trả lời<\/a><div class="cmtratingbtn"><a class="cmtrating hl" href="javascript:void(0)" onclick="ratingComment(\'{commentid}\',1);"><span>Hài lòng<\/span><\/a> <a class="cmtrating khl" href="javascript:void(0)" onclick="ratingCommentShow(\'{commentid}\',2);"><span>Không hài lòng<\/span><\/a><\/div><\/div><\/div> <\/div>';t=t.replace("{username}",i.ctvusername);t=t.replace("{name}",i.ctvname);t=t.replace("{name}",i.ctvname);t=t.replace("{avatar}",r);t=t.replace("{commentid}",i.commentid);t=t.replace("{commentid}",i.commentid);t=t.replace("{commentid}",i.commentid);console.log("SS: ",i.cmtlink);t=CHAT_SITEID!=9&&(CHAT_SITEID!=11||empty(i.cmtlink))?CHAT_SITEID==9||CHAT_SITEID==11||empty(i.cmtlink)?t.replace("{cmtlink}",""):t.replace("{cmtlink}",'<p class="chatcmtlink">Xem bình luận tại link: <a target=_blank href="'+i.cmtlink+'">'+i.cmtlink+"<\/a><\/p> "):t.replace("{cmtlink}",' <p class="chatcmtlink"><a href="'+i.cmtlink+'" target="_blank" >Xem bình luận<\/a><\/p>');t=t.replace("{namecustomer}",i.namecustomer);t=t.replace("{content}",i.content);$("#notifychatnewmsg").show();$("#notifychatnewmsg").html(t);$("#notifychatnewmsg").focus();$("#notifychatnewmsg").center();$(".chatnotifytoolbox .btnReply").show();i.ctvname&&changeTitlePage("QTV "+i.ctvname+" vừa trả lời bạn:"+i.content)}else u="<b>"+i.username+"<\/b> "+i.action+" "+i.item+":<i>"+i.content+"<\/i>",$("#notifycmtmsg").removeClass("hide"),$("#notifycmtmsg").html("Có bình luận mới thêm vào. <a href='javascript:' onclick='getCmtNotify();'>Click để xem <\/a>"),$("#notifycmtmsg").removeClass("fixedChat")}function setcoookieChating(n){chatSetCookie("chat.chating",n,30,"."+sitedomain)}function CheckPopupInviteChat(n,t=1){var e=chatGetCookie("Chat_ShowintiteChat"),i=new Date,o=i.getFullYear()+"-"+(i.getMonth()+1)+"-"+i.getDate(),r,u,f;if(e==o)return console.log("denyed"),!1;r=PopupInviteChat(n,t);r||BE_GlobalNumBerCanChat!=0||CHAT_ISCHATING!=0||(u='<div id="BE-notification"><div style="background: #fff;border-radius: 4px;padding: 0px;max-width: 185px;z-index: 1000;position: fixed;top: 10px;right: 0;height: 39px;-moz-box-sizing: border-box;-webkit-box-sizing: border-box;box-sizing: border-box;box-shadow: 2px 0 16px 4px rgba(0,0,0,.21);"><p style="text-align: center;">Quý khách cần hỗ trợ<br />CHAT NGAY<\/p><\/div><\/div>',$("body").append(u),f=setInterval(()=>{if(CHAT_ISCHATING==0&&BE_GlobalNumBerCanChat>0)var i=PopupInviteChat(n,t);i&&clearInterval(f)},5e3))}function PopupInviteChat(n,t=1){var i,u,f;if(BE_GlobalNumBerCanChat==0||CHAT_ISCHATING==1)return console.log("NOT Numcanchat || CHAT_ISCHATING"),console.log("CHAT_ISCHATING",CHAT_ISCHATING),!1;var e=chatGetCookie("Chat_ShowintiteChat"),r=new Date,o=r.getFullYear()+"-"+(r.getMonth()+1)+"-"+r.getDate();return e==o?(console.log("denyed"),!0):(i="#00A4DE",t==1&&(i="#ffd900"),u=document.getElementById("BE-notification"),u)?(document.getElementById("BE-notification").style.display="block",!0):(f='<div id="BE-notification"><div style="margin: 0 auto;background: #fff;border-radius: 4px;padding: 20px;max-width: 400px;z-index: 1000;position: fixed;top: 10px;right: 0;left: 0px;;height: 130px;-moz-box-sizing: border-box;-webkit-box-sizing: border-box;box-sizing: border-box;box-shadow: 2px 0 16px 4px rgba(0,0,0,.21);"><p style="text-align: center;">Quản trị viên Chat đang sẵn sàng để hỗ trợ bạn đặt hàng<br />CHAT NGAY<\/p><div style="text-align: center;margin-top: 15px;"><a onclick="ClosePopupInviteChat();" style="display: inline-block;padding: 12px;border-radius: 4px;margin-left: 10px;cursor: pointer;text-transform: uppercase;width: 120px;color: '+i+';">Từ chối<\/a><a onclick="AcceptPopupInviteChat();" style="display: inline-block;font-weight: bold;background: '+i+';color: black;padding: 12px;border-radius: 4px;cursor: pointer;text-transform: uppercase;width: 120px;">Đồng ý<\/a><\/div><\/div><\/div>',$("body").append(f),!0)}function ClosePopupInviteChat(){document.getElementById("BE-notification").style.display="none";var n=new Date,t=n.getFullYear()+"-"+(n.getMonth()+1)+"-"+n.getDate();chatSetCookie("Chat_ShowintiteChat",t,1,"."+sitedomain)}function AcceptPopupInviteChat(){BE_GlobalNumBerCanChat==0?alert("Hiện tại tất cả nhân viên chat đang bận, vui lòng quay lại sau."):(requestChatAuto(""),Customername="Khách",phone="",email="",gender="0",runTimmer=0,$("#inimsg").hide(),$("#inimsg").html(""),SaveCookieUserInfo(Customername,email,phone,gender),iseditinfo==1?socket.emit("action changeinfo",{rid:username,name:Customername,phone:phone,gender:gender,email:email}):isInviteChat==1?(connecting=!0,addLineMessage(),CHAT_ISCHATING=1,setcoookieChating(CHAT_ISCHATING),ChatConnecting("chat requestalltoadmin",{sourcechat:"",catid:g_cateid,cmtid:chat_commentid,siteid:CHAT_SITEID,rid:username,usr:username,fnm:Customername,phone:phone,gender:gender,email:email,tid:"u",aid:supporter,url:window.location.href})):isautochat==1?(connecting=!0,addLineMessage(),CHAT_ISCHATING=1,setcoookieChating(CHAT_ISCHATING),ChatConnecting(CMD_CHAT_REQUEST,{isbotrnd:CHAT_BOT_RND,isbot:CHAT_BOT,sourcechat:CHAT_SOURCE,catid:g_cateid,cmtid:chat_commentid,siteid:CHAT_SITEID,rid:username,usr:username,fnm:Customername,phone:phone,gender:gender,email:email,tid:userType,aid:supporter,url:window.location.href})):(CHAT_ISCHATING=1,setcoookieChating(CHAT_ISCHATING),addLineMessage(),ChatConnecting(CMD_CHAT_REQUEST,{isbotrnd:CHAT_BOT_RND,isbot:CHAT_BOT,sourcechat:CHAT_SOURCE,catid:g_cateid,cmtid:chat_commentid,siteid:CHAT_SITEID,rid:username,usr:username,fnm:Customername,phone:phone,gender:gender,email:email,tid:userType,aid:supporter,url:window.location.href})),showchatpage("chat"),resizeChatCode(),addChatInfoMessage(),iseditinfo=0);document.getElementById("BE-notification").style.display="none"}function ShowPopupInviteChat(){var n=window.location.href;if(!n.includes("?newchat=1")||!n.includes("&newchat=1"))return console.log("exit show popup"),!1;console.log("using newchat show popup");var i=chatGetCookie("Chat_ShowintiteChat"),t=new Date,r=t.getFullYear()+"-"+(t.getMonth()+1)+"-"+t.getDate();if(i==r)return!1;n.includes("dienmayxanh.com")?n.includes("/dat-hang")?(console.log("trang dat hang"),setTimeout(()=>{CheckPopupInviteChat(0,2)},12e4)):n.includes("tra-gop/index.html")&&(console.log("trang chả góp"),setTimeout(()=>{CheckPopupInviteChat(1,2)},18e4)):n.includes("thegioididong.com")&&(n.includes("/gio-hang")?setTimeout(()=>{CheckPopupInviteChat(0,2)},12e4):n.includes("tra-gop/index.html")&&setTimeout(()=>{CheckPopupInviteChat(1,2)},18e4))}function CheckValidateField(n){return n==null||n==undefined?!1:!0}function SetChatWithCTV(n){return CHAT_ISCHATING==1?(console.log("CHAT_ISCHATING: "+CHAT_ISCHATING),!1):(requestChatAuto(""),Customername=n.name.length>0?n.name:"Khách",phone=CheckValidateField(n.numphone)?n.numphone:"",email=CheckValidateField(n.email)?n.email:"",gender=n.gender,runTimmer=0,console.log("INFO CHUYỂN: ",n),$("#inimsg").hide(),$("#inimsg").html(""),SaveCookieUserInfo(Customername,email,phone,gender),iseditinfo==1?socket.emit("action changeinfo",{rid:username,name:Customername,phone:phone,gender:gender,email:email}):isInviteChat==1?(connecting=!0,addLineMessage(),CHAT_ISCHATING=1,setcoookieChating(CHAT_ISCHATING),ChatConnecting("chat requestalltoadmin",{sourcechat:"",catid:g_cateid,cmtid:chat_commentid,siteid:CHAT_SITEID,rid:username,usr:username,fnm:Customername,phone:phone,gender:gender,email:email,tid:"u",aid:supporter,url:window.location.href})):isautochat==1?(connecting=!0,addLineMessage(),CHAT_ISCHATING=1,setcoookieChating(CHAT_ISCHATING),ChatConnecting(CMD_CHAT_REQUEST,{isbotrnd:CHAT_BOT_RND,isbot:CHAT_BOT,sourcechat:CHAT_SOURCE,catid:g_cateid,cmtid:chat_commentid,siteid:CHAT_SITEID,rid:username,usr:username,fnm:Customername,phone:phone,gender:gender,email:email,tid:userType,aid:supporter,url:window.location.href})):(CHAT_ISCHATING=1,addLineMessage(),setcoookieChating(CHAT_ISCHATING),ChatConnecting(CMD_CHAT_REQUEST,{isbotrnd:CHAT_BOT_RND,isbot:CHAT_BOT,sourcechat:CHAT_SOURCE,catid:g_cateid,cmtid:chat_commentid,siteid:CHAT_SITEID,rid:username,usr:username,fnm:Customername,phone:phone,gender:gender,email:email,tid:userType,aid:supporter,url:window.location.href})),showchatpage("chat"),resizeChatCode(),addChatInfoMessage(),iseditinfo=0,!0)}function ShowFbChatTGDD(){var n=window.location.href,t,i,r;n.includes("viewfb=1")&&(n.includes("thegioididong.com")||n.includes("localdienmay.com"))&&(t=[227295,216173,222596,211570,200533,153856,217331,227525,227529,214924],GL_PRODUCTID!=undefined&&GL_PRODUCTID>0&&t.filter(n=>n==GL_PRODUCTID).length>0&&(i=document.getElementById("fb-root"),i||$("body").append('<div id="fb-root"><\/div>'),r=document.getElementsByClassName("fb-customerchat").length,r==0&&$("body").append('<div class="fb-customerchat" attribution="setup_tool" page_id="124707154243128" logged_in_greeting="Chào bạn, bạn cần hỗ trợ gì không ạ?" logged_out_greeting="Chào bạn, bạn cần hỗ trợ gì không ạ?"> <\/div>')))}function AutoShowChat(){var n=window.location.hostname,i=window.location.pathname,t;return(n.includes("www.thegioididong.com")||n.includes("localdienmay.com"))&&(t=["/dtdd/iphone-12-pro-max","/dtdd/samsung-galaxy-m51","/dtdd/samsung-galaxy-a21s","/chat"],t.filter(n=>i===n).length>0)?!0:(n.includes("www.dienmayxanh.com")||n.includes("localdienmay.com"))&&(t=["/may-loc-nuoc/kangaroo-kg10a3","/may-loc-nuoc-sunhouse","/may-giat/toshiba-tw-bh95s2v-wk","/tivi/sony-kd-43x8000g","/tivi/lg-55sm8100pta","/tivi/samsung-ua50tu7000","/may-lanh/panasonic-cu-cs-pu9wkh-8m","/chat"],t.filter(n=>i===n).length>0)?!0:!1}function CheckIsAutoShowChat(){var t=new Date("2020-12-02"),i=new Date("2020-12-10"),n=new Date;return n.getTime()>t.getTime()&&n.getTime()<=i.getTime()&&AutoShowChat()?(ViewInviteChat(null),!0):!1}function Htmlentities(n){return n.replace(/[\u00A0-\u9999<>\&]/g,function(n){return"&#"+n.charCodeAt(0)+";"})}var cdnChatUrl,chat_dialog_cmt,schatcmt,runTimmer,CHAT_ISSETMYID,reISO,reMsAjax,iseditinfo,$widget_pattern,$widget_pattern_img,BE_GlobalNumBerCanChat;!function(n){if("object"==typeof exports&&"undefined"!=typeof module)module.exports=n();else if("function"==typeof define&&define.amd)define([],n);else{var t;"undefined"!=typeof window?t=window:"undefined"!=typeof global?t=global:"undefined"!=typeof self&&(t=self);t.io=n()}}(function(){var n;return function t(n,i,r){function u(f,o){var h,s;if(!i[f]){if(!n[f]){if(h=typeof require=="function"&&require,!o&&h)return h(f,!0);if(e)return e(f,!0);throw new Error("Cannot find module '"+f+"'");}s=i[f]={exports:{}};n[f][0].call(s.exports,function(t){var i=n[f][1][t];return u(i?i:t)},s,s.exports,t,n,i,r)}return i[f].exports}for(var e=typeof require=="function"&&require,f=0;f<r.length;f++)u(r[f]);return u}({1:[function(n,t){t.exports=n("lib/index.html")},{"./lib/":2}],2:[function(n,t,i){function e(n,t){typeof n=="object"&&(t=n,n=undefined);t=t||{};var e=o(n),i=e.source,s=e.id,h;return t.forceNew||t["force new connection"]||!1===t.multiplex?(f("ignoring socket cache for %s",i),h=u(i,t)):(r[s]||(f("new io instance for %s",i),r[s]=u(i,t)),h=r[s]),h.socket(e.path)}var o=n("./url"),s=n("socket.io-parser"),u=n("./manager"),f=n("debug")("socket.io-client"),r;t.exports=i=e;r=i.managers={};i.protocol=s.protocol;i.connect=e;i.Manager=n("./manager");i.Socket=n("./socket")},{"./manager":3,"./socket":5,"./url":6,debug:10,"socket.io-parser":46}],3:[function(n,t){function i(n,t){if(!(this instanceof i))return new i(n,t);n&&"object"==typeof n&&(t=n,n=undefined);t=t||{};t.path=t.path||"/socket.io";this.nsps={};this.subs=[];this.opts=t;this.reconnection(t.reconnection!==!1);this.reconnectionAttempts(t.reconnectionAttempts||Infinity);this.reconnectionDelay(t.reconnectionDelay||1e3);this.reconnectionDelayMax(t.reconnectionDelayMax||5e3);this.randomizationFactor(t.randomizationFactor||.5);this.backoff=new l({min:this.reconnectionDelay(),max:this.reconnectionDelayMax(),jitter:this.randomizationFactor()});this.timeout(null==t.timeout?2e4:t.timeout);this.readyState="closed";this.uri=n;this.connected=[];this.encoding=!1;this.packetBuffer=[];this.encoder=new e.Encoder;this.decoder=new e.Decoder;this.autoConnect=t.autoConnect!==!1;this.autoConnect&&this.open()}var a=n("./url"),s=n("engine.io-client"),h=n("./socket"),c=n("component-emitter"),e=n("socket.io-parser"),u=n("./on"),f=n("component-bind"),v=n("object-component"),r=n("debug")("socket.io-client:manager"),o=n("indexof"),l=n("backo2");t.exports=i;i.prototype.emitAll=function(){this.emit.apply(this,arguments);for(var n in this.nsps)this.nsps[n].emit.apply(this.nsps[n],arguments)};i.prototype.updateSocketIds=function(){for(var n in this.nsps)this.nsps[n].id=this.engine.id};c(i.prototype);i.prototype.reconnection=function(n){return arguments.length?(this._reconnection=!!n,this):this._reconnection};i.prototype.reconnectionAttempts=function(n){return arguments.length?(this._reconnectionAttempts=n,this):this._reconnectionAttempts};i.prototype.reconnectionDelay=function(n){return arguments.length?(this._reconnectionDelay=n,this.backoff&&this.backoff.setMin(n),this):this._reconnectionDelay};i.prototype.randomizationFactor=function(n){return arguments.length?(this._randomizationFactor=n,this.backoff&&this.backoff.setJitter(n),this):this._randomizationFactor};i.prototype.reconnectionDelayMax=function(n){return arguments.length?(this._reconnectionDelayMax=n,this.backoff&&this.backoff.setMax(n),this):this._reconnectionDelayMax};i.prototype.timeout=function(n){return arguments.length?(this._timeout=n,this):this._timeout};i.prototype.maybeReconnectOnOpen=function(){!this.reconnecting&&this._reconnection&&this.backoff.attempts===0&&this.reconnect()};i.prototype.open=i.prototype.connect=function(n){var i,t,e,o,f,h;return(r("readyState %s",this.readyState),~this.readyState.indexOf("open"))?this:(r("opening %s",this.uri),this.engine=s(this.uri,this.opts),i=this.engine,t=this,this.readyState="opening",this.skipReconnect=!1,e=u(i,"open",function(){t.onopen();n&&n()}),o=u(i,"error",function(i){if(r("connect_error"),t.cleanup(),t.readyState="closed",t.emitAll("connect_error",i),n){var u=new Error("Connection error");u.data=i;n(u)}else t.maybeReconnectOnOpen()}),!1!==this._timeout&&(f=this._timeout,r("connect attempt will timeout after %d",f),h=setTimeout(function(){r("connect attempt timed out after %d",f);e.destroy();i.close();i.emit("error","timeout");t.emitAll("connect_timeout",f)},f),this.subs.push({destroy:function(){clearTimeout(h)}})),this.subs.push(e),this.subs.push(o),this)};i.prototype.onopen=function(){r("open");this.cleanup();this.readyState="open";this.emit("open");var n=this.engine;this.subs.push(u(n,"data",f(this,"ondata")));this.subs.push(u(this.decoder,"decoded",f(this,"ondecoded")));this.subs.push(u(n,"error",f(this,"onerror")));this.subs.push(u(n,"close",f(this,"onclose")))};i.prototype.ondata=function(n){this.decoder.add(n)};i.prototype.ondecoded=function(n){this.emit("packet",n)};i.prototype.onerror=function(n){r("error",n);this.emitAll("error",n)};i.prototype.socket=function(n){var t=this.nsps[n],i;if(!t){t=new h(this,n);this.nsps[n]=t;i=this;t.on("connect",function(){t.id=i.engine.id;~o(i.connected,t)||i.connected.push(t)})}return t};i.prototype.destroy=function(n){var t=o(this.connected,n);(~t&&this.connected.splice(t,1),this.connected.length)||this.close()};i.prototype.packet=function(n){r("writing packet %j",n);var t=this;t.encoding?t.packetBuffer.push(n):(t.encoding=!0,this.encoder.encode(n,function(n){for(var i=0;i<n.length;i++)t.engine.write(n[i]);t.encoding=!1;t.processPacketQueue()}))};i.prototype.processPacketQueue=function(){if(this.packetBuffer.length>0&&!this.encoding){var n=this.packetBuffer.shift();this.packet(n)}};i.prototype.cleanup=function(){for(var n;n=this.subs.shift();)n.destroy();this.packetBuffer=[];this.encoding=!1;this.decoder.destroy()};i.prototype.close=i.prototype.disconnect=function(){this.skipReconnect=!0;this.backoff.reset();this.readyState="closed";this.engine&&this.engine.close()};i.prototype.onclose=function(n){r("close");this.cleanup();this.backoff.reset();this.readyState="closed";this.emit("close",n);this._reconnection&&!this.skipReconnect&&this.reconnect()};i.prototype.reconnect=function(){var n,t,i;if(this.reconnecting||this.skipReconnect)return this;n=this;this.backoff.attempts>=this._reconnectionAttempts?(r("reconnect failed"),this.backoff.reset(),this.emitAll("reconnect_failed"),this.reconnecting=!1):(t=this.backoff.duration(),r("will wait %dms before reconnect attempt",t),this.reconnecting=!0,i=setTimeout(function(){n.skipReconnect||(r("attempting reconnect"),n.emitAll("reconnect_attempt",n.backoff.attempts),n.emitAll("reconnecting",n.backoff.attempts),n.skipReconnect)||n.open(function(t){t?(r("reconnect attempt error"),n.reconnecting=!1,n.reconnect(),n.emitAll("reconnect_error",t.data)):(r("reconnect success"),n.onreconnect())})},t),this.subs.push({destroy:function(){clearTimeout(i)}}))};i.prototype.onreconnect=function(){var n=this.backoff.attempts;this.reconnecting=!1;this.backoff.reset();this.updateSocketIds();this.emitAll("reconnect",n)}},{"./on":4,"./socket":5,"./url":6,backo2:7,"component-bind":8,"component-emitter":9,debug:10,"engine.io-client":11,indexof:42,"object-component":43,"socket.io-parser":46}],4:[function(n,t){function i(n,t,i){n.on(t,i);return{destroy:function(){n.removeListener(t,i)}}}t.exports=i},{}],5:[function(n,t,i){function r(n,t){this.io=n;this.nsp=t;this.json=this;this.ids=0;this.acks={};this.io.autoConnect&&this.open();this.receiveBuffer=[];this.sendBuffer=[];this.connected=!1;this.disconnected=!0}var u=n("socket.io-parser"),c=n("component-emitter"),o=n("to-array"),s=n("./on"),h=n("component-bind"),f=n("debug")("socket.io-client:socket"),l=n("has-binary"),a,e;t.exports=i=r;a={connect:1,connect_error:1,connect_timeout:1,disconnect:1,error:1,reconnect:1,reconnect_attempt:1,reconnect_failed:1,reconnect_error:1,reconnecting:1};e=c.prototype.emit;c(r.prototype);r.prototype.subEvents=function(){if(!this.subs){var n=this.io;this.subs=[s(n,"open",h(this,"onopen")),s(n,"packet",h(this,"onpacket")),s(n,"close",h(this,"onclose"))]}};r.prototype.open=r.prototype.connect=function(){return this.connected?this:(this.subEvents(),this.io.open(),"open"==this.io.readyState&&this.onopen(),this)};r.prototype.send=function(){var n=o(arguments);return n.unshift("message"),this.emit.apply(this,n),this};r.prototype.emit=function(n){var t,r,i;return a.hasOwnProperty(n)?(e.apply(this,arguments),this):(t=o(arguments),r=u.EVENT,l(t)&&(r=u.BINARY_EVENT),i={type:r,data:t},"function"==typeof t[t.length-1]&&(f("emitting packet with ack id %d",this.ids),this.acks[this.ids]=t.pop(),i.id=this.ids++),this.connected?this.packet(i):this.sendBuffer.push(i),this)};r.prototype.packet=function(n){n.nsp=this.nsp;this.io.packet(n)};r.prototype.onopen=function(){f("transport is open - connecting");"/"!=this.nsp&&this.packet({type:u.CONNECT})};r.prototype.onclose=function(n){f("close (%s)",n);this.connected=!1;this.disconnected=!0;delete this.id;this.emit("disconnect",n)};r.prototype.onpacket=function(n){if(n.nsp==this.nsp)switch(n.type){case u.CONNECT:this.onconnect();break;case u.EVENT:this.onevent(n);break;case u.BINARY_EVENT:this.onevent(n);break;case u.ACK:this.onack(n);break;case u.BINARY_ACK:this.onack(n);break;case u.DISCONNECT:this.ondisconnect();break;case u.ERROR:this.emit("error",n.data)}};r.prototype.onevent=function(n){var t=n.data||[];f("emitting event %j",t);null!=n.id&&(f("attaching ack callback to event"),t.push(this.ack(n.id)));this.connected?e.apply(this,t):this.receiveBuffer.push(t)};r.prototype.ack=function(n){var i=this,t=!1;return function(){var r,e;t||(t=!0,r=o(arguments),f("sending ack %j",r),e=l(r)?u.BINARY_ACK:u.ACK,i.packet({type:e,id:n,data:r}))}};r.prototype.onack=function(n){f("calling ack %s with %j",n.id,n.data);var t=this.acks[n.id];t.apply(this,n.data);delete this.acks[n.id]};r.prototype.onconnect=function(){this.connected=!0;this.disconnected=!1;this.emit("connect");this.emitBuffered()};r.prototype.emitBuffered=function(){for(var n=0;n<this.receiveBuffer.length;n++)e.apply(this,this.receiveBuffer[n]);for(this.receiveBuffer=[],n=0;n<this.sendBuffer.length;n++)this.packet(this.sendBuffer[n]);this.sendBuffer=[]};r.prototype.ondisconnect=function(){f("server disconnect (%s)",this.nsp);this.destroy();this.onclose("io server disconnect")};r.prototype.destroy=function(){if(this.subs){for(var n=0;n<this.subs.length;n++)this.subs[n].destroy();this.subs=null}this.io.destroy(this)};r.prototype.close=r.prototype.disconnect=function(){if(this.connected&&(f("performing disconnect (%s)",this.nsp),this.packet({type:u.DISCONNECT})),this.destroy(),this.connected)this.onclose("io client disconnect");return this}},{"./on":4,"component-bind":8,"component-emitter":9,debug:10,"has-binary":38,"socket.io-parser":46,"to-array":50}],6:[function(n,t){(function(i){function f(n,t){var f=n,t=t||i.location;return null==n&&(n=t.protocol+"//"+t.host),"string"==typeof n&&("/"==n.charAt(0)&&(n="/"==n.charAt(1)?t.protocol+n:t.hostname+n),/^(https?|wss?):\/\//.test(n)||(r("protocol-less url %s",n),n="undefined"!=typeof t?t.protocol+"//"+n:"https://"+n),r("parse %s",n),f=u(n)),f.port||(/^(http|ws)$/.test(f.protocol)?f.port="80":/^(http|ws)s$/.test(f.protocol)&&(f.port="443")),f.path=f.path||"/",f.id=f.protocol+"://"+f.host+":"+f.port,f.href=f.protocol+"://"+f.host+(t&&t.port==f.port?"":":"+f.port),f}var u=n("parseuri"),r=n("debug")("socket.io-client:url");t.exports=f}).call(this,typeof self!="undefined"?self:typeof window!="undefined"?window:{})},{debug:10,parseuri:44}],7:[function(n,t){function i(n){n=n||{};this.ms=n.min||100;this.max=n.max||1e4;this.factor=n.factor||2;this.jitter=n.jitter>0&&n.jitter<=1?n.jitter:0;this.attempts=0}t.exports=i;i.prototype.duration=function(){var n=this.ms*Math.pow(this.factor,this.attempts++),t,i;return this.jitter&&(t=Math.random(),i=Math.floor(t*this.jitter*n),n=(Math.floor(t*10)&1)==0?n-i:n+i),Math.min(n,this.max)|0};i.prototype.reset=function(){this.attempts=0};i.prototype.setMin=function(n){this.ms=n};i.prototype.setMax=function(n){this.max=n};i.prototype.setJitter=function(n){this.jitter=n}},{}],8:[function(n,t){var i=[].slice;t.exports=function(n,t){if("string"==typeof t&&(t=n[t]),"function"!=typeof t)throw new Error("bind() requires a function");var r=i.call(arguments,2);return function(){return t.apply(n,r.concat(i.call(arguments)))}}},{}],9:[function(n,t){function i(n){if(n)return r(n)}function r(n){for(var t in i.prototype)n[t]=i.prototype[t];return n}t.exports=i;i.prototype.on=i.prototype.addEventListener=function(n,t){return this._callbacks=this._callbacks||{},(this._callbacks[n]=this._callbacks[n]||[]).push(t),this};i.prototype.once=function(n,t){function i(){r.off(n,i);t.apply(this,arguments)}var r=this;this._callbacks=this._callbacks||{};i.fn=t;this.on(n,i);return this};i.prototype.off=i.prototype.removeListener=i.prototype.removeAllListeners=i.prototype.removeEventListener=function(n,t){var i,u,r;if(this._callbacks=this._callbacks||{},0==arguments.length)return this._callbacks={},this;if(i=this._callbacks[n],!i)return this;if(1==arguments.length)return delete this._callbacks[n],this;for(r=0;r<i.length;r++)if(u=i[r],u===t||u.fn===t){i.splice(r,1);break}return this};i.prototype.emit=function(n){var r,t,i,u;if(this._callbacks=this._callbacks||{},r=[].slice.call(arguments,1),t=this._callbacks[n],t)for(t=t.slice(0),i=0,u=t.length;i<u;++i)t[i].apply(this,r);return this};i.prototype.listeners=function(n){return this._callbacks=this._callbacks||{},this._callbacks[n]||[]};i.prototype.hasListeners=function(n){return!!this.listeners(n).length}},{}],10:[function(n,t){function i(n){return i.enabled(n)?function(t){t=r(t);var u=new Date,f=u-(i[n]||u);i[n]=u;t=n+" "+t+" +"+i.humanize(f);window.console&&console.log&&Function.prototype.apply.call(console.log,console,arguments)}:function(){}}function r(n){return n instanceof Error?n.stack||n.message:n}t.exports=i;i.names=[];i.skips=[];i.enable=function(n){var r,u,t;try{localStorage.debug=n}catch(f){}for(r=(n||"").split(/[\s,]+/),u=r.length,t=0;t<u;t++)n=r[t].replace("*",".*?"),n[0]==="-"?i.skips.push(new RegExp("^"+n.substr(1)+"$")):i.names.push(new RegExp("^"+n+"$"))};i.disable=function(){i.enable("")};i.humanize=function(n){var i=1e3,t=6e4,r=60*t;return n>=r?(n/r).toFixed(1)+"h":n>=t?(n/t).toFixed(1)+"m":n>=i?(n/i|0)+"s":n+"ms"};i.enabled=function(n){for(var t=0,r=i.skips.length;t<r;t++)if(i.skips[t].test(n))return!1;for(t=0,r=i.names.length;t<r;t++)if(i.names[t].test(n))return!0;return!1};try{window.localStorage&&i.enable(localStorage.debug)}catch(u){}},{}],11:[function(n,t){t.exports=n("lib/index.html")},{"./lib/":12}],12:[function(n,t){t.exports=n("./socket");t.exports.parser=n("engine.io-parser")},{"./socket":13,"engine.io-parser":25}],13:[function(n,t){(function(i){function r(n,t){if(!(this instanceof r))return new r(n,t);if(t=t||{},n&&"object"==typeof n&&(t=n,n=null),n&&(n=h(n),t.host=n.host,t.secure=n.protocol=="https"||n.protocol=="wss",t.port=n.port,n.query&&(t.query=n.query)),this.secure=null!=t.secure?t.secure:i.location&&"https:"==location.protocol,t.host){var u=t.host.split(":");t.hostname=u.shift();u.length?t.port=u.pop():t.port||(t.port=this.secure?"443":"80")}this.agent=t.agent||!1;this.hostname=t.hostname||(i.location?location.hostname:"localhost");this.port=t.port||(i.location&&location.port?location.port:this.secure?443:80);this.query=t.query||{};"string"==typeof this.query&&(this.query=l.decode(this.query));this.upgrade=!1!==t.upgrade;this.path=(t.path||"/engine.io").replace(/\/$/,"")+"/";this.forceJSONP=!!t.forceJSONP;this.jsonp=!1!==t.jsonp;this.forceBase64=!!t.forceBase64;this.enablesXDR=!!t.enablesXDR;this.timestampParam=t.timestampParam||"t";this.timestampRequests=t.timestampRequests;this.transports=t.transports||["polling","websocket"];this.readyState="";this.writeBuffer=[];this.callbackBuffer=[];this.policyPort=t.policyPort||843;this.rememberUpgrade=t.rememberUpgrade||!1;this.binaryType=null;this.onlyBinaryUpgrades=t.onlyBinaryUpgrades;this.pfx=t.pfx||null;this.key=t.key||null;this.passphrase=t.passphrase||null;this.cert=t.cert||null;this.ca=t.ca||null;this.ciphers=t.ciphers||null;this.rejectUnauthorized=t.rejectUnauthorized||null;this.open()}function a(n){var i={};for(var t in n)n.hasOwnProperty(t)&&(i[t]=n[t]);return i}var e=n("./transports"),o=n("component-emitter"),u=n("debug")("engine.io-client:socket"),s=n("indexof"),f=n("engine.io-parser"),h=n("parseuri"),c=n("parsejson"),l=n("parseqs");t.exports=r;r.priorWebsocketSuccess=!1;o(r.prototype);r.protocol=f.protocol;r.Socket=r;r.Transport=n("./transport");r.transports=n("./transports");r.parser=n("engine.io-parser");r.prototype.createTransport=function(n){var t;return u('creating transport "%s"',n),t=a(this.query),t.EIO=f.protocol,t.transport=n,this.id&&(t.sid=this.id),new e[n]({agent:this.agent,hostname:this.hostname,port:this.port,secure:this.secure,path:this.path,query:t,forceJSONP:this.forceJSONP,jsonp:this.jsonp,forceBase64:this.forceBase64,enablesXDR:this.enablesXDR,timestampRequests:this.timestampRequests,timestampParam:this.timestampParam,policyPort:this.policyPort,socket:this,pfx:this.pfx,key:this.key,passphrase:this.passphrase,cert:this.cert,ca:this.ca,ciphers:this.ciphers,rejectUnauthorized:this.rejectUnauthorized})};r.prototype.open=function(){var t,n;if(this.rememberUpgrade&&r.priorWebsocketSuccess&&this.transports.indexOf("websocket")!=-1)n="websocket";else{if(0==this.transports.length){t=this;setTimeout(function(){t.emit("error","No transports available")},0);return}n=this.transports[0]}this.readyState="opening";try{n=this.createTransport(n)}catch(i){this.transports.shift();this.open();return}n.open();this.setTransport(n)};r.prototype.setTransport=function(n){u("setting transport %s",n.name);var t=this;this.transport&&(u("clearing existing transport %s",this.transport.name),this.transport.removeAllListeners());this.transport=n;n.on("drain",function(){t.onDrain()}).on("packet",function(n){t.onPacket(n)}).on("error",function(n){t.onError(n)}).on("close",function(){t.onClose("transport close")})};r.prototype.probe=function(n){function o(){if(i.onlyBinaryUpgrades){var e=!this.supportsBinary&&i.transport.supportsBinary;f=f||e}if(!f){u('probe transport "%s" opened',n);t.send([{type:"ping",data:"probe"}]);t.once("packet",function(e){if(!f)if("pong"==e.type&&"probe"==e.data){if(u('probe transport "%s" pong',n),i.upgrading=!0,i.emit("upgrading",t),!t)return;r.priorWebsocketSuccess="websocket"==t.name;u('pausing current transport "%s"',i.transport.name);i.transport.pause(function(){f||"closed"!=i.readyState&&(u("changing transport and sending upgrade packet"),a(),i.setTransport(t),t.send([{type:"upgrade"}]),i.emit("upgrade",t),t=null,i.upgrading=!1,i.flush())})}else{u('probe transport "%s" failed',n);var o=new Error("probe error");o.transport=t.name;i.emit("upgradeError",o)}})}}function s(){f||(f=!0,a(),t.close(),t=null)}function e(r){var f=new Error("probe error: "+r);f.transport=t.name;s();u('probe transport "%s" failed because of error: %s',n,r);i.emit("upgradeError",f)}function h(){e("transport closed")}function c(){e("socket closed")}function l(n){t&&n.name!=t.name&&(u('"%s" works - aborting "%s"',n.name,t.name),s())}function a(){t.removeListener("open",o);t.removeListener("error",e);t.removeListener("close",h);i.removeListener("close",c);i.removeListener("upgrading",l)}u('probing transport "%s"',n);var t=this.createTransport(n,{probe:1}),f=!1,i=this;r.priorWebsocketSuccess=!1;t.once("open",o);t.once("error",e);t.once("close",h);this.once("close",c);this.once("upgrading",l);t.open()};r.prototype.onOpen=function(){if(u("socket open"),this.readyState="open",r.priorWebsocketSuccess="websocket"==this.transport.name,this.emit("open"),this.flush(),"open"==this.readyState&&this.upgrade&&this.transport.pause){u("starting upgrade probes");for(var n=0,t=this.upgrades.length;n<t;n++)this.probe(this.upgrades[n])}};r.prototype.onPacket=function(n){if("opening"==this.readyState||"open"==this.readyState){u('socket receive: type "%s", data "%s"',n.type,n.data);this.emit("packet",n);this.emit("heartbeat");switch(n.type){case"open":this.onHandshake(c(n.data));break;case"pong":this.setPing();break;case"error":var t=new Error("server error");t.code=n.data;this.emit("error",t);break;case"message":this.emit("data",n.data);this.emit("message",n.data)}}else u('packet received with socket readyState "%s"',this.readyState)};r.prototype.onHandshake=function(n){if(this.emit("handshake",n),this.id=n.sid,this.transport.query.sid=n.sid,this.upgrades=this.filterUpgrades(n.upgrades),this.pingInterval=n.pingInterval,this.pingTimeout=n.pingTimeout,this.onOpen(),"closed"!=this.readyState){this.setPing();this.removeListener("heartbeat",this.onHeartbeat);this.on("heartbeat",this.onHeartbeat)}};r.prototype.onHeartbeat=function(n){clearTimeout(this.pingTimeoutTimer);var t=this;t.pingTimeoutTimer=setTimeout(function(){if("closed"!=t.readyState)t.onClose("ping timeout")},n||t.pingInterval+t.pingTimeout)};r.prototype.setPing=function(){var n=this;clearTimeout(n.pingIntervalTimer);n.pingIntervalTimer=setTimeout(function(){u("writing ping packet - expecting pong within %sms",n.pingTimeout);n.ping();n.onHeartbeat(n.pingTimeout)},n.pingInterval)};r.prototype.ping=function(){this.sendPacket("ping")};r.prototype.onDrain=function(){for(var n=0;n<this.prevBufferLen;n++)this.callbackBuffer[n]&&this.callbackBuffer[n]();this.writeBuffer.splice(0,this.prevBufferLen);this.callbackBuffer.splice(0,this.prevBufferLen);this.prevBufferLen=0;this.writeBuffer.length==0?this.emit("drain"):this.flush()};r.prototype.flush=function(){"closed"!=this.readyState&&this.transport.writable&&!this.upgrading&&this.writeBuffer.length&&(u("flushing %d packets in socket",this.writeBuffer.length),this.transport.send(this.writeBuffer),this.prevBufferLen=this.writeBuffer.length,this.emit("flush"))};r.prototype.write=r.prototype.send=function(n,t){return this.sendPacket("message",n,t),this};r.prototype.sendPacket=function(n,t,i){if("closing"!=this.readyState&&"closed"!=this.readyState){var r={type:n,data:t};this.emit("packetCreate",r);this.writeBuffer.push(r);this.callbackBuffer.push(i);this.flush()}};r.prototype.close=function(){if("opening"==this.readyState||"open"==this.readyState){this.readyState="closing";var n=this;function i(){n.onClose("forced close");u("socket closing - telling transport to close");n.transport.close()}function t(){n.removeListener("upgrade",t);n.removeListener("upgradeError",t);i()}function r(){n.once("upgrade",t);n.once("upgradeError",t)}if(this.writeBuffer.length)this.once("drain",function(){this.upgrading?r():i()});else this.upgrading?r():i()}return this};r.prototype.onError=function(n){u("socket error %j",n);r.priorWebsocketSuccess=!1;this.emit("error",n);this.onClose("transport error",n)};r.prototype.onClose=function(n,t){if("opening"==this.readyState||"open"==this.readyState||"closing"==this.readyState){u('socket close with reason: "%s"',n);var i=this;clearTimeout(this.pingIntervalTimer);clearTimeout(this.pingTimeoutTimer);setTimeout(function(){i.writeBuffer=[];i.callbackBuffer=[];i.prevBufferLen=0},0);this.transport.removeAllListeners("close");this.transport.close();this.transport.removeAllListeners();this.readyState="closed";this.id=null;this.emit("close",n,t)}};r.prototype.filterUpgrades=function(n){for(var i=[],t=0,r=n.length;t<r;t++)~s(this.transports,n[t])&&i.push(n[t]);return i}}).call(this,typeof self!="undefined"?self:typeof window!="undefined"?window:{})},{"./transport":14,"./transports":15,"component-emitter":9,debug:22,"engine.io-parser":25,indexof:42,parsejson:34,parseqs:35,parseuri:36}],14:[function(n,t){function i(n){this.path=n.path;this.hostname=n.hostname;this.port=n.port;this.secure=n.secure;this.query=n.query;this.timestampParam=n.timestampParam;this.timestampRequests=n.timestampRequests;this.readyState="";this.agent=n.agent||!1;this.socket=n.socket;this.enablesXDR=n.enablesXDR;this.pfx=n.pfx;this.key=n.key;this.passphrase=n.passphrase;this.cert=n.cert;this.ca=n.ca;this.ciphers=n.ciphers;this.rejectUnauthorized=n.rejectUnauthorized}var r=n("engine.io-parser"),u=n("component-emitter");t.exports=i;u(i.prototype);i.timestamps=0;i.prototype.onError=function(n,t){var i=new Error(n);return i.type="TransportError",i.description=t,this.emit("error",i),this};i.prototype.open=function(){return("closed"==this.readyState||""==this.readyState)&&(this.readyState="opening",this.doOpen()),this};i.prototype.close=function(){return("opening"==this.readyState||"open"==this.readyState)&&(this.doClose(),this.onClose()),this};i.prototype.send=function(n){if("open"==this.readyState)this.write(n);else throw new Error("Transport not open");};i.prototype.onOpen=function(){this.readyState="open";this.writable=!0;this.emit("open")};i.prototype.onData=function(n){var t=r.decodePacket(n,this.socket.binaryType);this.onPacket(t)};i.prototype.onPacket=function(n){this.emit("packet",n)};i.prototype.onClose=function(){this.readyState="closed";this.emit("close")}},{"component-emitter":9,"engine.io-parser":25}],15:[function(n,t,i){(function(t){function o(n){var o,s=!1,h=!1,c=!1!==n.jsonp,e,i;if(t.location&&(e="https:"==location.protocol,i=location.port,i||(i=e?443:80),s=n.hostname!=location.hostname||i!=n.port,h=n.secure!=e),n.xdomain=s,n.xscheme=h,o=new r(n),"open"in o&&!n.forceJSONP)return new u(n);if(!c)throw new Error("JSONP disabled");return new f(n)}var r=n("xmlhttprequest"),u=n("./polling-xhr"),f=n("./polling-jsonp"),e=n("./websocket");i.polling=o;i.websocket=e}).call(this,typeof self!="undefined"?self:typeof window!="undefined"?window:{})},{"./polling-jsonp":16,"./polling-xhr":17,"./websocket":19,xmlhttprequest:20}],16:[function(n,t){(function(i){function h(){}function r(n){f.call(this,n);this.query=this.query||{};u||(i.___eio||(i.___eio=[]),u=i.___eio);this.index=u.length;var t=this;u.push(function(n){t.onData(n)});this.query.j=this.index;i.document&&i.addEventListener&&i.addEventListener("beforeunload",function(){t.script&&(t.script.onerror=h)},!1)}var f=n("./polling"),e=n("component-inherit");t.exports=r;var o=/\n/g,s=/\\n/g,u;e(r,f);r.prototype.supportsBinary=!1;r.prototype.doClose=function(){this.script&&(this.script.parentNode.removeChild(this.script),this.script=null);this.form&&(this.form.parentNode.removeChild(this.form),this.form=null,this.iframe=null);f.prototype.doClose.call(this)};r.prototype.doPoll=function(){var r=this,n=document.createElement("script"),t,i;this.script&&(this.script.parentNode.removeChild(this.script),this.script=null);n.async=!0;n.src=this.uri();n.onerror=function(n){r.onError("jsonp poll error",n)};t=document.getElementsByTagName("script")[0];t.parentNode.insertBefore(n,t);this.script=n;i="undefined"!=typeof navigator&&/gecko/i.test(navigator.userAgent);i&&setTimeout(function(){var n=document.createElement("iframe");document.body.appendChild(n);document.body.removeChild(n)},100)};r.prototype.doWrite=function(n,t){function e(){h();t()}function h(){if(i.iframe)try{i.form.removeChild(i.iframe)}catch(n){i.onError("jsonp polling iframe removal error",n)}try{var t='<iframe src="javascript:0" name="'+i.iframeId+'">';u=document.createElement(t)}catch(n){u=document.createElement("iframe");u.name=i.iframeId;u.src="javascript:0"}u.id=i.iframeId;i.form.appendChild(u);i.iframe=u}var i=this;if(!this.form){var r=document.createElement("form"),f=document.createElement("textarea"),c=this.iframeId="eio_iframe_"+this.index,u;r.className="socketio";r.style.position="absolute";r.style.top="-1000px";r.style.left="-1000px";r.target=c;r.method="POST";r.setAttribute("accept-charset","utf-8");f.name="d";r.appendChild(f);document.body.appendChild(r);this.form=r;this.area=f}this.form.action=this.uri();h();n=n.replace(s,"\\\n");this.area.value=n.replace(o,"\\n");try{this.form.submit()}catch(l){}this.iframe.attachEvent?this.iframe.onreadystatechange=function(){i.iframe.readyState=="complete"&&e()}:this.iframe.onload=e}}).call(this,typeof self!="undefined"?self:typeof window!="undefined"?window:{})},{"./polling":18,"component-inherit":21}],17:[function(n,t){(function(i){function o(){}function u(n){if(e.call(this,n),i.location){var r="https:"==location.protocol,t=location.port;t||(t=r?443:80);this.xd=n.hostname!=i.location.hostname||t!=n.port;this.xs=n.secure!=r}}function r(n){this.method=n.method||"GET";this.uri=n.uri;this.xd=!!n.xd;this.xs=!!n.xs;this.async=!1!==n.async;this.data=undefined!=n.data?n.data:null;this.agent=n.agent;this.isBinary=n.isBinary;this.supportsBinary=n.supportsBinary;this.enablesXDR=n.enablesXDR;this.pfx=n.pfx;this.key=n.key;this.passphrase=n.passphrase;this.cert=n.cert;this.ca=n.ca;this.ciphers=n.ciphers;this.rejectUnauthorized=n.rejectUnauthorized;this.create()}function s(){for(var n in r.requests)r.requests.hasOwnProperty(n)&&r.requests[n].abort()}var h=n("xmlhttprequest"),e=n("./polling"),c=n("component-emitter"),l=n("component-inherit"),f=n("debug")("engine.io-client:polling-xhr");t.exports=u;t.exports.Request=r;l(u,e);u.prototype.supportsBinary=!0;u.prototype.request=function(n){return n=n||{},n.uri=this.uri(),n.xd=this.xd,n.xs=this.xs,n.agent=this.agent||!1,n.supportsBinary=this.supportsBinary,n.enablesXDR=this.enablesXDR,n.pfx=this.pfx,n.key=this.key,n.passphrase=this.passphrase,n.cert=this.cert,n.ca=this.ca,n.ciphers=this.ciphers,n.rejectUnauthorized=this.rejectUnauthorized,new r(n)};u.prototype.doWrite=function(n,t){var r=typeof n!="string"&&n!==undefined,i=this.request({method:"POST",data:n,isBinary:r}),u=this;i.on("success",t);i.on("error",function(n){u.onError("xhr post error",n)});this.sendXhr=i};u.prototype.doPoll=function(){f("xhr poll");var n=this.request(),t=this;n.on("data",function(n){t.onData(n)});n.on("error",function(n){t.onError("xhr poll error",n)});this.pollXhr=n};c(r.prototype);r.prototype.create=function(){var t={agent:this.agent,xdomain:this.xd,xscheme:this.xs,enablesXDR:this.enablesXDR},n,u;t.pfx=this.pfx;t.key=this.key;t.passphrase=this.passphrase;t.cert=this.cert;t.ca=this.ca;t.ciphers=this.ciphers;t.rejectUnauthorized=this.rejectUnauthorized;n=this.xhr=new h(t);u=this;try{if(f("xhr open %s: %s",this.method,this.uri),n.open(this.method,this.uri,this.async),this.supportsBinary&&(n.responseType="arraybuffer"),"POST"==this.method)try{this.isBinary?n.setRequestHeader("Content-type","application/octet-stream"):n.setRequestHeader("Content-type","text/plain;charset=UTF-8")}catch(e){}"withCredentials"in n&&(n.withCredentials=!0);this.hasXDR()?(n.onload=function(){u.onLoad()},n.onerror=function(){u.onError(n.responseText)}):n.onreadystatechange=function(){4==n.readyState&&(200==n.status||1223==n.status?u.onLoad():setTimeout(function(){u.onError(n.status)},0))};f("xhr data %s",this.data);n.send(this.data)}catch(e){setTimeout(function(){u.onError(e)},0);return}i.document&&(this.index=r.requestsCount++,r.requests[this.index]=this)};r.prototype.onSuccess=function(){this.emit("success");this.cleanup()};r.prototype.onData=function(n){this.emit("data",n);this.onSuccess()};r.prototype.onError=function(n){this.emit("error",n);this.cleanup(!0)};r.prototype.cleanup=function(n){if("undefined"!=typeof this.xhr&&null!==this.xhr){if(this.hasXDR()?this.xhr.onload=this.xhr.onerror=o:this.xhr.onreadystatechange=o,n)try{this.xhr.abort()}catch(t){}i.document&&delete r.requests[this.index];this.xhr=null}};r.prototype.onLoad=function(){var n,t;try{try{t=this.xhr.getResponseHeader("Content-Type").split(";")[0]}catch(i){}n=t==="application/octet-stream"?this.xhr.response:this.supportsBinary?"ok":this.xhr.responseText}catch(i){this.onError(i)}if(null!=n)this.onData(n)};r.prototype.hasXDR=function(){return"undefined"!=typeof i.XDomainRequest&&!this.xs&&this.enablesXDR};r.prototype.abort=function(){this.cleanup()};i.document&&(r.requestsCount=0,r.requests={},i.attachEvent?i.attachEvent("onunload",s):i.addEventListener&&i.addEventListener("beforeunload",s,!1))}).call(this,typeof self!="undefined"?self:typeof window!="undefined"?window:{})},{"./polling":18,"component-emitter":9,"component-inherit":21,debug:22,xmlhttprequest:20}],18:[function(n,t){function r(n){var t=n&&n.forceBase64;(!e||t)&&(this.supportsBinary=!1);u.call(this,n)}var u=n("../transport"),o=n("parseqs"),f=n("engine.io-parser"),s=n("component-inherit"),i=n("debug")("engine.io-client:polling"),e;t.exports=r;e=function(){var t=n("xmlhttprequest"),i=new t({xdomain:!1});return null!=i.responseType}();s(r,u);r.prototype.name="polling";r.prototype.doOpen=function(){this.poll()};r.prototype.pause=function(n){function r(){i("paused");u.readyState="paused";n()}var u=this,t;if(this.readyState="pausing",this.polling||!this.writable){if(t=0,this.polling){i("we are currently polling - waiting to pause");t++;this.once("pollComplete",function(){i("pre-pause polling complete");--t||r()})}if(!this.writable){i("we are currently writing - waiting to pause");t++;this.once("drain",function(){i("pre-pause writing complete");--t||r()})}}else r()};r.prototype.poll=function(){i("polling");this.polling=!0;this.doPoll();this.emit("poll")};r.prototype.onData=function(n){var t=this,r;i("polling got data %s",n);r=function(n){if("opening"==t.readyState&&t.onOpen(),"close"==n.type)return t.onClose(),!1;t.onPacket(n)};f.decodePayload(n,this.socket.binaryType,r);"closed"!=this.readyState&&(this.polling=!1,this.emit("pollComplete"),"open"==this.readyState?this.poll():i('ignoring poll - transport state "%s"',this.readyState))};r.prototype.doClose=function(){function n(){i("writing close packet");t.write([{type:"close"}])}var t=this;if("open"==this.readyState)i("transport open - closing"),n();else{i("transport not open - deferring close");this.once("open",n)}};r.prototype.write=function(n){var t=this,i;this.writable=!1;i=function(){t.writable=!0;t.emit("drain")};t=this;f.encodePayload(n,this.supportsBinary,function(n){t.doWrite(n,i)})};r.prototype.uri=function(){var n=this.query||{},t=this.secure?"https":"http",i="";return!1!==this.timestampRequests&&(n[this.timestampParam]=+new Date+"-"+u.timestamps++),this.supportsBinary||n.sid||(n.b64=1),n=o.encode(n),this.port&&("https"==t&&this.port!=443||"http"==t&&this.port!=80)&&(i=":"+this.port),n.length&&(n="?"+n),t+"://"+this.hostname+i+this.path+n}},{"../transport":14,"component-inherit":21,debug:22,"engine.io-parser":25,parseqs:35,xmlhttprequest:20}],19:[function(n,t){function i(n){var t=n&&n.forceBase64;t&&(this.supportsBinary=!1);r.call(this,n)}var r=n("../transport"),f=n("engine.io-parser"),e=n("parseqs"),o=n("component-inherit"),s=n("debug")("engine.io-client:websocket"),u=n("ws");t.exports=i;o(i,r);i.prototype.name="websocket";i.prototype.supportsBinary=!0;i.prototype.doOpen=function(){if(this.check()){var i=this,t=this.uri(),n={agent:this.agent};n.pfx=this.pfx;n.key=this.key;n.passphrase=this.passphrase;n.cert=this.cert;n.ca=this.ca;n.ciphers=this.ciphers;n.rejectUnauthorized=this.rejectUnauthorized;this.ws=new u(t,void 0,n);this.ws.binaryType===undefined&&(this.supportsBinary=!1);this.ws.binaryType="arraybuffer";this.addEventListeners()}};i.prototype.addEventListeners=function(){var n=this;this.ws.onopen=function(){n.onOpen()};this.ws.onclose=function(){n.onClose()};this.ws.onmessage=function(t){n.onData(t.data)};this.ws.onerror=function(t){n.onError("websocket error",t)}};"undefined"!=typeof navigator&&/iPad|iPhone|iPod/i.test(navigator.userAgent)&&(i.prototype.onData=function(n){var t=this;setTimeout(function(){r.prototype.onData.call(t,n)},0)});i.prototype.write=function(n){function u(){i.writable=!0;i.emit("drain")}var i=this,t,r;for(this.writable=!1,t=0,r=n.length;t<r;t++)f.encodePacket(n[t],this.supportsBinary,function(n){try{i.ws.send(n)}catch(t){s("websocket closed before onclose event")}});setTimeout(u,0)};i.prototype.onClose=function(){r.prototype.onClose.call(this)};i.prototype.doClose=function(){typeof this.ws!="undefined"&&this.ws.close()};i.prototype.uri=function(){var n=this.query||{},t=this.secure?"wss":"ws",i="";return this.port&&("wss"==t&&this.port!=443||"ws"==t&&this.port!=80)&&(i=":"+this.port),this.timestampRequests&&(n[this.timestampParam]=+new Date),this.supportsBinary||(n.b64=1),n=e.encode(n),n.length&&(n="?"+n),t+"://"+this.hostname+i+this.path+n};i.prototype.check=function(){return!!u&&!("__initialize"in u&&this.name===i.prototype.name)}},{"../transport":14,"component-inherit":21,debug:22,"engine.io-parser":25,parseqs:35,ws:37}],20:[function(n,t){var i=n("has-cors");t.exports=function(n){var t=n.xdomain,r=n.xscheme,u=n.enablesXDR;try{if("undefined"!=typeof XMLHttpRequest&&(!t||i))return new XMLHttpRequest}catch(f){}try{if("undefined"!=typeof XDomainRequest&&!r&&u)return new XDomainRequest}catch(f){}if(!t)try{return new ActiveXObject("Microsoft.XMLHTTP")}catch(f){}}},{"has-cors":40}],21:[function(n,t){t.exports=function(n,t){var i=function(){};i.prototype=t.prototype;n.prototype=new i;n.prototype.constructor=n}},{}],22:[function(n,t,i){function u(){return"WebkitAppearance"in document.documentElement.style||window.console&&(console.firebug||console.exception&&console.table)||navigator.userAgent.toLowerCase().match(/firefox\/(\d+)/)&&parseInt(RegExp.$1,10)>=31}function f(){var n=arguments,t=this.useColors,r,u,f;return(n[0]=(t?"%c":"")+this.namespace+(t?" %c":" ")+n[0]+(t?"%c ":" ")+"+"+i.humanize(this.diff),!t)?n:(r="color: "+this.color,n=[n[0],r,"color: inherit"].concat(Array.prototype.slice.call(n,1)),u=0,f=0,n[0].replace(/%[a-z%]/g,function(n){"%"!==n&&(u++,"%c"===n&&(f=u))}),n.splice(f,0,r),n)}function e(){return"object"==typeof console&&"function"==typeof console.log&&Function.prototype.apply.call(console.log,console,arguments)}function o(n){try{null==n?localStorage.removeItem("debug"):localStorage.debug=n}catch(t){}}function r(){var n;try{n=localStorage.debug}catch(t){}return n}i=t.exports=n("./debug");i.log=e;i.formatArgs=f;i.save=o;i.load=r;i.useColors=u;i.colors=["lightseagreen","forestgreen","goldenrod","dodgerblue","darkorchid","crimson"];i.formatters.j=function(n){return JSON.stringify(n)};i.enable(r())},{"./debug":23}],23:[function(n,t,i){function f(){return i.colors[u++%i.colors.length]}function e(n){function u(){}function t(){var u=t,o=+new Date,h=o-(r||o),n,e,s;u.diff=h;u.prev=r;u.curr=o;r=o;null==u.useColors&&(u.useColors=i.useColors());null==u.color&&u.useColors&&(u.color=f());n=Array.prototype.slice.call(arguments);n[0]=i.coerce(n[0]);"string"!=typeof n[0]&&(n=["%o"].concat(n));e=0;n[0]=n[0].replace(/%([a-z%])/g,function(t,r){var f,o;return t==="%"?t:(e++,f=i.formatters[r],"function"==typeof f&&(o=n[e],t=f.call(u,o),n.splice(e,1),e--),t)});"function"==typeof i.formatArgs&&(n=i.formatArgs.apply(u,n));s=t.log||i.log||console.log.bind(console);s.apply(u,n)}u.enabled=!1;t.enabled=!0;var e=i.enabled(n)?t:u;return e.namespace=n,e}function o(n){var r,u,t;for(i.save(n),r=(n||"").split(/[\s,]+/),u=r.length,t=0;t<u;t++)r[t]&&(n=r[t].replace(/\*/g,".*?"),n[0]==="-"?i.skips.push(new RegExp("^"+n.substr(1)+"$")):i.names.push(new RegExp("^"+n+"$")))}function s(){i.enable("")}function h(n){for(var t=0,r=i.skips.length;t<r;t++)if(i.skips[t].test(n))return!1;for(t=0,r=i.names.length;t<r;t++)if(i.names[t].test(n))return!0;return!1}function c(n){return n instanceof Error?n.stack||n.message:n}i=t.exports=e;i.coerce=c;i.disable=s;i.enable=o;i.enabled=h;i.humanize=n("ms");i.names=[];i.skips=[];i.formatters={};var u=0,r},{ms:24}],24:[function(n,t){function s(n){var e=/^((?:\d+)?\.?\d+) *(ms|seconds?|s|minutes?|m|hours?|h|days?|d|years?|y)?$/i.exec(n),t,s;if(e){t=parseFloat(e[1]);s=(e[2]||"ms").toLowerCase();switch(s){case"years":case"year":case"y":return t*o;case"days":case"day":case"d":return t*f;case"hours":case"hour":case"h":return t*u;case"minutes":case"minute":case"m":return t*r;case"seconds":case"second":case"s":return t*i;case"ms":return t}}}function h(n){return n>=f?Math.round(n/f)+"d":n>=u?Math.round(n/u)+"h":n>=r?Math.round(n/r)+"m":n>=i?Math.round(n/i)+"s":n+"ms"}function c(n){return e(n,f,"day")||e(n,u,"hour")||e(n,r,"minute")||e(n,i,"second")||n+" ms"}function e(n,t,i){if(!(n<t))return n<t*1.5?Math.floor(n/t)+" "+i:Math.ceil(n/t)+" "+i+"s"}var i=1e3,r=i*60,u=r*60,f=u*24,o=f*365.25;t.exports=function(n,t){return(t=t||{},"string"==typeof n)?s(n):t.long?c(n):h(n)}},{}],25:[function(n,t,i){(function(t){function b(n,t){var r="b"+i.packets[n.type]+n.data.data;return t(r)}function k(n,t,r){var u;if(!t)return i.encodeBase64Packet(n,r);var e=n.data,s=new Uint8Array(e),f=new Uint8Array(1+e.byteLength);for(f[0]=o[n.type],u=0;u<s.length;u++)f[u+1]=s[u];return r(f.buffer)}function d(n,t,r){if(!t)return i.encodeBase64Packet(n,r);var u=new FileReader;return u.onload=function(){n.data=u.result;i.encodePacket(n,t,!0,r)},u.readAsArrayBuffer(n.data)}function g(n,t,u){var f,e;return t?c?d(n,t,u):(f=new Uint8Array(1),f[0]=o[n.type],e=new r([f.buffer,n.data]),u(e)):i.encodeBase64Packet(n,u)}function s(n,t,i){for(var u=new Array(n.length),f=y(n.length,i),e=function(n,i,r){t(i,function(t,i){u[n]=i;r(t,u)})},r=0;r<n.length;r++)e(r,n[r],f)}var l=n("./keys"),a=n("has-binary"),e=n("arraybuffer.slice"),v=n("base64-arraybuffer"),y=n("after"),h=n("utf8"),p=navigator.userAgent.match(/Android/i),w=/PhantomJS/i.test(navigator.userAgent),c=p||w;i.protocol=3;var o=i.packets={open:0,close:1,ping:2,pong:3,message:4,upgrade:5,noop:6},f=l(o),u={type:"error",data:"parser error"},r=n("blob");i.encodePacket=function(n,i,u,f){var e,s;return("function"==typeof i&&(f=i,i=!1),"function"==typeof u&&(f=u,u=null),e=n.data===undefined?undefined:n.data.buffer||n.data,t.ArrayBuffer&&e instanceof ArrayBuffer)?k(n,i,f):r&&e instanceof t.Blob?g(n,i,f):e&&e.base64?b(n,f):(s=o[n.type],undefined!==n.data&&(s+=u?h.encode(String(n.data)):String(n.data)),f(""+s))};i.encodeBase64Packet=function(n,u){var s="b"+i.packets[n.type],e,h,o,c,f;if(r&&n.data instanceof r)return e=new FileReader,e.onload=function(){var n=e.result.split(",")[1];u(s+n)},e.readAsDataURL(n.data);try{h=String.fromCharCode.apply(null,new Uint8Array(n.data))}catch(l){for(o=new Uint8Array(n.data),c=new Array(o.length),f=0;f<o.length;f++)c[f]=o[f];h=String.fromCharCode.apply(null,c)}return s+=t.btoa(h),u(s)};i.decodePacket=function(n,t,o){var s;if(typeof n=="string"||n===undefined){if(n.charAt(0)=="b")return i.decodeBase64Packet(n.substr(1),t);if(o)try{n=h.decode(n)}catch(a){return u}return(s=n.charAt(0),Number(s)!=s||!f[s])?u:n.length>1?{type:f[s],data:n.substring(1)}:{type:f[s]}}var l=new Uint8Array(n),s=l[0],c=e(n,1);return r&&t==="blob"&&(c=new r([c])),{type:f[s],data:c}};i.decodeBase64Packet=function(n,i){var e=f[n.charAt(0)],u;return t.ArrayBuffer?(u=v.decode(n.substr(1)),i==="blob"&&r&&(u=new r([u])),{type:e,data:u}):{type:e,data:{base64:!0,data:n.substr(1)}}};i.encodePayload=function(n,t,u){function e(n){return n.length+":"+n}function o(n,r){i.encodePacket(n,f?t:!1,!0,function(n){r(null,e(n))})}typeof t=="function"&&(u=t,t=null);var f=a(n);if(t&&f)return r&&!c?i.encodePayloadAsBlob(n,u):i.encodePayloadAsArrayBuffer(n,u);if(!n.length)return u("0:");s(n,o,function(n,t){return u(t.join(""))})};i.decodePayload=function(n,t,r){var o,f,s,h,e,c,l,a;if(typeof n!="string")return i.decodePayloadAsBinary(n,t,r);if(typeof t=="function"&&(r=t,t=null),n=="")return r(u,0,1);for(f="",e=0,c=n.length;e<c;e++)if(l=n.charAt(e),":"!=l)f+=l;else{if(""==f||f!=(s=Number(f))||(h=n.substr(e+1,s),f!=h.length))return r(u,0,1);if(h.length){if(o=i.decodePacket(h,t,!0),u.type==o.type&&u.data==o.data)return r(u,0,1);if(a=r(o,e+s,c),!1===a)return}e+=s;f=""}if(f!="")return r(u,0,1)};i.encodePayloadAsArrayBuffer=function(n,t){function r(n,t){i.encodePacket(n,!0,!0,function(n){return t(null,n)})}if(!n.length)return t(new ArrayBuffer(0));s(n,r,function(n,i){var f=i.reduce(function(n,t){var i;return i=typeof t=="string"?t.length:t.byteLength,n+i.toString().length+i+2},0),r=new Uint8Array(f),u=0;return i.forEach(function(n){var o=typeof n=="string",f=n,e,i,t;if(o){for(i=new Uint8Array(n.length),t=0;t<n.length;t++)i[t]=n.charCodeAt(t);f=i.buffer}for(r[u++]=o?0:1,e=f.byteLength.toString(),t=0;t<e.length;t++)r[u++]=parseInt(e[t]);for(r[u++]=255,i=new Uint8Array(f),t=0;t<i.length;t++)r[u++]=i[t]}),t(r.buffer)})};i.encodePayloadAsBlob=function(n,t){function u(n,t){i.encodePacket(n,!0,!0,function(n){var f=new Uint8Array(1),e,i,s;if(f[0]=1,typeof n=="string"){for(e=new Uint8Array(n.length),i=0;i<n.length;i++)e[i]=n.charCodeAt(i);n=e.buffer;f[0]=0}var h=n instanceof ArrayBuffer?n.byteLength:n.size,u=h.toString(),o=new Uint8Array(u.length+1);for(i=0;i<u.length;i++)o[i]=parseInt(u[i]);o[u.length]=255;r&&(s=new r([f.buffer,o.buffer,n]),t(null,s))})}s(n,u,function(n,i){return t(new r(i))})};i.decodePayloadAsBinary=function(n,t,r){var h,a,f,y;typeof t=="function"&&(r=t,t=null);for(var o=n,c=[],v=!1;o.byteLength>0;){var l=new Uint8Array(o),p=l[0]===0,s="";for(f=1;;f++){if(l[f]==255)break;if(s.length>310){v=!0;break}s+=l[f]}if(v)return r(u,0,1);if(o=e(o,2+s.length),s=parseInt(s),h=e(o,0,s),p)try{h=String.fromCharCode.apply(null,new Uint8Array(h))}catch(w){for(a=new Uint8Array(h),h="",f=0;f<a.length;f++)h+=String.fromCharCode(a[f])}c.push(h);o=e(o,s)}y=c.length;c.forEach(function(n,u){r(i.decodePacket(n,t,!0),u,y)})}}).call(this,typeof self!="undefined"?self:typeof window!="undefined"?window:{})},{"./keys":26,after:27,"arraybuffer.slice":28,"base64-arraybuffer":29,blob:30,"has-binary":31,utf8:33}],26:[function(n,t){t.exports=Object.keys||function(n){var t=[],r=Object.prototype.hasOwnProperty;for(var i in n)r.call(n,i)&&t.push(i);return t}},{}],27:[function(n,t){function i(n,t,i){function u(n,r){if(u.count<=0)throw new Error("after called too many times");--u.count;n?(f=!0,t(n),t=i):u.count!==0||f||t(null,r)}var f=!1;return i=i||r,u.count=n,n===0?t():u}function r(){}t.exports=i},{}],28:[function(n,t){t.exports=function(n,t,i){var r=n.byteLength,o,f,u,e;if(t=t||0,i=i||r,n.slice)return n.slice(t,i);if(t<0&&(t+=r),i<0&&(i+=r),i>r&&(i=r),t>=r||t>=i||r===0)return new ArrayBuffer(0);for(o=new Uint8Array(n),f=new Uint8Array(i-t),u=t,e=0;u<i;u++,e++)f[e]=o[u];return f.buffer}},{}],29:[function(n,t,i){(function(n){"use strict";i.encode=function(t){for(var u=new Uint8Array(t),f=u.length,i="",r=0;r<f;r+=3)i+=n[u[r]>>2],i+=n[(u[r]&3)<<4|u[r+1]>>4],i+=n[(u[r+1]&15)<<2|u[r+2]>>6],i+=n[u[r+2]&63];return f%3==2?i=i.substring(0,i.length-1)+"=":f%3==1&&(i=i.substring(0,i.length-2)+"=="),i};i.decode=function(t){var u=t.length*.75,l=t.length,i,f=0,h,e,o,c,s,r;for(t[t.length-1]==="="&&(u--,t[t.length-2]==="="&&u--),s=new ArrayBuffer(u),r=new Uint8Array(s),i=0;i<l;i+=4)h=n.indexOf(t[i]),e=n.indexOf(t[i+1]),o=n.indexOf(t[i+2]),c=n.indexOf(t[i+3]),r[f++]=h<<2|e>>4,r[f++]=(e&15)<<4|o>>2,r[f++]=(o&3)<<6|c&63;return s}})("ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789%2b/index.html")},{}],30:[function(n,t){(function(n){function f(n,t){var r,u;for(t=t||{},r=new i,u=0;u<n.length;u++)r.append(n[u]);return t.type?r.getBlob(t.type):r.getBlob()}var i=n.BlobBuilder||n.WebKitBlobBuilder||n.MSBlobBuilder||n.MozBlobBuilder,r=function(){try{var n=new Blob(["hi"]);return n.size==2}catch(t){return!1}}(),u=i&&i.prototype.append&&i.prototype.getBlob;t.exports=function(){return r?n.Blob:u?f:undefined}()}).call(this,typeof self!="undefined"?self:typeof window!="undefined"?window:{})},{}],31:[function(n,t){(function(i){function u(n){function t(n){var u,f;if(!n)return!1;if(i.Buffer&&i.Buffer.isBuffer(n)||i.ArrayBuffer&&n instanceof ArrayBuffer||i.Blob&&n instanceof Blob||i.File&&n instanceof File)return!0;if(r(n)){for(u=0;u<n.length;u++)if(t(n[u]))return!0}else if(n&&"object"==typeof n){n.toJSON&&(n=n.toJSON());for(f in n)if(n.hasOwnProperty(f)&&t(n[f]))return!0}return!1}return t(n)}var r=n("isarray");t.exports=u}).call(this,typeof self!="undefined"?self:typeof window!="undefined"?window:{})},{isarray:32}],32:[function(n,t){t.exports=Array.isArray||function(n){return Object.prototype.toString.call(n)=="[object Array]"}},{}],33:[function(t,i,r){(function(t){
/*! http://mths.be/utf8js v2.0.0 by @mathias */
(function(u){function w(n){for(var r=[],i=0,f=n.length,t,u;i<f;)t=n.charCodeAt(i++),t>=55296&&t<=56319&&i<f?(u=n.charCodeAt(i++),(u&64512)==56320?r.push(((t&1023)<<10)+(u&1023)+65536):(r.push(t),i--)):r.push(t);return r}function d(n){for(var u=n.length,r=-1,t,i="";++r<u;)t=n[r],t>65535&&(t-=65536,i+=f(t>>>10&1023|55296),t=56320|t&1023),i+=f(t);return i}function y(n,t){return f(n>>t&63|128)}function g(n){if((n&4294967168)==0)return f(n);var t="";return(n&4294965248)==0?t=f(n>>6&31|192):(n&4294901760)==0?t=f(n>>12&15|224)+y(n,6):(n&4292870144)==0&&(t=f(n>>18&7|240),t+=y(n,12),t+=y(n,6)),t+f(n&63|128)}function nt(n){for(var t=w(n),f=t.length,i=-1,r,u="";++i<f;)r=t[i],u+=g(r);return u}function s(){if(e>=a)throw Error("Invalid byte index");var n=l[e]&255;if(e++,(n&192)==128)return n&63;throw Error("Invalid continuation byte");}function tt(){var t,r,u,n,i;if(e>a)throw Error("Invalid byte index");if(e==a)return!1;if(t=l[e]&255,e++,(t&128)==0)return t;if((t&224)==192){if(i=s(),n=(t&31)<<6|i,n>=128)return n;throw Error("Invalid continuation byte");}if((t&240)==224){if(i=s(),r=s(),n=(t&15)<<12|i<<6|r,n>=2048)return n;throw Error("Invalid continuation byte");}if((t&248)==240&&(i=s(),r=s(),u=s(),n=(t&15)<<18|i<<12|r<<6|u,n>=65536&&n<=1114111))return n;throw Error("Invalid UTF-8 detected");}function it(n){l=w(n);a=l.length;e=0;for(var t=[],i;(i=tt())!==!1;)t.push(i);return d(t)}var c=typeof r=="object"&&r,p=typeof i=="object"&&i&&i.exports==c&&i,h=typeof t=="object"&&t,f,l,a,e,o,b,k,v;if((h.global===h||h.window===h)&&(u=h),f=String.fromCharCode,o={version:"2.0.0",encode:nt,decode:it},typeof n=="function"&&typeof n.amd=="object"&&n.amd)n(function(){return o});else if(c&&!c.nodeType)if(p)p.exports=o;else{b={};k=b.hasOwnProperty;for(v in o)k.call(o,v)&&(c[v]=o[v])}else u.utf8=o})(this)}).call(this,typeof self!="undefined"?self:typeof window!="undefined"?window:{})},{}],34:[function(n,t){(function(n){var i=/^[\],:{}\s]*$/,r=/\\(?:["\\\/bfnrt]|u[0-9a-fA-F]{4})/g,u=/"[^"\\\n\r]*"|true|false|null|-?\d+(?:\.\d*)?(?:[eE][+\-]?\d+)?/g,f=/(?:^|:|,)(?:\s*\[)+/g,e=/^\s+/,o=/\s+$/;t.exports=function(t){return"string"!=typeof t||!t?null:(t=t.replace(e,"").replace(o,""),n.JSON&&JSON.parse)?JSON.parse(t):i.test(t.replace(r,"@").replace(u,"]").replace(f,""))?new Function("return "+t)():void 0}}).call(this,typeof self!="undefined"?self:typeof window!="undefined"?window:{})},{}],35:[function(n,t,i){i.encode=function(n){var t="";for(var i in n)n.hasOwnProperty(i)&&(t.length&&(t+="&"),t+=encodeURIComponent(i)+"="+encodeURIComponent(n[i]));return t};i.decode=function(n){for(var i,r={},u=n.split("&"),t=0,f=u.length;t<f;t++)i=u[t].split("="),r[decodeURIComponent(i[0])]=decodeURIComponent(i[1]);return r}},{}],36:[function(n,t){var i=/^(?:(?![^:@]+:[^:@\/]*@)(http|https|ws|wss):\/\/)?((?:(([^:@]*)(?::([^:@]*))?)?@)?((?:[a-f0-9]{0,4}:){2,7}[a-f0-9]{0,4}|[^:\/?#]*)(?::(\d*))?)(((\/(?:[^?#](?![^?#\/]*\.[^?#\/.]+(?:[?#]|$)))*\/?)?([^?#\/]*))(?:\?([^#]*))?(?:#(.*))?)/,r=["source","protocol","authority","userInfo","user","password","host","port","relative","path","directory","file","query","anchor"];t.exports=function(n){var o=n,u=n.indexOf("["),f=n.indexOf("]");u!=-1&&f!=-1&&(n=n.substring(0,u)+n.substring(u,f).replace(/:/g,";")+n.substring(f,n.length));for(var s=i.exec(n||""),t={},e=14;e--;)t[r[e]]=s[e]||"";return u!=-1&&f!=-1&&(t.source=o,t.host=t.host.substring(1,t.host.length-1).replace(/;/g,":"),t.authority=t.authority.replace("[","").replace("]","").replace(/;/g,":"),t.ipv6uri=!0),t}},{}],37:[function(n,t){function u(n,t){return t?new i(n,t):new i(n)}var r=function(){return this}(),i=r.WebSocket||r.MozWebSocket;t.exports=i?u:null;i&&(u.prototype=i.prototype)},{}],38:[function(n,t){(function(i){function u(n){function t(n){var u,f;if(!n)return!1;if(i.Buffer&&i.Buffer.isBuffer(n)||i.ArrayBuffer&&n instanceof ArrayBuffer||i.Blob&&n instanceof Blob||i.File&&n instanceof File)return!0;if(r(n)){for(u=0;u<n.length;u++)if(t(n[u]))return!0}else if(n&&"object"==typeof n){n.toJSON&&(n=n.toJSON());for(f in n)if(Object.prototype.hasOwnProperty.call(n,f)&&t(n[f]))return!0}return!1}return t(n)}var r=n("isarray");t.exports=u}).call(this,typeof self!="undefined"?self:typeof window!="undefined"?window:{})},{isarray:39}],39:[function(n,t){t.exports=n(32)},{}],40:[function(n,t){var i=n("global");try{t.exports="XMLHttpRequest"in i&&"withCredentials"in new i.XMLHttpRequest}catch(r){t.exports=!1}},{global:41}],41:[function(n,t){t.exports=function(){return this}()},{}],42:[function(n,t){var i=[].indexOf;t.exports=function(n,t){if(i)return n.indexOf(t);for(var r=0;r<n.length;++r)if(n[r]===t)return r;return-1}},{}],43:[function(n,t,i){var r=Object.prototype.hasOwnProperty;i.keys=Object.keys||function(n){var t=[];for(var i in n)r.call(n,i)&&t.push(i);return t};i.values=function(n){var t=[];for(var i in n)r.call(n,i)&&t.push(n[i]);return t};i.merge=function(n,t){for(var i in t)r.call(t,i)&&(n[i]=t[i]);return n};i.length=function(n){return i.keys(n).length};i.isEmpty=function(n){return 0==i.length(n)}},{}],44:[function(n,t){var i=/^(?:(?![^:@]+:[^:@\/]*@)(http|https|ws|wss):\/\/)?((?:(([^:@]*)(?::([^:@]*))?)?@)?((?:[a-f0-9]{0,4}:){2,7}[a-f0-9]{0,4}|[^:\/?#]*)(?::(\d*))?)(((\/(?:[^?#](?![^?#\/]*\.[^?#\/.]+(?:[?#]|$)))*\/?)?([^?#\/]*))(?:\?([^#]*))?(?:#(.*))?)/,r=["source","protocol","authority","userInfo","user","password","host","port","relative","path","directory","file","query","anchor"];t.exports=function(n){for(var f=i.exec(n||""),u={},t=14;t--;)u[r[t]]=f[t]||"";return u}},{}],45:[function(n,t,i){(function(t){var r=n("isarray"),u=n("./is-buffer");i.deconstructPacket=function(n){function i(n){var s,e,f,o;if(!n)return n;if(u(n))return s={_placeholder:!0,num:t.length},t.push(n),s;if(r(n)){for(f=new Array(n.length),e=0;e<n.length;e++)f[e]=i(n[e]);return f}if("object"==typeof n&&!(n instanceof Date)){f={};for(o in n)f[o]=i(n[o]);return f}return n}var t=[],e=n.data,f=n;return f.data=i(e),f.attachments=t.length,{packet:f,buffers:t}};i.reconstructPacket=function(n,t){function i(n){var u,f;if(n&&n._placeholder)return t[n.num];if(r(n)){for(u=0;u<n.length;u++)n[u]=i(n[u]);return n}if(n&&"object"==typeof n){for(f in n)n[f]=i(n[f]);return n}return n}return n.data=i(n.data),n.attachments=undefined,n};i.removeBlobs=function(n,i){function e(n,s,h){var l,c,a;if(!n)return n;if(t.Blob&&n instanceof Blob||t.File&&n instanceof File)o++,l=new FileReader,l.onload=function(){h?h[s]=this.result:f=this.result;--o||i(f)},l.readAsArrayBuffer(n);else if(r(n))for(c=0;c<n.length;c++)e(n[c],c,n);else if(n&&"object"==typeof n&&!u(n))for(a in n)e(n[a],a,n)}var o=0,f=n;e(f);o||i(f)}}).call(this,typeof self!="undefined"?self:typeof window!="undefined"?window:{})},{"./is-buffer":47,isarray:48}],46:[function(n,t,i){function s(){}function h(n){var t="",r=!1;return t+=n.type,(i.BINARY_EVENT==n.type||i.BINARY_ACK==n.type)&&(t+=n.attachments,t+="-"),n.nsp&&"/"!=n.nsp&&(r=!0,t+=n.nsp),null!=n.id&&(r&&(t+=",",r=!1),t+=n.id),null!=n.data&&(r&&(t+=","),t+=o.stringify(n.data)),u("encoded %j as %s",n,t),t}function v(n,t){function i(n){var i=f.deconstructPacket(n),u=h(i.packet),r=i.buffers;r.unshift(u);t(r)}f.removeBlobs(n,i)}function r(){this.reconstructor=null}function y(n){var r={},t=0,e,s,f;if(r.type=Number(n.charAt(0)),null==i.types[r.type])return c();if(i.BINARY_EVENT==r.type||i.BINARY_ACK==r.type){for(e="";n.charAt(++t)!="-";)if(e+=n.charAt(t),t==n.length)break;if(e!=Number(e)||n.charAt(t)!="-")throw new Error("Illegal attachments");r.attachments=Number(e)}if("/"==n.charAt(t+1))for(r.nsp="";++t;){if(f=n.charAt(t),","==f)break;if(r.nsp+=f,t==n.length)break}else r.nsp="index.html";if(s=n.charAt(t+1),""!==s&&Number(s)==s){for(r.id="";++t;){if(f=n.charAt(t),null==f||Number(f)!=f){--t;break}if(r.id+=n.charAt(t),t==n.length)break}r.id=Number(r.id)}if(n.charAt(++t))try{r.data=o.parse(n.substr(t))}catch(h){return c()}return u("decoded %s as %j",n,r),r}function e(n){this.reconPack=n;this.buffers=[]}function c(){return{type:i.ERROR,data:"parser error"}}var u=n("debug")("socket.io-parser"),o=n("json3"),p=n("isarray"),l=n("component-emitter"),f=n("./binary"),a=n("./is-buffer");i.protocol=4;i.types=["CONNECT","DISCONNECT","EVENT","BINARY_EVENT","ACK","BINARY_ACK","ERROR"];i.CONNECT=0;i.DISCONNECT=1;i.EVENT=2;i.ACK=3;i.ERROR=4;i.BINARY_EVENT=5;i.BINARY_ACK=6;i.Encoder=s;i.Decoder=r;s.prototype.encode=function(n,t){if(u("encoding packet %j",n),i.BINARY_EVENT==n.type||i.BINARY_ACK==n.type)v(n,t);else{var r=h(n);t([r])}};l(r.prototype);r.prototype.add=function(n){var t;if("string"==typeof n)t=y(n),i.BINARY_EVENT==t.type||i.BINARY_ACK==t.type?(this.reconstructor=new e(t),this.reconstructor.reconPack.attachments===0&&this.emit("decoded",t)):this.emit("decoded",t);else if(a(n)||n.base64)if(this.reconstructor)t=this.reconstructor.takeBinaryData(n),t&&(this.reconstructor=null,this.emit("decoded",t));else throw new Error("got binary data when not reconstructing a packet");else throw new Error("Unknown type: "+n);};r.prototype.destroy=function(){this.reconstructor&&this.reconstructor.finishedReconstruction()};e.prototype.takeBinaryData=function(n){if(this.buffers.push(n),this.buffers.length==this.reconPack.attachments){var t=f.reconstructPacket(this.reconPack,this.buffers);return this.finishedReconstruction(),t}return null};e.prototype.finishedReconstruction=function(){this.reconPack=null;this.buffers=[]}},{"./binary":45,"./is-buffer":47,"component-emitter":9,debug:10,isarray:48,json3:49}],47:[function(n,t){(function(n){function i(t){return n.Buffer&&n.Buffer.isBuffer(t)||n.ArrayBuffer&&t instanceof ArrayBuffer}t.exports=i}).call(this,typeof self!="undefined"?self:typeof window!="undefined"?window:{})},{}],48:[function(n,t){t.exports=n(32)},{}],49:[function(t,i,r){
/*! JSON v3.2.6 | http://bestiejs.github.io/json3 | Copyright 2012-2013, Kit Cambridge | http://kit.mit-license.org */
(function(t){function c(n){var e,i,a,t,l,u,r;if(c[n]!==s)return c[n];if(n=="bug-string-char-index")e="a"[0]!="a";else if(n=="json")e=c("json-stringify")&&c("json-parse");else{if(a='{"a":[1,true,false,null,"\\u0000\\b\\n\\f\\r\\t"]}',n=="json-stringify"){if(t=h.stringify,l=typeof t=="function"&&o,l){(i=function(){return 1}).toJSON=i;try{l=t(0)==="0"&&t(new Number)==="0"&&t(new String)=='""'&&t(f)===s&&t(s)===s&&t()===s&&t(i)==="1"&&t([i])=="[1]"&&t([s])=="[null]"&&t(null)=="null"&&t([s,f,null])=="[null,null,null]"&&t({a:[i,!0,!1,null,"\x00\b\n\f\r\t"]})==a&&t(null,i)==="1"&&t([1,2],null,1)=="[\n 1,\n 2\n]"&&t(new Date(-864e13))=='"-271821-04-20T00:00:00.000Z"'&&t(new Date(864e13))=='"+275760-09-13T00:00:00.000Z"'&&t(new Date(-621987552e5))=='"-000001-01-01T00:00:00.000Z"'&&t(new Date(-1))=='"1969-12-31T23:59:59.999Z"'}catch(v){l=!1}}e=l}if(n=="json-parse"){if(u=h.parse,typeof u=="function")try{if(u("0")===0&&!u(!1)&&(i=u(a),r=i.a.length==5&&i.a[0]===1,r)){try{r=!u('"\t"')}catch(v){}if(r)try{r=u("01")!==1}catch(v){}if(r)try{r=u("1.")!==1}catch(v){}}}catch(v){r=!1}e=r}}return c[n]=!!e}var f={}.toString,e,y,s,ht=typeof n=="function"&&n.amd,k=typeof JSON=="object"&&JSON,h=typeof r=="object"&&r&&!r.nodeType&&r,o,ut,ft;h&&k?(h.stringify=k.stringify,h.parse=k.parse):h=t.JSON=k||{};o=new Date(-0xc782b5b800cec);try{o=o.getUTCFullYear()==-109252&&o.getUTCMonth()===0&&o.getUTCDate()===1&&o.getUTCHours()==10&&o.getUTCMinutes()==37&&o.getUTCSeconds()==6&&o.getUTCMilliseconds()==708}catch(kt){}if(!c("json")){var p="[object Function]",ct="[object Date]",d="[object Number]",g="[object String]",nt="[object Array]",lt="[object Boolean]",w=c("bug-string-char-index");if(!o)var l=Math.floor,at=[0,31,59,90,120,151,181,212,243,273,304,334],b=function(n,t){return at[t]+365*(n-1970)+l((n-1969+(t=+(t>1)))/4)-l((n-1901+t)/100)+l((n-1601+t)/400)};if((e={}.hasOwnProperty)||(e=function(n){var t={},i;return(t.__proto__=null,t.__proto__={toString:1},t).toString!=f?e=function(n){var t=this.__proto__,i=n in(this.__proto__=null,this);return this.__proto__=t,i}:(i=t.constructor,e=function(n){var t=(this.constructor||i).prototype;return n in this&&!(n in t&&this[n]===t[n])}),t=null,e.call(this,n)}),ut={boolean:1,number:1,string:1,undefined:1},ft=function(n,t){var i=typeof n[t];return i=="object"?!!n[t]:!ut[i]},y=function(n,t){var r=0,u,i,o;(u=function(){this.valueOf=0}).prototype.valueOf=0;i=new u;for(o in i)e.call(i,o)&&r++;return u=i=null,r?y=r==2?function(n,t){var r={},u=f.call(n)==p;for(var i in n)u&&i=="prototype"||e.call(r,i)||!(r[i]=1)||!e.call(n,i)||t(i)}:function(n,t){var u=f.call(n)==p,i,r;for(i in n)u&&i=="prototype"||!e.call(n,i)||(r=i==="constructor")||t(i);(r||e.call(n,i="constructor"))&&t(i)}:(i=["valueOf","toString","toLocaleString","propertyIsEnumerable","isPrototypeOf","hasOwnProperty","constructor"],y=function(n,t){var u=f.call(n)==p,r,o,s=!u&&typeof n.constructor!="function"&&ft(n,"hasOwnProperty")?n.hasOwnProperty:e;for(r in n)u&&r=="prototype"||!s.call(n,r)||t(r);for(o=i.length;r=i[--o];s.call(n,r)&&t(r));}),y(n,t)},!c("json-stringify")){var vt={92:"\\\\",34:'\\"',8:"\\b",12:"\\f",10:"\\n",13:"\\r",9:"\\t"},yt="000000",a=function(n,t){return(yt+(t||0)).slice(-n)},pt="\\u00",et=function(n){var r='"',t=0,u=n.length,f=u>10&&w,e,i;for(f&&(e=n.split(""));t<u;t++){i=n.charCodeAt(t);switch(i){case 8:case 9:case 10:case 12:case 13:case 34:case 92:r+=vt[i];break;default:if(i<32){r+=pt+a(2,i.toString(16));break}r+=f?e[t]:w?n.charAt(t):n[t]}}return r+'"'},it=function(n,t,i,r,u,o,h){var c,p,v,tt,w,rt,ot,st,ht,at,k,vt,ft,ut,yt,pt;try{c=t[n]}catch(wt){}if(typeof c=="object"&&c)if(p=f.call(c),p!=ct||e.call(c,"toJSON"))typeof c.toJSON=="function"&&(p!=d&&p!=g&&p!=nt||e.call(c,"toJSON"))&&(c=c.toJSON(n));else if(c>-1/0&&c<1/0){if(b){for(w=l(c/864e5),v=l(w/365.2425)+1970-1;b(v+1,0)<=w;v++);for(tt=l((w-b(v,0))/30.42);b(v,tt+1)<=w;tt++);w=1+w-b(v,tt);rt=(c%864e5+864e5)%864e5;ot=l(rt/36e5)%24;st=l(rt/6e4)%60;ht=l(rt/1e3)%60;at=rt%1e3}else v=c.getUTCFullYear(),tt=c.getUTCMonth(),w=c.getUTCDate(),ot=c.getUTCHours(),st=c.getUTCMinutes(),ht=c.getUTCSeconds(),at=c.getUTCMilliseconds();c=(v<=0||v>=1e4?(v<0?"-":"+")+a(6,v<0?-v:v):a(4,v))+"-"+a(2,tt+1)+"-"+a(2,w)+"T"+a(2,ot)+":"+a(2,st)+":"+a(2,ht)+"."+a(3,at)+"Z"}else c=null;if(i&&(c=i.call(t,n,c)),c===null)return"null";if(p=f.call(c),p==lt)return""+c;if(p==d)return c>-1/0&&c<1/0?""+c:"null";if(p==g)return et(""+c);if(typeof c=="object"){for(ut=h.length;ut--;)if(h[ut]===c)throw TypeError();if(h.push(c),k=[],yt=o,o+=u,p==nt){for(ft=0,ut=c.length;ft<ut;ft++)vt=it(ft,c,i,r,u,o,h),k.push(vt===s?"null":vt);pt=k.length?u?"[\n"+o+k.join(",\n"+o)+"\n"+yt+"]":"["+k.join(",")+"]":"[]"}else y(r||c,function(n){var t=it(n,c,i,r,u,o,h);t!==s&&k.push(et(n)+":"+(u?" ":"")+t)}),pt=k.length?u?"{\n"+o+k.join(",\n"+o)+"\n"+yt+"}":"{"+k.join(",")+"}":"{}";return h.pop(),pt}};h.stringify=function(n,t,i){var e,h,o,r,s,c,u;if(typeof t=="function"||typeof t=="object"&&t)if((r=f.call(t))==p)h=t;else if(r==nt)for(o={},s=0,c=t.length;s<c;u=t[s++],(r=f.call(u),r==g||r==d)&&(o[u]=1));if(i)if((r=f.call(i))==d){if((i-=i%1)>0)for(e="",i>10&&(i=10);e.length<i;e+=" ");}else r==g&&(e=i.length<=10?i:i.slice(0,10));return it("",(u={},u[""]=n,u),h,o,e,"",[])}}if(!c("json-parse")){var wt=String.fromCharCode,bt={92:"\\",34:'"',47:"/",98:"\b",116:"\t",110:"\n",102:"\f",114:"\r"},i,tt,u=function(){i=tt=null;throw SyntaxError();},v=function(){for(var t=tt,o=t.length,f,e,r,s,n;i<o;){n=t.charCodeAt(i);switch(n){case 9:case 10:case 13:case 32:i++;break;case 123:case 125:case 91:case 93:case 58:case 44:return f=w?t.charAt(i):t[i],i++,f;case 34:for(f="@",i++;i<o;)if(n=t.charCodeAt(i),n<32)u();else if(n==92){n=t.charCodeAt(++i);switch(n){case 92:case 34:case 47:case 98:case 116:case 110:case 102:case 114:f+=bt[n];i++;break;case 117:for(e=++i,r=i+4;i<r;i++)n=t.charCodeAt(i),n>=48&&n<=57||n>=97&&n<=102||n>=65&&n<=70||u();f+=wt("0x"+t.slice(e,i));break;default:u()}}else{if(n==34)break;for(n=t.charCodeAt(i),e=i;n>=32&&n!=92&&n!=34;)n=t.charCodeAt(++i);f+=t.slice(e,i)}if(t.charCodeAt(i)==34)return i++,f;u();default:if(e=i,n==45&&(s=!0,n=t.charCodeAt(++i)),n>=48&&n<=57){for(n==48&&(n=t.charCodeAt(i+1),n>=48&&n<=57)&&u(),s=!1;i<o&&(n=t.charCodeAt(i),n>=48&&n<=57);i++);if(t.charCodeAt(i)==46){for(r=++i;r<o&&(n=t.charCodeAt(r),n>=48&&n<=57);r++);r==i&&u();i=r}if(n=t.charCodeAt(i),n==101||n==69){for(n=t.charCodeAt(++i),(n==43||n==45)&&i++,r=i;r<o&&(n=t.charCodeAt(r),n>=48&&n<=57);r++);r==i&&u();i=r}return+t.slice(e,i)}if(s&&u(),t.slice(i,i+4)=="true")return i+=4,!0;if(t.slice(i,i+5)=="false")return i+=5,!1;if(t.slice(i,i+4)=="null")return i+=4,null;u()}}return"$"},rt=function(n){var t,i;if(n=="$"&&u(),typeof n=="string"){if((w?n.charAt(0):n[0])=="@")return n.slice(1);if(n=="["){for(t=[];;i||(i=!0)){if(n=v(),n=="]")break;i&&(n==","?(n=v(),n=="]"&&u()):u());n==","&&u();t.push(rt(n))}return t}if(n=="{"){for(t={};;i||(i=!0)){if(n=v(),n=="}")break;i&&(n==","?(n=v(),n=="}"&&u()):u());(n==","||typeof n!="string"||(w?n.charAt(0):n[0])!="@"||v()!=":")&&u();t[n.slice(1)]=rt(v())}return t}u()}return n},ot=function(n,t,i){var r=st(n,t,i);r===s?delete n[t]:n[t]=r},st=function(n,t,i){var r=n[t],u;if(typeof r=="object"&&r)if(f.call(r)==nt)for(u=r.length;u--;)ot(r,u,i);else y(r,function(n){ot(r,n,i)});return i.call(n,t,r)};h.parse=function(n,t){var r,e;return i=0,tt=""+n,r=rt(v()),v()!="$"&&u(),i=tt=null,t&&f.call(t)==p?st((e={},e[""]=r,e),"",t):r}}}ht&&n(function(){return h})})(this)},{}],50:[function(n,t){function i(n,t){var r=[],i;for(t=t||0,i=t||0;i<n.length;i++)r[i-t]=n[i];return r}t.exports=i},{}]},{},[1])(1)});Date.CultureInfo={name:"vi-VN",englishName:"Vietnamese (Vietnam)",nativeName:"Tiếng Việt (Việt Nam)",dayNames:["Chủ Nhật","Thứ Hai","Thứ Ba","Thứ Tư","Thứ Năm","Thứ Sáu","Thứ Bảy"],abbreviatedDayNames:["CN","Hai","Ba","Tư","Năm","Sáu","Bảy"],shortestDayNames:["C","H","B","T","N","S","B"],firstLetterDayNames:["C","H","B","T","N","S","B"],monthNames:["Tháng Giêng","Tháng Hai","Tháng Ba","Tháng Tư","Tháng Năm","Tháng Sáu","Tháng Bảy","Tháng Tám","Tháng Chín","Tháng Mười","Tháng Mười Một","Tháng Mười Hai"],abbreviatedMonthNames:["Thg1","Thg2","Thg3","Thg4","Thg5","Thg6","Thg7","Thg8","Thg9","Thg10","Thg11","Thg12"],amDesignator:"SA",pmDesignator:"CH",firstDayOfWeek:1,twoDigitYearMax:2029,dateElementOrder:"dmy",formatPatterns:{shortDate:"dd/MM/yyyy",longDate:"dd MMMM yyyy",shortTime:"h:mm tt",longTime:"h:mm:ss tt",fullDateTime:"dd MMMM yyyy h:mm:ss tt",sortableDateTime:"yyyy-MM-ddTHH:mm:ss",universalSortableDateTime:"yyyy-MM-dd HH:mm:ssZ",rfc1123:"ddd, dd MMM yyyy HH:mm:ss GMT",monthDay:"dd MMMM",yearMonth:"MMMM yyyy"},regexPatterns:{jan:/^tháng giêng/i,feb:/^tháng hai/i,mar:/^tháng ba/i,apr:/^tháng tư/i,may:/^tháng năm/i,jun:/^tháng sáu/i,jul:/^tháng bảy/i,aug:/^tháng tám/i,sep:/^tháng chín/i,oct:/^tháng mười/i,nov:/^tháng mười một/i,dec:/^tháng mười hai/i,sun:/^c(n(ủ nhật)?)?/i,mon:/^h(ai(́ hai)?)?/i,tue:/^b(a(ứ ba)?)?/i,wed:/^t(ư(ứ tư)?)?/i,thu:/^n(ăm(́ năm)?)?/i,fri:/^s(áu( sáu)?)?/i,sat:/^b(ảy( bảy)?)?/i,future:/^next/i,past:/^last|past|prev(ious)?/i,add:/^(\+|aft(er)?|from|hence)/i,subtract:/^(\-|bef(ore)?|ago)/i,yesterday:/^yes(terday)?/i,today:/^t(od(ay)?)?/i,tomorrow:/^tom(orrow)?/i,now:/^n(ow)?/i,millisecond:/^ms|milli(second)?s?/i,second:/^sec(ond)?s?/i,minute:/^mn|min(ute)?s?/i,hour:/^h(our)?s?/i,week:/^w(eek)?s?/i,month:/^m(onth)?s?/i,day:/^d(ay)?s?/i,year:/^y(ear)?s?/i,shortMeridian:/^(a|p)/i,longMeridian:/^(a\.?m?\.?|p\.?m?\.?)/i,timezone:/^((e(s|d)t|c(s|d)t|m(s|d)t|p(s|d)t)|((gmt)?\s*(\+|\-)\s*\d\d\d\d?)|gmt|utc)/i,ordinalSuffix:/^\s*(st|nd|rd|th)/i,timeContext:/^\s*(\:|a(?!u|p)|p)/i},timezones:[{name:"UTC",offset:"-000"},{name:"GMT",offset:"-000"},{name:"EST",offset:"-0500"},{name:"EDT",offset:"-0400"},{name:"CST",offset:"-0600"},{name:"CDT",offset:"-0500"},{name:"MST",offset:"-0700"},{name:"MDT",offset:"-0600"},{name:"PST",offset:"-0800"},{name:"PDT",offset:"-0700"}]},function(){var t=Date,n=t.prototype,i=t.CultureInfo,r=function(n,t){return t||(t=2),("000"+n).slice(t*-1)},f,u,e;n.clearTime=function(){return this.setHours(0),this.setMinutes(0),this.setSeconds(0),this.setMilliseconds(0),this};n.setTimeToNow=function(){var n=new Date;return this.setHours(n.getHours()),this.setMinutes(n.getMinutes()),this.setSeconds(n.getSeconds()),this.setMilliseconds(n.getMilliseconds()),this};t.today=function(){return(new Date).clearTime()};t.compare=function(n,t){if(isNaN(n)||isNaN(t))throw new Error(n+" - "+t);else{if(n instanceof Date&&t instanceof Date)return n<t?-1:n>t?1:0;throw new TypeError(n+" - "+t);}};t.equals=function(n,t){return n.compareTo(t)===0};t.getDayNumberFromName=function(n){for(var u=i.dayNames,f=i.abbreviatedDayNames,e=i.shortestDayNames,r=n.toLowerCase(),t=0;t<u.length;t++)if(u[t].toLowerCase()==r||f[t].toLowerCase()==r||e[t].toLowerCase()==r)return t;return-1};t.getMonthNumberFromName=function(n){for(var r=i.monthNames,f=i.abbreviatedMonthNames,u=n.toLowerCase(),t=0;t<r.length;t++)if(r[t].toLowerCase()==u||f[t].toLowerCase()==u)return t;return-1};t.isLeapYear=function(n){return n%4==0&&n%100!=0||n%400==0};t.getDaysInMonth=function(n,i){return[31,t.isLeapYear(n)?29:28,31,30,31,30,31,31,30,31,30,31][i]};t.getTimezoneAbbreviation=function(n){for(var r=i.timezones,t=0;t<r.length;t++)if(r[t].offset===n)return r[t].name;return null};t.getTimezoneOffset=function(n){for(var r=i.timezones,t=0;t<r.length;t++)if(r[t].name===n.toUpperCase())return r[t].offset;return null};n.clone=function(){return new Date(this.getTime())};n.compareTo=function(n){return Date.compare(this,n)};n.equals=function(n){return Date.equals(this,n||new Date)};n.between=function(n,t){return this.getTime()>=n.getTime()&&this.getTime()<=t.getTime()};n.isAfter=function(n){return this.compareTo(n||new Date)===1};n.isBefore=function(n){return this.compareTo(n||new Date)===-1};n.isToday=function(){return this.isSameDay(new Date)};n.isSameDay=function(n){return this.clone().clearTime().equals(n.clone().clearTime())};n.addMilliseconds=function(n){return this.setMilliseconds(this.getMilliseconds()+n),this};n.addSeconds=function(n){return this.addMilliseconds(n*1e3)};n.addMinutes=function(n){return this.addMilliseconds(n*6e4)};n.addHours=function(n){return this.addMilliseconds(n*36e5)};n.addDays=function(n){return this.setDate(this.getDate()+n),this};n.addWeeks=function(n){return this.addDays(n*7)};n.addMonths=function(n){var i=this.getDate();return this.setDate(1),this.setMonth(this.getMonth()+n),this.setDate(Math.min(i,t.getDaysInMonth(this.getFullYear(),this.getMonth()))),this};n.addYears=function(n){return this.addMonths(n*12)};n.add=function(n){if(typeof n=="number")return this._orient=n,this;var t=n;return t.milliseconds&&this.addMilliseconds(t.milliseconds),t.seconds&&this.addSeconds(t.seconds),t.minutes&&this.addMinutes(t.minutes),t.hours&&this.addHours(t.hours),t.weeks&&this.addWeeks(t.weeks),t.months&&this.addMonths(t.months),t.years&&this.addYears(t.years),t.days&&this.addDays(t.days),this};n.getWeek=function(){var n,i,r,l,h,o,c,s,t,a;return f=f?f:this.getFullYear(),u=u?u:this.getMonth()+1,e=e?e:this.getDate(),u<=2?(n=f-1,i=(n/4|0)-(n/100|0)+(n/400|0),r=((n-1)/4|0)-((n-1)/100|0)+((n-1)/400|0),t=i-r,h=0,o=e-1+31*(u-1)):(n=f,i=(n/4|0)-(n/100|0)+(n/400|0),r=((n-1)/4|0)-((n-1)/100|0)+((n-1)/400|0),t=i-r,h=t+1,o=e+(153*(u-3)+2)/5+58+t),c=(n+i)%7,l=(o+c-h)%7,s=o+3-l|0,a=s<0?53-((c-t)/5|0):s>364+t?1:(s/7|0)+1,f=u=e=null,a};n.getISOWeek=function(){return f=this.getUTCFullYear(),u=this.getUTCMonth()+1,e=this.getUTCDate(),r(this.getWeek())};n.setWeek=function(n){return this.moveToDayOfWeek(1).addWeeks(n-this.getWeek())};t._validate=function(n,t,i,r){if(typeof n=="undefined")return!1;if(typeof n!="number")throw new TypeError(n+" is not a Number.");else if(n<t||n>i)throw new RangeError(n+" is not a valid value for "+r+".");return!0};t.validateMillisecond=function(n){return t._validate(n,0,999,"millisecond")};t.validateSecond=function(n){return t._validate(n,0,59,"second")};t.validateMinute=function(n){return t._validate(n,0,59,"minute")};t.validateHour=function(n){return t._validate(n,0,23,"hour")};t.validateDay=function(n,i,r){return t._validate(n,1,t.getDaysInMonth(i,r),"day")};t.validateMonth=function(n){return t._validate(n,0,11,"month")};t.validateYear=function(n){return t._validate(n,0,9999,"year")};n.set=function(n){return t.validateMillisecond(n.millisecond)&&this.addMilliseconds(n.millisecond-this.getMilliseconds()),t.validateSecond(n.second)&&this.addSeconds(n.second-this.getSeconds()),t.validateMinute(n.minute)&&this.addMinutes(n.minute-this.getMinutes()),t.validateHour(n.hour)&&this.addHours(n.hour-this.getHours()),t.validateMonth(n.month)&&this.addMonths(n.month-this.getMonth()),t.validateYear(n.year)&&this.addYears(n.year-this.getFullYear()),t.validateDay(n.day,this.getFullYear(),this.getMonth())&&this.addDays(n.day-this.getDate()),n.timezone&&this.setTimezone(n.timezone),n.timezoneOffset&&this.setTimezoneOffset(n.timezoneOffset),n.week&&t._validate(n.week,0,53,"week")&&this.setWeek(n.week),this};n.moveToFirstDayOfMonth=function(){return this.set({day:1})};n.moveToLastDayOfMonth=function(){return this.set({day:t.getDaysInMonth(this.getFullYear(),this.getMonth())})};n.moveToNthOccurrence=function(n,t){var i=0;if(t>0)i=t-1;else if(t===-1)return this.moveToLastDayOfMonth(),this.getDay()!==n&&this.moveToDayOfWeek(n,-1),this;return this.moveToFirstDayOfMonth().addDays(-1).moveToDayOfWeek(n,1).addWeeks(i)};n.moveToDayOfWeek=function(n,t){var i=(n-this.getDay()+7*(t||1))%7;return this.addDays(i===0?i+=7*(t||1):i)};n.moveToMonth=function(n,t){var i=(n-this.getMonth()+12*(t||1))%12;return this.addMonths(i===0?i+=12*(t||1):i)};n.getOrdinalNumber=function(){return Math.ceil((this.clone().clearTime()-new Date(this.getFullYear(),0,1))/864e5)+1};n.getTimezone=function(){return t.getTimezoneAbbreviation(this.getUTCOffset())};n.setTimezoneOffset=function(n){var t=this.getTimezoneOffset(),i=Number(n)*-6/10;return this.addMinutes(i-t)};n.setTimezone=function(n){return this.setTimezoneOffset(t.getTimezoneOffset(n))};n.hasDaylightSavingTime=function(){return Date.today().set({month:0,day:1}).getTimezoneOffset()!==Date.today().set({month:6,day:1}).getTimezoneOffset()};n.isDaylightSavingTime=function(){return this.hasDaylightSavingTime()&&(new Date).getTimezoneOffset()===Date.today().set({month:6,day:1}).getTimezoneOffset()};n.getUTCOffset=function(){var t=this.getTimezoneOffset()*-10/6,n;return t<0?(n=(t-1e4).toString(),n.charAt(0)+n.substr(2)):(n=(t+1e4).toString(),"+"+n.substr(1))};n.getElapsed=function(n){return(n||new Date)-this};n.toISOString||(n.toISOString=function(){function n(n){return n<10?"0"+n:n}return'"'+this.getUTCFullYear()+"-"+n(this.getUTCMonth()+1)+"-"+n(this.getUTCDate())+"T"+n(this.getUTCHours())+":"+n(this.getUTCMinutes())+":"+n(this.getUTCSeconds())+'Z"'});n._toString=n.toString;n.toString=function(n){var t=this,u,f;if(n&&n.length==1){u=i.formatPatterns;t.t=t.toString;switch(n){case"d":return t.t(u.shortDate);case"D":return t.t(u.longDate);case"F":return t.t(u.fullDateTime);case"m":return t.t(u.monthDay);case"r":return t.t(u.rfc1123);case"s":return t.t(u.sortableDateTime);case"t":return t.t(u.shortTime);case"T":return t.t(u.longTime);case"u":return t.t(u.universalSortableDateTime);case"y":return t.t(u.yearMonth)}}return f=function(n){switch(n*1){case 1:case 21:case 31:return"st";case 2:case 22:return"nd";case 3:case 23:return"rd";default:return"th"}},n?n.replace(/(\\)?(dd?d?d?|MM?M?M?|yy?y?y?|hh?|HH?|mm?|ss?|tt?|S)/g,function(n){if(n.charAt(0)==="\\")return n.replace("\\","");t.h=t.getHours;switch(n){case"hh":return r(t.h()<13?t.h()===0?12:t.h():t.h()-12);case"h":return t.h()<13?t.h()===0?12:t.h():t.h()-12;case"HH":return r(t.h());case"H":return t.h();case"mm":return r(t.getMinutes());case"m":return t.getMinutes();case"ss":return r(t.getSeconds());case"s":return t.getSeconds();case"yyyy":return r(t.getFullYear(),4);case"yy":return r(t.getFullYear());case"dddd":return i.dayNames[t.getDay()];case"ddd":return i.abbreviatedDayNames[t.getDay()];case"dd":return r(t.getDate());case"d":return t.getDate();case"MMMM":return i.monthNames[t.getMonth()];case"MMM":return i.abbreviatedMonthNames[t.getMonth()];case"MM":return r(t.getMonth()+1);case"M":return t.getMonth()+1;case"t":return t.h()<12?i.amDesignator.substring(0,1):i.pmDesignator.substring(0,1);case"tt":return t.h()<12?i.amDesignator:i.pmDesignator;case"S":return f(t.getDate());default:return n}}):this._toString()}}(),function(){var t=Date,n=t.prototype,d=t.CultureInfo,u=Number.prototype,y,p,i,w,b,r,l,k,c,a,h;n._orient=1;n._nth=null;n._is=!1;n._same=!1;n._isSecond=!1;u._dateElement="day";n.next=function(){return this._orient=1,this};t.next=function(){return t.today().next()};n.last=n.prev=n.previous=function(){return this._orient=-1,this};t.last=t.prev=t.previous=function(){return t.today().last()};n.is=function(){return this._is=!0,this};n.same=function(){return this._same=!0,this._isSecond=!1,this};n.today=function(){return this.same().day()};n.weekday=function(){return this._is?(this._is=!1,!this.is().sat()&&!this.is().sun()):!1};n.at=function(n){return typeof n=="string"?t.parse(this.toString("d")+" "+n):this.set(n)};u.fromNow=u.after=function(n){var t={};return t[this._dateElement]=this,(n?n.clone():new Date).add(t)};u.ago=u.before=function(n){var t={};return t[this._dateElement]=this*-1,(n?n.clone():new Date).add(t)};var f="sunday monday tuesday wednesday thursday friday saturday".split(/\s/),e="january february march april may june july august september october november december".split(/\s/),o="Millisecond Second Minute Hour Day Week Month Year".split(/\s/),g="Milliseconds Seconds Minutes Hours Date Week Month FullYear".split(/\s/),v="final first second third fourth fifth".split(/\s/),s;for(n.toObject=function(){for(var t={},n=0;n<o.length;n++)t[o[n].toLowerCase()]=this["get"+g[n]]();return t},t.fromObject=function(n){return n.week=null,Date.today().set(n)},y=function(n){return function(){var r,i;if(this._is)return this._is=!1,this.getDay()==n;if(this._nth!==null){if(this._isSecond&&this.addSeconds(this._orient*-1),this._isSecond=!1,r=this._nth,this._nth=null,i=this.clone().moveToLastDayOfMonth(),this.moveToNthOccurrence(n,r),this>i)throw new RangeError(t.getDayName(n)+" does not occur "+r+" times in the month of "+t.getMonthName(i.getMonth())+" "+i.getFullYear()+".");return this}return this.moveToDayOfWeek(n,this._orient)}},p=function(n){return function(){var i=t.today(),r=n-i.getDay();return n===0&&d.firstDayOfWeek===1&&i.getDay()!==0&&(r=r+7),i.addDays(r)}},i=0;i<f.length;i++)t[f[i].toUpperCase()]=t[f[i].toUpperCase().substring(0,3)]=i,t[f[i]]=t[f[i].substring(0,3)]=p(i),n[f[i]]=n[f[i].substring(0,3)]=y(i);for(w=function(n){return function(){return this._is?(this._is=!1,this.getMonth()===n):this.moveToMonth(n,this._orient)}},b=function(n){return function(){return t.today().set({month:n,day:1})}},r=0;r<e.length;r++)t[e[r].toUpperCase()]=t[e[r].toUpperCase().substring(0,3)]=r,t[e[r]]=t[e[r].substring(0,3)]=b(r),n[e[r]]=n[e[r].substring(0,3)]=w(r);for(l=function(n){return function(){var i;if(this._isSecond)return this._isSecond=!1,this;if(this._same){this._same=this._is=!1;var r=this.toObject(),u=(arguments[0]||new Date).toObject(),t="",f=n.toLowerCase();for(i=o.length-1;i>-1;i--){if(t=o[i].toLowerCase(),r[t]!=u[t])return!1;if(f==t)break}return!0}return n.substring(n.length-1)!="s"&&(n+="s"),this["add"+n](this._orient)}},k=function(n){return function(){return this._dateElement=n,this}},c=0;c<o.length;c++)s=o[c].toLowerCase(),n[s]=n[s+"s"]=l(o[c]),u[s]=u[s+"s"]=k(s);for(n._ss=l("Second"),a=function(n){return function(t){return this._same?this._ss(arguments[0]):t||t===0?this.moveToNthOccurrence(t,n):(this._nth=n,n===2&&(t===undefined||t===null))?(this._isSecond=!0,this.addSeconds(this._orient)):this}},h=0;h<v.length;h++)n[v[h]]=h===0?a(-1):a(h)}(),function(){var i,o,f,u;Date.Parsing={Exception:function(n){this.message="Parse error at '"+n.substring(0,10)+" ...'"}};var t=Date.Parsing,n=t.Operators={rtoken:function(n){return function(i){var r=i.match(n);if(r)return[r[0],i.substring(r[0].length)];throw new t.Exception(i);}},token:function(){return function(t){return n.rtoken(new RegExp("^s*"+t+"s*"))(t)}},stoken:function(t){return n.rtoken(new RegExp("^"+t))},until:function(n){return function(t){for(var r=[],i=null;t.length;){try{i=n.call(this,t)}catch(u){r.push(i[0]);t=i[1];continue}break}return[r,t]}},many:function(n){return function(t){for(var i=[],r=null;t.length;){try{r=n.call(this,t)}catch(u){return[i,t]}i.push(r[0]);t=r[1]}return[i,t]}},optional:function(n){return function(t){var i=null;try{i=n.call(this,t)}catch(r){return[null,t]}return[i[0],i[1]]}},not:function(n){return function(i){try{n.call(this,i)}catch(r){return[null,i]}throw new t.Exception(i);}},ignore:function(n){return n?function(t){var i=null;return i=n.call(this,t),[null,i[1]]}:null},product:function(){for(var i=arguments[0],u=Array.prototype.slice.call(arguments,1),r=[],t=0;t<i.length;t++)r.push(n.each(i[t],u));return r},cache:function(n){var r={},i=null;return function(u){try{i=r[u]=r[u]||n.call(this,u)}catch(f){i=r[u]=f}if(i instanceof t.Exception)throw i;else return i}},any:function(){var n=arguments;return function(i){for(var r=null,u=0;u<n.length;u++)if(n[u]!=null){try{r=n[u].call(this,i)}catch(f){r=null}if(r)return r}throw new t.Exception(i);}},each:function(){var n=arguments;return function(i){for(var f=[],u=null,r=0;r<n.length;r++)if(n[r]!=null){try{u=n[r].call(this,i)}catch(e){throw new t.Exception(i);}f.push(u[0]);i=u[1]}return[f,i]}},all:function(){var t=arguments,n=n;return n.each(n.optional(t))},sequence:function(i,r,u){return(r=r||n.rtoken(/^\s*/),u=u||null,i.length==1)?i[0]:function(n){for(var f=null,e=null,s=[],o=0;o<i.length;o++){try{f=i[o].call(this,n)}catch(h){break}s.push(f[0]);try{e=r.call(this,f[1])}catch(c){e=null;break}n=e[1]}if(!f)throw new t.Exception(n);if(e)throw new t.Exception(e[1]);if(u)try{f=u.call(this,f[1])}catch(l){throw new t.Exception(f[1]);}return[s,f?f[1]:n]}},between:function(t,i,u){u=u||t;var f=n.each(n.ignore(t),i,n.ignore(u));return function(n){var t=f.call(this,n);return[[t[0][0],r[0][2]],t[1]]}},list:function(t,i,r){return i=i||n.rtoken(/^\s*/),r=r||null,t instanceof Array?n.each(n.product(t.slice(0,-1),n.ignore(i)),t.slice(-1),n.ignore(r)):n.each(n.many(n.each(t,n.ignore(i))),px,n.ignore(r))},set:function(i,r,u){return r=r||n.rtoken(/^\s*/),u=u||null,function(f){for(var y,a,s=null,l=null,h=null,c=null,e=[[],f],o=!1,v=0;v<i.length;v++){h=null;l=null;s=null;o=i.length==1;try{s=i[v].call(this,f)}catch(p){continue}if(c=[[s[0]],s[1]],s[1].length>0&&!o)try{h=r.call(this,s[1])}catch(w){o=!0}else o=!0;if(o||h[1].length!==0||(o=!0),!o){for(y=[],a=0;a<i.length;a++)v!=a&&y.push(i[a]);l=n.set(y,r).call(this,h[1]);l[0].length>0&&(c[0]=c[0].concat(l[0]),c[1]=l[1])}if(c[1].length<e[1].length&&(e=c),e[1].length===0)break}if(e[0].length===0)return e;if(u){try{h=u.call(this,e[1])}catch(b){throw new t.Exception(e[1]);}e[1]=h[1]}return e}},forward:function(n,t){return function(i){return n[t].call(this,i)}},replace:function(n,t){return function(i){var r=n.call(this,i);return[t,r[1]]}},process:function(n,t){return function(i){var r=n.call(this,i);return[t.call(this,r[0]),r[1]]}},min:function(n,i){return function(r){var u=i.call(this,r);if(u[0].length<n)throw new t.Exception(r);return u}}},s=function(n){return function(){var t=null,u=[],i,r;if(arguments.length>1?t=Array.prototype.slice.call(arguments):arguments[0]instanceof Array&&(t=arguments[0]),t)for(i=0,r=t.shift();i<r.length;i++)return t.unshift(r[i]),u.push(n.apply(null,t)),t.shift(),u;else return n.apply(null,arguments)}},e="optional not ignore cache".split(/\s/);for(i=0;i<e.length;i++)n[e[i]]=s(n[e[i]]);for(o=function(n){return function(){return arguments[0]instanceof Array?n.apply(null,arguments[0]):n.apply(null,arguments)}},f="each any all".split(/\s/),u=0;u<f.length;u++)n[f[u]]=o(n[f[u]])}(),function(){var r=Date,c=r.prototype,f=r.CultureInfo,h=function(n){for(var i=[],t=0;t<n.length;t++)n[t]instanceof Array?i=i.concat(h(n[t])):n[t]&&i.push(n[t]);return i},e,o,s;r.Grammar={};r.Translator={hour:function(n){return function(){this.hour=Number(n)}},minute:function(n){return function(){this.minute=Number(n)}},second:function(n){return function(){this.second=Number(n)}},meridian:function(n){return function(){this.meridian=n.slice(0,1).toLowerCase()}},timezone:function(n){return function(){var t=n.replace(/[^\d\+\-]/g,"");t.length?this.timezoneOffset=Number(t):this.timezone=n.toLowerCase()}},day:function(n){var t=n[0];return function(){this.day=Number(t.match(/\d+/)[0])}},month:function(n){return function(){this.month=n.length==3?"jan feb mar apr may jun jul aug sep oct nov dec".indexOf(n)/4:Number(n)-1}},year:function(n){return function(){var t=Number(n);this.year=n.length>2?t:t+(t+2e3<f.twoDigitYearMax?2e3:1900)}},rday:function(n){return function(){switch(n){case"yesterday":this.days=-1;break;case"tomorrow":this.days=1;break;case"today":this.days=0;break;case"now":this.days=0;this.now=!0}}},finishExact:function(n){var t,i,u;for(n=n instanceof Array?n:[n],t=0;t<n.length;t++)n[t]&&n[t].call(this);if(i=new Date,!(this.hour||this.minute)||this.month||this.year||this.day||(this.day=i.getDate()),this.year||(this.year=i.getFullYear()),this.month||this.month===0||(this.month=i.getMonth()),this.day||(this.day=1),this.hour||(this.hour=0),this.minute||(this.minute=0),this.second||(this.second=0),this.meridian&&this.hour&&(this.meridian=="p"&&this.hour<12?this.hour=this.hour+12:this.meridian=="a"&&this.hour==12&&(this.hour=0)),this.day>r.getDaysInMonth(this.year,this.month))throw new RangeError(this.day+" is not a valid value for days.");return u=new Date(this.year,this.month,this.day,this.hour,this.minute,this.second),this.timezone?u.set({timezone:this.timezone}):this.timezoneOffset&&u.set({timezoneOffset:this.timezoneOffset}),u},finish:function(n){var s,t,i,o,u,e,f;if(n=n instanceof Array?h(n):[n],n.length===0)return null;for(s=0;s<n.length;s++)typeof n[s]=="function"&&n[s].call(this);if(t=r.today(),!this.now||this.unit||this.operator)this.now&&(t=new Date);else return new Date;return(i=!!(this.days&&this.days!==null||this.orient||this.operator),e=this.orient=="past"||this.operator=="subtract"?-1:1,this.now||"hour minute second".indexOf(this.unit)==-1||t.setTimeToNow(),(this.month||this.month===0)&&"year day hour minute second".indexOf(this.unit)!=-1&&(this.value=this.month+1,this.month=null,i=!0),i||!this.weekday||this.day||this.days||(f=Date[this.weekday](),this.day=f.getDate(),this.month||(this.month=f.getMonth()),this.year=f.getFullYear()),i&&this.weekday&&this.unit!="month"&&(this.unit="day",o=r.getDayNumberFromName(this.weekday)-t.getDay(),u=7,this.days=o?(o+e*u)%u:e*u),this.month&&this.unit=="day"&&this.operator&&(this.value=this.month+1,this.month=null),this.value!=null&&this.month!=null&&this.year!=null&&(this.day=this.value*1),this.month&&!this.day&&this.value&&(t.set({day:this.value*1}),i||(this.day=this.value*1)),this.month||!this.value||this.unit!="month"||this.now||(this.month=this.value,i=!0),i&&(this.month||this.month===0)&&this.unit!="year"&&(this.unit="month",o=this.month-t.getMonth(),u=12,this.months=o?(o+e*u)%u:e*u,this.month=null),this.unit||(this.unit="day"),!this.value&&this.operator&&this.operator!==null&&this[this.unit+"s"]&&this[this.unit+"s"]!==null?this[this.unit+"s"]=this[this.unit+"s"]+(this.operator=="add"?1:-1)+(this.value||0)*e:(this[this.unit+"s"]==null||this.operator!=null)&&(this.value||(this.value=1),this[this.unit+"s"]=this.value*e),this.meridian&&this.hour&&(this.meridian=="p"&&this.hour<12?this.hour=this.hour+12:this.meridian=="a"&&this.hour==12&&(this.hour=0)),!this.weekday||this.day||this.days||(f=Date[this.weekday](),this.day=f.getDate(),f.getMonth()!==t.getMonth()&&(this.month=f.getMonth())),(this.month||this.month===0)&&!this.day&&(this.day=1),!this.orient&&!this.operator&&this.unit=="week"&&this.value&&!this.day&&!this.month)?Date.today().setWeek(this.value):(i&&this.timezone&&this.day&&this.days&&(this.day=this.days),i?t.add(this):t.set(this))}};var t=r.Parsing.Operators,n=r.Grammar,i=r.Translator,u;n.datePartDelimiter=t.rtoken(/^([\s\-\.\,\/\x27]+)/);n.timePartDelimiter=t.stoken(":");n.whiteSpace=t.rtoken(/^\s*/);n.generalDelimiter=t.rtoken(/^(([\s\,]|at|@|on)+)/);e={};n.ctoken=function(n){var r=e[n],i;if(!r){var s=f.regexPatterns,u=n.split(/\s+/),o=[];for(i=0;i<u.length;i++)o.push(t.replace(t.rtoken(s[u[i]]),u[i]));r=e[n]=t.any.apply(null,o)}return r};n.ctoken2=function(n){return t.rtoken(f.regexPatterns[n])};n.h=t.cache(t.process(t.rtoken(/^(0[0-9]|1[0-2]|[1-9])/),i.hour));n.hh=t.cache(t.process(t.rtoken(/^(0[0-9]|1[0-2])/),i.hour));n.H=t.cache(t.process(t.rtoken(/^([0-1][0-9]|2[0-3]|[0-9])/),i.hour));n.HH=t.cache(t.process(t.rtoken(/^([0-1][0-9]|2[0-3])/),i.hour));n.m=t.cache(t.process(t.rtoken(/^([0-5][0-9]|[0-9])/),i.minute));n.mm=t.cache(t.process(t.rtoken(/^[0-5][0-9]/),i.minute));n.s=t.cache(t.process(t.rtoken(/^([0-5][0-9]|[0-9])/),i.second));n.ss=t.cache(t.process(t.rtoken(/^[0-5][0-9]/),i.second));n.hms=t.cache(t.sequence([n.H,n.m,n.s],n.timePartDelimiter));n.t=t.cache(t.process(n.ctoken2("shortMeridian"),i.meridian));n.tt=t.cache(t.process(n.ctoken2("longMeridian"),i.meridian));n.z=t.cache(t.process(t.rtoken(/^((\+|\-)\s*\d\d\d\d)|((\+|\-)\d\d\:?\d\d)/),i.timezone));n.zz=t.cache(t.process(t.rtoken(/^((\+|\-)\s*\d\d\d\d)|((\+|\-)\d\d\:?\d\d)/),i.timezone));n.zzz=t.cache(t.process(n.ctoken2("timezone"),i.timezone));n.timeSuffix=t.each(t.ignore(n.whiteSpace),t.set([n.tt,n.zzz]));n.time=t.each(t.optional(t.ignore(t.stoken("T"))),n.hms,n.timeSuffix);n.d=t.cache(t.process(t.each(t.rtoken(/^([0-2]\d|3[0-1]|\d)/),t.optional(n.ctoken2("ordinalSuffix"))),i.day));n.dd=t.cache(t.process(t.each(t.rtoken(/^([0-2]\d|3[0-1])/),t.optional(n.ctoken2("ordinalSuffix"))),i.day));n.ddd=n.dddd=t.cache(t.process(n.ctoken("sun mon tue wed thu fri sat"),function(n){return function(){this.weekday=n}}));n.M=t.cache(t.process(t.rtoken(/^(1[0-2]|0\d|\d)/),i.month));n.MM=t.cache(t.process(t.rtoken(/^(1[0-2]|0\d)/),i.month));n.MMM=n.MMMM=t.cache(t.process(n.ctoken("jan feb mar apr may jun jul aug sep oct nov dec"),i.month));n.y=t.cache(t.process(t.rtoken(/^(\d\d?)/),i.year));n.yy=t.cache(t.process(t.rtoken(/^(\d\d)/),i.year));n.yyy=t.cache(t.process(t.rtoken(/^(\d\d?\d?\d?)/),i.year));n.yyyy=t.cache(t.process(t.rtoken(/^(\d\d\d\d)/),i.year));u=function(){return t.each(t.any.apply(null,arguments),t.not(n.ctoken2("timeContext")))};n.day=u(n.d,n.dd);n.month=u(n.M,n.MMM);n.year=u(n.yyyy,n.yy);n.orientation=t.process(n.ctoken("past future"),function(n){return function(){this.orient=n}});n.operator=t.process(n.ctoken("add subtract"),function(n){return function(){this.operator=n}});n.rday=t.process(n.ctoken("yesterday tomorrow today now"),i.rday);n.unit=t.process(n.ctoken("second minute hour day week month year"),function(n){return function(){this.unit=n}});n.value=t.process(t.rtoken(/^\d\d?(st|nd|rd|th)?/),function(n){return function(){this.value=n.replace(/\D/g,"")}});n.expression=t.set([n.rday,n.operator,n.value,n.unit,n.orientation,n.ddd,n.MMM]);u=function(){return t.set(arguments,n.datePartDelimiter)};n.mdy=u(n.ddd,n.month,n.day,n.year);n.ymd=u(n.ddd,n.year,n.month,n.day);n.dmy=u(n.ddd,n.day,n.month,n.year);n.date=function(t){return(n[f.dateElementOrder]||n.mdy).call(this,t)};n.format=t.process(t.many(t.any(t.process(t.rtoken(/^(dd?d?d?|MM?M?M?|yy?y?y?|hh?|HH?|mm?|ss?|tt?|zz?z?)/),function(t){if(n[t])return n[t];throw r.Parsing.Exception(t);}),t.process(t.rtoken(/^[^dMyhHmstz]+/),function(n){return t.ignore(t.stoken(n))}))),function(n){return t.process(t.each.apply(null,n),i.finishExact)});o={};s=function(t){return o[t]=o[t]||n.format(t)[0]};n.formats=function(n){var r,i;if(n instanceof Array){for(r=[],i=0;i<n.length;i++)r.push(s(n[i]));return t.any.apply(null,r)}return s(n)};n._formats=n.formats(['"yyyy-MM-ddTHH:mm:ssZ"',"yyyy-MM-ddTHH:mm:ssZ","yyyy-MM-ddTHH:mm:ssz","yyyy-MM-ddTHH:mm:ss","yyyy-MM-ddTHH:mmZ","yyyy-MM-ddTHH:mmz","yyyy-MM-ddTHH:mm","ddd, MMM dd, yyyy H:mm:ss tt","ddd MMM d yyyy HH:mm:ss zzz","MMddyyyy","ddMMyyyy","Mddyyyy","ddMyyyy","Mdyyyy","dMyyyy","yyyy","Mdyy","dMyy","d"]);n._start=t.process(t.set([n.date,n.time,n.expression],n.generalDelimiter,n.whiteSpace),i.finish);n.start=function(t){try{var i=n._formats.call({},t);if(i[1].length===0)return i}catch(r){}return n._start.call({},t)};r._parse=r.parse;r.parse=function(n){var t=null;if(!n)return null;if(n instanceof Date)return n;try{t=r.Grammar.start.call({},n.replace(/^\s*(\S*(\s+\S+)*)\s*$/,"$1"))}catch(i){return null}return t[1].length===0?t[0]:null};r.getParseFunction=function(n){var t=r.Grammar.formats(n);return function(n){var i=null;try{i=t.call({},n)}catch(r){return null}return i[1].length===0?i[0]:null}};r.parseExact=function(n,t){return r.getParseFunction(t)(n)}}(),function(n){n.fn.html5Uploader=function(t){function e(n){var e=new FileReader,t,s,o;e.onabort=function(t){if(i.onClientAbort)i.onClientAbort(t,n)};e.onerror=function(t){if(i.onClientError)i.onClientError(t,n)};e.onload=function(t){if(i.onClientLoad)i.onClientLoad(t,n)};e.onloadend=function(t){if(i.onClientLoadEnd)i.onClientLoadEnd(t,n)};e.onloadstart=function(t){if(i.onClientLoadStart)i.onClientLoadStart(t,n)};e.onprogress=function(t){if(i.onClientProgress)i.onClientProgress(t,n)};e.readAsDataURL(n);t=new XMLHttpRequest;t.upload.onabort=function(t){if(i.onServerAbort)i.onServerAbort(t,n)};t.upload.onerror=function(t){if(i.onServerError)i.onServerError(t,n)};t.upload.onload=function(t){if(i.onServerLoad)i.onServerLoad(t,n)};t.upload.onloadstart=function(t){if(i.onServerLoadStart)i.onServerLoadStart(t,n)};t.upload.onprogress=function(t){if(i.onServerProgress)i.onServerProgress(t,n)};t.onreadystatechange=function(r){if(i.onServerReadyStateChange)i.onServerReadyStateChange(r,n,t.readyState);if(i.onSuccess&&t.readyState==4&&t.status==200)i.onSuccess(r,n,t.responseText)};t.open("post.html",i.postUrl,!0);n.getAsBinary?(s=f+u+r+'Content-Disposition: form-data;name="'+i.name+'";filename="'+unescape(encodeURIComponent(n.name))+'"'+r+"Content-Type: application/octet-stream"+r+r+n.getAsBinary()+r+f+u+f,t.setRequestHeader("Content-Type","multipart/form-data;boundary="+u),t.sendAsBinary(s)):window.FormData&&(o=new FormData,o.append(i.name,n),t.send(o))}var r="\r\n",u="iloveigloo",f="--",i={name:"uploadedFile",postUrl:"Upload.aspx",onClientAbort:null,onClientError:null,onClientLoad:null,onClientLoadEnd:null,onClientLoadStart:null,onClientProgress:null,onServerAbort:null,onServerError:null,onServerLoad:null,onServerLoadStart:null,onServerProgress:null,onServerReadyStateChange:null,onSuccess:null};return t&&n.extend(i,t),this.each(function(){var t=n(this);t.is('[type="file"]')?t.bind("change",function(){for(var t=this.files,n=0;n<t.length;n++)e(t[n])}):t.bind("dragenter dragover",function(){return!1}).bind("drop",function(n){for(var i=n.originalEvent.dataTransfer.files,t=0;t<i.length;t++)e(i[t]);return!1})})}}(jQuery);!function(n){"use strict";var t=function(n,t){this.init("tooltip",n,t)},i;t.prototype={constructor:t,init:function(t,i,r){var u,f;if(this.type=t,this.$element=n(i),this.options=this.getOptions(r),this.enabled=!0,this.options.trigger=="click")this.$element.on("click."+this.type,this.options.selector,n.proxy(this.toggle,this));else if(this.options.trigger!="manual"){u=this.options.trigger=="hover"?"mouseenter":"focus";f=this.options.trigger=="hover"?"mouseleave":"blur";this.$element.on(u+"."+this.type,this.options.selector,n.proxy(this.enter,this));this.$element.on(f+"."+this.type,this.options.selector,n.proxy(this.leave,this))}this.options.selector?this._options=n.extend({},this.options,{trigger:"manual",selector:""}):this.fixTitle()},getOptions:function(t){return t=n.extend({},n.fn[this.type].defaults,t,this.$element.data()),t.delay&&typeof t.delay=="number"&&(t.delay={show:t.delay,hide:t.delay}),t},enter:function(t){var i=n(t.currentTarget)[this.type](this._options).data(this.type);if(!i.options.delay||!i.options.delay.show)return i.show();clearTimeout(this.timeout);i.hoverState="in";this.timeout=setTimeout(function(){i.hoverState=="in"&&i.show()},i.options.delay.show)},leave:function(t){var i=n(t.currentTarget)[this.type](this._options).data(this.type);if(this.timeout&&clearTimeout(this.timeout),!i.options.delay||!i.options.delay.hide)return i.hide();i.hoverState="out";this.timeout=setTimeout(function(){i.hoverState=="out"&&i.hide()},i.options.delay.hide)},show:function(){var t,e,n,u,f,i,r;if(this.hasContent()&&this.enabled){t=this.tip();this.setContent();this.options.animation&&t.addClass("fade");i=typeof this.options.placement=="function"?this.options.placement.call(this,t[0],this.$element[0]):this.options.placement;e=/in/.test(i);t.detach().css({top:0,left:0,display:"block"}).insertAfter(this.$element);n=this.getPosition(e);u=t[0].offsetWidth;f=t[0].offsetHeight;switch(e?i.split(" ")[1]:i){case"bottom":r={top:n.top+n.height,left:n.left+n.width/2-u/2};break;case"top":r={top:n.top-f,left:n.left+n.width/2-u/2};break;case"left":r={top:n.top+n.height/2-f/2,left:n.left-u};break;case"right":r={top:n.top+n.height/2-f/2,left:n.left+n.width}}t.offset(r).addClass(i).addClass("in")}},setContent:function(){var n=this.tip(),t=this.getTitle();n.find(".tooltip-inner")[this.options.html?"html":"text"](t);n.removeClass("fade in top bottom left right")},hide:function(){function i(){var i=setTimeout(function(){t.off(n.support.transition.end).detach()},500);t.one(n.support.transition.end,function(){clearTimeout(i);t.detach()})}var r=this,t=this.tip();return t.removeClass("in"),n.support.transition&&this.$tip.hasClass("fade")?i():t.detach(),this},fixTitle:function(){var n=this.$element;(n.attr("title")||typeof n.attr("data-original-title")!="string")&&n.attr("data-original-title",n.attr("title")||"").removeAttr("title")},hasContent:function(){return this.getTitle()},getPosition:function(t){return n.extend({},t?{top:0,left:0}:this.$element.offset(),{width:this.$element[0].offsetWidth,height:this.$element[0].offsetHeight})},getTitle:function(){var t=this.$element,n=this.options;return t.attr("data-original-title")||(typeof n.title=="function"?n.title.call(t[0]):n.title)},tip:function(){return this.$tip=this.$tip||n(this.options.template)},validate:function(){this.$element[0].parentNode||(this.hide(),this.$element=null,this.options=null)},enable:function(){this.enabled=!0},disable:function(){this.enabled=!1},toggleEnabled:function(){this.enabled=!this.enabled},toggle:function(t){var i=n(t.currentTarget)[this.type](this._options).data(this.type);i[i.tip().hasClass("in")?"hide":"show"]()},destroy:function(){this.hide().$element.off("."+this.type).removeData(this.type)}};i=n.fn.tooltip;n.fn.tooltip=function(i){return this.each(function(){var u=n(this),r=u.data("tooltip"),f=typeof i=="object"&&i;r||u.data("tooltip",r=new t(this,f));typeof i=="string"&&r[i]()})};n.fn.tooltip.Constructor=t;n.fn.tooltip.defaults={animation:!0,placement:"top",selector:!1,template:'<div class="tooltip"><div class="tooltip-arrow"><\/div><div class="tooltip-inner"><\/div><\/div>',trigger:"hover",title:"",delay:0,html:!1};n.fn.tooltip.noConflict=function(){return n.fn.tooltip=i,this}}(window.jQuery),function(n){n.fn.html5Uploader=function(t){function e(n){var e=new FileReader,t,s,o;e.onabort=function(t){if(i.onClientAbort)i.onClientAbort(t,n)};e.onerror=function(t){if(i.onClientError)i.onClientError(t,n)};e.onload=function(t){if(i.onClientLoad)i.onClientLoad(t,n)};e.onloadend=function(t){if(i.onClientLoadEnd)i.onClientLoadEnd(t,n)};e.onloadstart=function(t){if(i.onClientLoadStart)i.onClientLoadStart(t,n)};e.onprogress=function(t){if(i.onClientProgress)i.onClientProgress(t,n)};e.readAsDataURL(n);t=new XMLHttpRequest;t.upload.onabort=function(t){if(i.onServerAbort)i.onServerAbort(t,n)};t.upload.onerror=function(t){if(i.onServerError)i.onServerError(t,n)};t.upload.onload=function(t){if(i.onServerLoad)i.onServerLoad(t,n)};t.upload.onloadstart=function(t){if(i.onServerLoadStart)i.onServerLoadStart(t,n)};t.upload.onprogress=function(t){if(i.onServerProgress)i.onServerProgress(t,n)};t.onreadystatechange=function(r){if(i.onServerReadyStateChange)i.onServerReadyStateChange(r,n,t.readyState);if(i.onSuccess&&t.readyState==4&&t.status==200)i.onSuccess(r,n,t.responseText)};t.open("post.html",i.postUrl,!0);n.getAsBinary?(s=f+u+r+'Content-Disposition: form-data;name="'+i.name+'";filename="'+unescape(encodeURIComponent(n.name))+'"'+r+"Content-Type: application/octet-stream"+r+r+n.getAsBinary()+r+f+u+f,t.setRequestHeader("Content-Type","multipart/form-data;boundary="+u),t.sendAsBinary(s)):window.FormData&&(o=new FormData,o.append(i.name,n),t.send(o))}var r="\r\n",u="iloveigloo",f="--",i={name:"uploadedFile",postUrl:"Upload.aspx",onClientAbort:null,onClientError:null,onClientLoad:null,onClientLoadEnd:null,onClientLoadStart:null,onClientProgress:null,onServerAbort:null,onServerError:null,onServerLoad:null,onServerLoadStart:null,onServerProgress:null,onServerReadyStateChange:null,onSuccess:null};return t&&n.extend(i,t),this.each(function(){var t=n(this);t.is('[type="file"]')?t.bind("change",function(){for(var t=this.files,n=0;n<t.length;n++)e(t[n])}):t.bind("dragenter dragover",function(){return!1}).bind("drop",function(n){for(var i=n.originalEvent.dataTransfer.files,t=0;t<i.length;t++)e(i[t]);return!1})})}}(jQuery);jQuery.fn.center=function(){return this.css("position","fixed"),this.css("top","200px"),this.css("left",Math.max(0,($(window).width()-$(this).outerWidth())/2+$(window).scrollLeft())+"px"),this};String.prototype.replaceAll=function(n,t){var i=this;return i.split(n).join(t)};var chat_enabled=!0,connecting=!1,FADE_TIME=150,CHAT_LOAT_INVITE_TIME=3e4,TYPING_TIMER_LENGTH=400,isOutOfWork=0,isautochat=0,isadmininvite=0,isloadcommnet=0,invitetime=90,CHAT_ENABLED=1,CHAT_INVITE=1,CHAT_ISMOBILE=0,welcome_msg="",CHAT_BOT=0,CHAT_BOT_RND=0,isInitUi=0,isInviteChat=0,CHAT_SOURCE="",CHAT_IN_CMT=!1,CHAT_TOP=0,CHAT_LEFT=0,CHAT_WIDTH=0,g_ostype=1,g_cateid=0,g_productid=0,g_productprice=0,g_categoryname="",g_groupcategoryname="",g_manuid=0,supporter,supportername="QTV",intervalPingPong,username,address,phone,email,gender,room,adid,userType="u",Customername,ad_name,ad_avatar,theOpposite,theAdmin,intervalRefresh,connected=!1,typing=!1,lastTypingTime,myskid,isAdmin=0,ismininvitechat=0,isMinimizing=0,unreadCount=0,tmoOnlineSupporter,chatSiteTitle="",$chatCDN="",$avatarCDN="",nodeJsServer="",sitename="DienMayXanh",sitedomain="dienmayxanh.com",sitechaturl="https://www.dienmayxanh.com/chat",CHAT_TPL={},CMD_CHAT_REQUEST="chat requesttgdd",CMD_CHAT_ONLINESUPPORTER="chat onlinesupporterall2018",CHAT_SITEID=0,CHAT_DANHXUNG="bạn",CHAT_DANHXUNG_HOA="Bạn",CHAT_TPL_CLASS="",CHAT_CDNV="v201901000046",CHAT_TESTTYPE=0,CHAT_ISCHATING=0,CHAT_ISCONNECTED=!1,cookie_info="chat.info";"undefined"!=typeof CHAT_GL_TESTTYPE&&(CHAT_TESTTYPE=CHAT_GL_TESTTYPE);"undefined"!=typeof CHAT_GL_CHATBOT_RND&&(CHAT_BOT_RND=CHAT_GL_CHATBOT_RND);"undefined"!=typeof CHAT_GL_CHATBOT&&(CHAT_BOT=CHAT_GL_CHATBOT);"undefined"!=typeof CHAT_GL_SITE&&(CHAT_SITEID=CHAT_GL_SITE);CHAT_SITEID==0&&(location.href.indexOf("www.dienmayxanh.com")>=0&&(CHAT_SITEID=2),location.href.indexOf("www.vuivui.com")>=0&&(CHAT_SITEID=8),location.href.indexOf("www.thegioididong.com")>=0&&(CHAT_SITEID=1),location.href.indexOf("www.nhathuocankhang.com")>=0&&(CHAT_SITEID=10),location.href.indexOf("www.bachoaxanh.com")>=0&&(CHAT_SITEID=11));"undefined"!=typeof CHAT_GL_INVITE&&(CHAT_INVITE=CHAT_GL_INVITE);"undefined"!=typeof CHAT_GL_ENABLED&&(CHAT_ENABLED=CHAT_GL_ENABLED);cdnChatUrl="https://cdn.thegioididong.com/";CHAT_SITEID==1&&(CHAT_TPL_CLASS="chattgdd",nodeJsServer="https://rtm.thegioididong.com/",sitechaturl="chat.html",$chatCDN=""+cdnChatUrl+"/dmxchat",$avatarCDN=""+cdnChatUrl+"/dmxchat/avatar",sitename="TheGioiDiDong",sitedomain="thegioididong.com",siteurldomain="www.thegioididong.com",siteshorturldomain="thegioididong.com",CMD_CHAT_REQUEST="chat requestall",CHAT_LOAT_INVITE_TIME=1e4,CHAT_BOT_RND==0&&(CHAT_BOT_RND=getRandomInt5()));CHAT_SITEID==2&&(CHAT_TPL_CLASS="chatdmx",sitechaturl="https://www.dienmayxanh.com/chat",nodeJsServer="https://rtm.thegioididong.com/",$chatCDN=""+cdnChatUrl+"/dmxchat",$avatarCDN=""+cdnChatUrl+"/dmxchat/avatar",sitename="DienMayXanh",sitedomain="dienmayxanh.com",siteurldomain="www.dienmayxanh.com",siteshorturldomain="dienmayxanh.com",CMD_CHAT_REQUEST="chat requestall",CHAT_LOAT_INVITE_TIME=1e4);CHAT_SITEID==10&&(CHAT_TPL_CLASS="chatdmx",sitechaturl="https://www.nhathuocankhang.com/chat",nodeJsServer="https://rtm.thegioididong.com/",$chatCDN=""+cdnChatUrl+"/dmxchat",$avatarCDN=""+cdnChatUrl+"/dmxchat/avatar",sitename="DienMayXanh",sitedomain="nhathuocankhang.com",siteurldomain="www.nhathuocankhang.com",siteshorturldomain="nhathuocankhang.com",CMD_CHAT_REQUEST="chat requestall",CHAT_LOAT_INVITE_TIME=1e4);CHAT_SITEID==8&&(CHAT_TPL_CLASS="chatvuivui",sitechaturl="https://www.vuivui.com/chat",nodeJsServer="https://rtm.vuivui.com/",$chatCDN=""+cdnChatUrl+"/dmxchat",$avatarCDN=""+cdnChatUrl+"/dmxchat/avatar",sitename="VuiVui",sitedomain="vuivui.com",siteurldomain="www.vuivui.com",siteshorturldomain="vuivui.com",CMD_CHAT_REQUEST="chat requestall",CHAT_LOAT_INVITE_TIME=1e4,CHAT_BOT=0,CHAT_BOT_RND==0&&(CHAT_BOT_RND=getRandomInt5()));CHAT_SITEID==11&&(CHAT_TPL_CLASS="chatbhx",sitechaturl="https://www.bachhoaxanh.com/chat",nodeJsServer="https://rtm.thegioididong.com/",$chatCDN=""+cdnChatUrl+"/dmxchat",$avatarCDN=""+cdnChatUrl+"/dmxchat/avatar",sitename="BachHoaXanh",sitedomain="bachhoaxanh.com",siteurldomain="www.bachhoaxanh.com",siteshorturldomain="bachhoaxanh.com",CMD_CHAT_REQUEST="chat requestall",CHAT_LOAT_INVITE_TIME=1e4,CHAT_BOT=0);CHAT_TESTTYPE==1&&($chatCDN="http://localdienmay.com/chat/resx",nodeJsServer="ws://localhost:8889",sitechaturl="http://localdienmay.com/chat",sitedomain="localdienmay.com",CHAT_LOAT_INVITE_TIME=5e3,CHAT_BOT=0);CHAT_TESTTYPE==2&&($chatCDN="http://beta.thegioididong.com/chat/resx",$avatarCDN=""+cdnChatUrl+"/dmxchat/avatar",sitechaturl="http://beta.thegioididong.com/chat",CHAT_LOAT_INVITE_TIME=5e3);CHAT_TESTTYPE==3&&($chatCDN="http://test.thegioididong.com/chat/resx",$avatarCDN=""+cdnChatUrl+"/dmxchat/avatar",sitechaturl="http://test.thegioididong.com/chat",CHAT_LOAT_INVITE_TIME=5e3);CHAT_TESTTYPE==1||CHAT_TESTTYPE==3?$("head").append('<link  rel="stylesheet" type="text/css" href="'+$chatCDN+"/chatcore2017.css?t="+CHAT_CDNV+'" />'):CHAT_TESTTYPE==2?$("head").append('<link  rel="stylesheet" type="text/css" href="'+$chatCDN+"/chatcore2017.css?t="+CHAT_CDNV+'" />'):$("head").append('<link  rel="stylesheet" type="text/css" href="'+cdnChatUrl+"/dmxchat/chatcore2017"+getExtcdnfilename(".css")+'" />');chat_dialog_cmt='  <div id="chatclientcmt" ><div class="navbar navbar-inverse navbar-fixed-bottom '+CHAT_TPL_CLASS+'"  ><div id="divmsg"><\/div><ul class="pages"><li class="chat page"> <div class="operator-info"  ><\/div><div class="chatArea"><form  onsubmit="return false;"><div id="collectdata"><\/div><\/form><form  onsubmit="return false;"><div id="chatcloseconfirm"> xxx<\/div><\/form><div id="chatrating">Cảm ơn bạn đã sử dụng dịch vụ của TGDD.<br /> <\/div> <ul class="messages"><\/ul><\/div><div class="chatwait"   id="chatwait"  style="  height: 22px;   " ><\/div><div class="chatinputarea"><form  onsubmit="return false;"><table style="width:100%;padding:0px;margin:0px"><tr> <td> <textarea   class="chatinput fe" placeholder="Nhập nội dung '+CHAT_DANHXUNG+' muốn gửi và nhấn Gửi"><\/textarea><\/td><td style="width: 50px; "><button id="sendchatcmt" class="chatfunctions-sendchat"     >Gửi<\/button> <\/td><\/tr><\/table><\/form>  <\/div><\/li><\/ul><\/div> <\/div>';schatcmt=' <div id="chatclientcmt">';schatcmt=schatcmt+' <div class="navbar navbar-inverse navbar-fixed-bottom '+CHAT_TPL_CLASS+' ">';schatcmt=schatcmt+'    <div id="divmsg"><\/div>';schatcmt=schatcmt+' <ul class="pages">';schatcmt=schatcmt+'     <li class="pagechat chat page">';schatcmt=schatcmt+'    <div class="operator-info"><\/div>';schatcmt=schatcmt+'    <div class="chatArea"> ';schatcmt=schatcmt+'      <div id="chatrating">Cảm ơn bạn đã sử dụng dịch vụ của TGDD.<br /> <\/div>';schatcmt=schatcmt+'      <ul class="messages"><\/ul>';schatcmt=schatcmt+"   <\/div>";schatcmt=schatcmt+'   <div class="chatwait" id="chatwait" style=" height 22px; "><\/div>';schatcmt=schatcmt+'   <div class="chatinputarea">';schatcmt=schatcmt+'    <form onsubmit="return false;">';schatcmt=schatcmt+'    <table style="width:100%;padding:0px;margin:0px">';schatcmt=schatcmt+" <tr>";schatcmt=schatcmt+" <td>";schatcmt=schatcmt+'     <textarea class="chatinput fe" placeholder="Nhập nội dung muốn gửi và nhấn Gửi"><\/textarea>';schatcmt=schatcmt+"  <\/td>";schatcmt=schatcmt+'  <td style="width: 50px; ">';schatcmt=schatcmt+'       <button id="sendchatcmt" class="chatfunctions-sendchat">Gửi<\/button>';schatcmt=schatcmt+"    <\/td>";schatcmt=schatcmt+"  <\/tr>";schatcmt=schatcmt+"  <\/table>";schatcmt=schatcmt+"   <\/form>";schatcmt=schatcmt+"  <\/div>";schatcmt=schatcmt+"<\/li>";schatcmt=schatcmt+'  <li class="pageclose chat page"> ';schatcmt=schatcmt+'     <div class="operator-info"><\/div>   <form onsubmit="return false;"><div id="chatcloseconfirm"> xxx<\/div><\/form>';schatcmt=schatcmt+"    <\/li>";schatcmt=schatcmt+"   <\/ul>";schatcmt=schatcmt+" <\/div>";schatcmt=schatcmt+"<\/div>";chat_dialog_cmt=schatcmt;var popup_dialog='<div class="modal fade" id="myModal" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true"><div class="modal-dialog"><div class="modal-content"><div class="modal-header"><button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;<\/span><\/button><h4 class="modal-title" id="myModalLabel">Bình luận của bạn đã được trả lời<\/h4><\/div><div class="modal-body" id="chat-invite-body">{%content%}<\/div><div class="modal-footer"><button type="button" class="btn btn-default" data-dismiss="modal">Đóng lại<\/button><button type="button" class="btn btn-primary" id="review_answer">Xem lại trả lời<\/button><button type="button" class="btn btn-primary" data-dismiss="modal" onclick="acceptChat()" id="chat_with_admin">Chat ngay với QTV<\/button><\/div><\/div><\/div><\/div>',chat_dialogold='<div style="clear:both;"/><div id="chatclient-back"><\/div>  <div id="chatclient" ><div class="navbar navbar-inverse navbar-fixed-bottom '+CHAT_TPL_CLASS+'"  ><div id="divmsg"><\/div><ul class="pages"><li class="chat page"> <div class="operator-info"  ><\/div><div class="chatArea"><form  onsubmit="return false;"><div id="collectdata"><\/div><\/form><form  onsubmit="return false;"><div id="chatcloseconfirm"> xxx<\/div><\/form><div id="chatrating">Cảm ơn bạn đã sử dụng dịch vụ của TGDD.<br /> <\/div> <ul class="messages"><\/ul><\/div><div class="chatwait"   id="chatwait"  style="  height: 22px;   " ><\/div><div class="chatinputarea"><form  onsubmit="return false;"><table style="width:100%;padding:0px;margin:0px"><tr><td style="width: 42px; "  >  <input id="upload-image" type="file" multiple class="upload-image" itemid="0"  title="Chèn ảnh kích thước tối đa 1MB/hình" name="file" /><img id="insertimage" class="chatfunctions-insertimg"  src="'+$chatCDN+"/chenhinh_tgdd"+getExtcdnfilename(".png")+'" >  <\/td><td> <textarea   class="chatinput fe" placeholder="Nhập nội dung '+CHAT_DANHXUNG+' muốn gửi và nhấn Gửi"><\/textarea><\/td><td style="width: 50px; "><button id="sendchat" class="chatfunctions-sendchat"     >Gửi<\/button> <\/td><\/tr><\/table><\/form>  <\/div><\/li><\/ul><\/div><div id="chattooltipmsg"   class="minimize" onclick="maximizeChatWindow()"><div style="position: relative;"><div class="msgalert">!<\/div><div style="z-index: -1;top: 2px;width: 216px;right:60px;height: 45px;display: none;" id="tooltip349481" class="tooltip fade left in" role="tooltip"> <div class="tooltip-inner"><\/div><\/div><div class="operator-info-min"><\/div><\/div><\/div><\/div>',schatdl='<div style="clear:both;" /><div id="chatclient-back"><\/div>';schatdl=schatdl+'<div id="chatclient">';schatdl=schatdl+' <div class="navbar navbar-inverse navbar-fixed-bottom '+CHAT_TPL_CLASS+'">';schatdl=schatdl+'    <div id="divmsg"><\/div>';schatdl=schatdl+'  <ul class="pages">';schatdl=schatdl+'    <li class="pagechat chat page">';schatdl=schatdl+'  <div class="operator-info"><\/div>';schatdl=schatdl+'  <div class="chatArea">';schatdl=schatdl+'        <div id="chatrating">Cảm ơn bạn đã sử dụng dịch vụ của TGDD.<br /> <\/div>';schatdl=schatdl+'            <ul class="messages"><\/ul>';schatdl=schatdl+"       <\/div>";schatdl=schatdl+'  <div class="chatwait" id="chatwait" style=" height 22px; "><\/div>';schatdl=schatdl+'   <div class="chatinputarea">';schatdl=schatdl+'       <form onsubmit="return false;">';schatdl=schatdl+'            <table style="width:100%;padding:0px;margin:0px">';schatdl=schatdl+"            <tr>";schatdl=schatdl+'  <td style="width: 42px; ">';schatdl=schatdl+'        <input id="upload-image" type="file" multiple class="upload-image" itemid="0" title="Chèn ảnh kích thước tối đa 1MB/hình" name="file" /><img id="insertimage" class="chatfunctions-insertimg" src="'+$chatCDN+"/chenhinh_tgdd"+getExtcdnfilename(".png")+'">';schatdl=schatdl+"   <\/td>";schatdl=schatdl+" <td>";schatdl=schatdl+'  <textarea class="chatinput fe" placeholder="Nhập nội dung '+CHAT_DANHXUNG+' muốn gửi và nhấn Gửi"><\/textarea>';schatdl=schatdl+"  <\/td>";schatdl=schatdl+'  <td style="width: 50px; "><button id="sendchat" class="chatfunctions-sendchat">Gửi<\/button> <\/td>';schatdl=schatdl+" <\/tr>";schatdl=schatdl+"    <\/table>";schatdl=schatdl+"    <\/form>";schatdl=schatdl+"  <\/div>";schatdl=schatdl+" <\/li>";schatdl=schatdl+'  <li class="pagecollect page">';schatdl=schatdl+'   <div class="operator-info"><\/div> <form onsubmit="return false;"><div id="collectdata"><\/div><\/form>';schatdl=schatdl+"  <\/li>";schatdl=schatdl+'   <li class="pageclose  page">';schatdl=schatdl+'   <div class="operator-info"><\/div>   <form onsubmit="return false;"><div id="chatcloseconfirm"> xxx<\/div><\/form>';schatdl=schatdl+"  <\/li>";schatdl=schatdl+"   <\/ul>";schatdl=schatdl+' <\/div><div id="chattooltipmsg" class="minimize" onclick="maximizeChatWindow()">';schatdl=schatdl+' <div style="position: relative;">';schatdl=schatdl+'    <div class="msgalert">!<\/div>';schatdl=schatdl+'     <div style="z-index: -1;top: 2px;width: 216px;right:60px;height: 45px;display: none;" id="tooltip349481" class="tooltip fade left in" role="tooltip"> <div class="tooltip-inner"><\/div><\/div>';schatdl=schatdl+'        <div class="operator-info-min"><\/div>';schatdl=schatdl+"      <\/div>";schatdl=schatdl+"    <\/div>";schatdl=schatdl+"<\/div>";var chat_dialog=schatdl,fullslot1='<div id="chat_fullslot">Hiện tại tất cả Tư vấn viên đều đang bận. <br />Nếu '+CHAT_DANHXUNG+" cần tư vấn ngay, vui lòng để lại tên và số điện thoại, chúng tôi sẽ hỗ trợ bằng cách gọi cho "+CHAT_DANHXUNG+'.<div><input type="text" id="chat_callme_fullname" name="chat_callme_fullname" placeholder="Vui lòng nhập tên" /><\/div><div><input type="text" id="chat_callme_phone" name="chat_callme_phone" placeholder="Vui lòng nhập số điện thoại" /><\/div><div><input type="button" value="Gọi cho tôi" onclick="SendCallMeInfo()" /><\/div><\/div>',fullslot='<div id="chat_fullslot">Hiện tại tất cả Tư vấn viên đều đang bận. <br />'+CHAT_DANHXUNG+" vui lòng chờ trong ít phút.<\/div>",fullslotOutOfWork='<div id="chat_fullslot">Cảm ơn '+CHAT_DANHXUNG+' đã quan tâm đến mục "Tư vấn" của '+sitename+". Hệ thống phục vụ từ 7 giờ đến 22 giờ, kính mong "+CHAT_DANHXUNG+" quay lại vào thời gian trên để được phục vụ tốt nhất.<br /> Trân trọng!<\/div>",collecthtml=' <div class="collectsub"> <p>Mời '+CHAT_DANHXUNG+' nhập số điện thoại để chúng tôi hỗ trợ tốt hơn<\/p> <div><select id="txtchat_gender" name="txtchat_gender"><option value="">Giới tính<\/option><option value="1">Anh<\/option> <option  value="2">Chị<\/option><\/select><input type="text" id="txtchat_fullname" name="txtchat_fullname" placeholder="Tên của '+CHAT_DANHXUNG+'" />  <\/div> <div class="valifullname"><\/div>   <div>  <input type="text" id="txtchat_phone" name="txtchat_phone" placeholder="Số điện thoại (bắt buộc)" onkeypress="return numbersOnly(this, event);" maxlength="11"/>  <\/div><div class="valiphone"><\/div> <div style="display:">  <input type="text" id="txtchat_email" name="txtchat_email" placeholder="Email (không bắt buộc)" />  <\/div> <div class="valiemail"><\/div><div id="inimsg"><\/div>   <div> <div class="startbutton" value="" onclick="iniChat()" ><span>Bắt đầu Chat<\/span><p style="display:none">Lời mời chat còn hiệu lực trong <span id="invitetime"><\/span> giây<\/p><\/div><\/div><div><span style="color:#9d9d9d">Cam kết bảo mật thông tin<\/span><\/div><\/div> ',notifychatmsg='<div  id="notifychatmsg" class="'+CHAT_TPL_CLASS+'"> <\/div> ',notifychatmsgmin='<div  id="notifychatmsgmin"> <\/div> ',notifychatnewmsg='<div  id="notifychatnewmsg"> <\/div> ',chatclientbackfull='<div id="chatclient-backfull"><\/div> ',auhtmlinvitechat='<div class="notifyChat2  "   ><a   href="javascript:void(0)" onclick="requestChatAuto(\'\');"><img class="notifyChat2img" src="'+$chatCDN+"/iconinvitechat_"+CHAT_SITEID+""+getExtcdnfilename(".png")+'"><\/a><a class="btnRqChat"  href="javascript:void(0)" onclick="requestChatAuto(\'\');">Hỗ trợ online<\/a><\/div><\/div>';CHAT_SITEID==8&&(auhtmlinvitechat='<div class="notifyChat2  "  style="width: 105px;" ><a   href="javascript:void(0)" onclick="requestChatAuto(\'\');"><img class="notifyChat2img" src="'+$chatCDN+"/iconinvitechat_"+CHAT_SITEID+""+getExtcdnfilename(".png")+'"><\/a><a class="btnRqChat"  style="width: 59px;" href="javascript:void(0)" onclick="requestChatAuto(\'\');">Chat với tư vấn viên<\/a><\/div><\/div>');var auhtmlinvitechatmini='<div class="notifyChat2  "   ><a class="btnRqChat"   href="javascript:void(0)" onclick="requestChatAuto(\'\');"><img  class="notifyChat2img" src="'+$chatCDN+"/iconchatdmx"+getExtcdnfilename(".png")+'"><\/a><\/div><\/div>',socket=io(nodeJsServer,{transports:["websocket"],path:"/socket.io",timeout:1e4,reconnectionAttempts:"Infinity"}),chat_commentid=0,$window=$(window),$messages,$messagescomment,$inputMessage,$minimizePage,$chatPage,$messagescmt,$messagescommentcmt,$inputMessagecmt,$minimizePagecmt,$chatPagecmt,lastmgsuser=0;$(function(){resizeChat()});runTimmer=0;CHAT_ISSETMYID=!1;var connectcount=1,CMD_CHATCONNECTING="",CMD_CHATCONNECTING_DATA="",CMD_CHATCONNECTING_RUNING=0;reISO=/^(\d{4})-(\d{2})-(\d{2})T(\d{2}):(\d{2}):(\d{2}(?:\.\d*))(?:Z|(\+|-)([\d|:]*))?$/;reMsAjax=/^\/Date\((d|-|.*)\)[\/|\\]$/;iseditinfo=0;$widget_pattern="<div class='product_widget'><a target=_blank href='{$url}'><div class='product_widget_img'>{$img}<\/div><div class='product_widget_info'><p class='product_widget_link'>{$title}<\/p><p class='product_widget_desc'>{$desc}<\/p><p class='product_widget_sitename'>{$site}<\/p><\/div><\/a><\/div>";$widget_pattern_img="<div class='product_widget'> <p class='product_widget_imgonly'>{$img}<\/p> <\/div>";socket.on("login",function(){connected=!0});socket.on("chat error",function(n){if(n){enablechat(0);var t="";n.code==1&&(t="Bạn chưa nhập đủ thông tin chat như Tên, Phone");n.code==2&&(t="Tư vấn viên đang bận, xin thử lại sau");n.code==3&&(t="Tư vấn viên này hiện không oline, xin thử lại sau");shochatwmsg(1,"<span>Lỗi:"+t+"<\/span>")}});socket.on("chat ping",function(){socket.emit("chat pong",{rid:username,siteid:CHAT_SITEID,url:window.location.href})});socket.on("new message",function(n){enablechatinput();$("#chatclient .operator-info .operator-name").length<=0&&socket.emit("chat getinfo",{username:supporter});connecting=0;addChatMessage(n);isMinimizing==1&&(unreadCount++,chatSetCookie("chat.unread",unreadCount,365,"."+sitedomain));$(".msgalert").show();$(".msgalert").html("<span>"+unreadCount+"<\/span>");$("#chatclient .chatinputarea .chatmsg").hide();isadmininvite==1&&isMinimizing!=1&&$("#chatclient .navbar").show();shochatwmsg(0,"");changeTitlePage("QTV "+supportername+" đã trả lời cho bạn");socket.emit("message ack",{username:username,rid:n.roomId,msgid:n.msgid})});socket.on("message ack",function(n){n.username!=username});socket.on("user left",function(n){removeChatTyping(n);$inputMessage[0].disabled=!0;$inputMessage.attr("disabled","disabled");shochatwmsg(1,'<span style="color:red"><\/span>');setTimeout(function(){CHAT_ISCHATING==1&&CHAT_ISCONNECTED==!1&&ChatConnecting("chat register",{isbotrnd:CHAT_BOT_RND,isbot:CHAT_BOT,cmtid:chat_commentid,siteid:CHAT_SITEID,phone:phone,email:email,usr:username,fnm:Customername,url:window.location.href,tid:userType,aid:supporter})},1e4)});socket.on("chat disconnect",function(){enablechat(0);shochatwmsg(1,'<span style="color:red"><\/span>');setTimeout(function(){CHAT_ISCHATING==1&&CHAT_ISCONNECTED==!1&&ChatConnecting("chat register",{isbotrnd:CHAT_BOT_RND,isbot:CHAT_BOT,cmtid:chat_commentid,siteid:CHAT_SITEID,phone:phone,email:email,usr:username,fnm:Customername,url:window.location.href,tid:userType,aid:supporter})},1e4)});socket.on("chat getinfo",function(n){LoadUserInfo();empty(Customername)||$("#txtchat_fullname").val(Customername);loadTitleChatInfoToUI(n)});socket.on("chat adminoffline",function(){enablechat(0);CHAT_ISCHATING==1?ChatConnecting("chat register",{isbotrnd:CHAT_BOT_RND,isbot:CHAT_BOT,catid:g_cateid,cmtid:chat_commentid,siteid:CHAT_SITEID,phone:phone,email:email,usr:username,fnm:Customername,gender:gender,url:window.location.href,tid:userType,aid:supporter}):ChatConnecting(CMD_CHAT_REQUEST,{isbotrnd:CHAT_BOT_RND,isbot:CHAT_BOT,catid:g_cateid,cmtid:chat_commentid,siteid:CHAT_SITEID,phone:phone,email:email,usr:username,fnm:Customername,gender:gender,url:window.location.href,tid:userType,aid:supporter})});socket.on("chat ok2",function(){showchatpage("chat");isInviteChat=0});socket.on("chat ok",function(){showchatpage("chat");isInviteChat=0});socket.on("admin left",function(){});socket.on("typing",function(n){addChatTyping(n)});socket.on("stop typing",function(n){removeChatTyping(n)});socket.on("stop chat",function(n){userLeftChat(n,theOpposite)});socket.on("selfstop chat",function(){$("#chatclient .navbar").hide()});socket.on("chat userinfo",function(n){n.usr!=username&&setInitialData(n)});socket.on("chat setadmininfo",function(n){n.usr!=username&&(setInitialData(n),n.message&&addChatMessage({username:n.username,message:"<em class='stop'>"+n.message+"<\/em>",fullname:theOpposite}))});socket.on("chat changeinfo",function(n){n&&(SaveCookieUserInfo(n.fnm,n.email,n.phone,n.gender),Customername=n.fnm,phone=n.phone,gender=n.gender,chatRecheckInfo(Customername,phone),addChatInfoMessage())});socket.on("invite chat",function(n){isadmininvite=1;LoadUserInfo();chatRecheckInfo(Customername,phone);empty(Customername)&&SaveCookieUserInfo("Khách","","",3);setInitialData(n);adid=n.tid;CHAT_ISCHATING=1;setcoookieChating(CHAT_ISCHATING);prepairInitialData();socket.emit("accept chat",{usr:username,fnm:Customername,rid:room,tid:userType,aid:adid});refreshTimeAgo();connected=!0;showchatpage("chat");requestChatInvite(adid)});socket.on("greeting",function(n){addChatMessage(n)});socket.on("chat connected",function(n){var i,t;(CHAT_ISCONNECTED=!0,connected=!0,myskid=n,prepairInitialData(),"undefined"!=typeof showMySocketId&&showMySocketId(n,username),chat_enabled)&&(("undefined"!=typeof isMobile&&isMobile==!0&&(g_ostype=2),LoadUserInfo(),i=chatGetCookie("chat.username"),i&&i.indexOf("@")>=0&&CHAT_BOT==0)||(t=chatGetCookie("chat.chating"),CHAT_ISCHATING=t==null||t==undefined?-1:t,setcoookieChating(CHAT_ISCHATING),console.log("chat connected"),CHAT_ISCHATING>0?socket.emit("chat register",{ischating:CHAT_ISCHATING,isbotrnd:CHAT_BOT_RND,isbot:CHAT_BOT,ostype:g_ostype,cmtid:chat_commentid,isauto:1,siteid:CHAT_SITEID,phone:phone,email:email,usr:username,fnm:Customername,url:window.location.href}):socket.emit("chat registermin",{ischating:CHAT_ISCHATING,isbotrnd:CHAT_BOT_RND,isbot:CHAT_BOT,ostype:g_ostype,cmtid:chat_commentid,isauto:1,siteid:CHAT_SITEID,phone:phone,email:email,usr:username,fnm:Customername,url:window.location.href})))});socket.on("admin joined",function(n){var t;CHAT_ISCONNECTED=!0;connecting=!1;enablechat(1);shochatwmsg(0,"");connected=!0;adid=n.tid;CHAT_ISCHATING=1;setcoookieChating(CHAT_ISCHATING);supporter=n.usr;supportername=n.fnm;CHAT_IN_CMT==1?showchatpagecmt("chat"):showchatpage("chat");setInitialData(n);empty(welcome_msg)||(t="chatmsg_"+(new Date).getTime(),addChatMessage({username:username,fullname:Customername,message:welcome_msg,sentAt:(new Date).getTime(),msgid:t}),socket.emit("new message",{msgid:t,isbotrnd:CHAT_BOT_RND,isbot:CHAT_BOT,msg:welcome_msg,tid:userType,fnm:Customername,curl:location.href}),welcome_msg="");empty(n.message)||(t="chatmsg_"+(new Date).getTime(),addChatMessage({username:n.usr,fullname:n.fnm,message:n.message,sentAt:(new Date).getTime(),msgid:t}))});socket.on("continue chat",function(n){if(CHAT_ISCONNECTED=!0,connecting=!1,CHAT_IN_CMT==1?showchatpagecmt("chat"):showchatpage("chat"),shochatwmsg(0,""),enablechat(1),LoadUserInfo(),chatRecheckInfo(Customername,phone),runTimmer=0,CHAT_ISCHATING=1,setcoookieChating(CHAT_ISCHATING),empty(Customername)){ChatStopAll();return}supporter=n.opposite.usr;CHAT_BOT=supporter=="chatbot1"||supporter=="chatbot2"||supporter=="chatbot8"?1:0;connected=!0;setUsername();theOpposite=n.opposite.fnm;$messages.empty();chat_commentid=n.user.cmtid;getMessageComment();for(var t in n.msgs)addChatMessage(JSON.parse(n.msgs[t]));addChatInfoMessage();refreshTimeAgo();socket.emit("chat reconnect",n.user);socket.emit("chat getinfo",{username:supporter});isMinimizing==1&&(minizeChatWindow(),unreadCount>0&&($(".msgalert").show(),$(".msgalert").html("<span>"+unreadCount+"<\/span>")));resizeChatCode()});socket.on("connect_error",function(){console.log("Failed to connect to server");CHAT_ISCONNECTED=!1;enablechat(0)});socket.on("disconnect",function(){CHAT_ISCONNECTED=!1;enablechat(0)});socket.on("chat reconnect",function(){shochatwmsg(0,"");CHAT_ISCHATING=1;setcoookieChating(CHAT_ISCHATING);CHAT_ISCONNECTED=!0;enablechat(1);console.log("chat reconnect")});socket.on("chat status",function(n){socket.emit("chat statusreply",n)});socket.on("chat recheckinvite",function(n){var i,r,t,u;n.code==1?(i=n.user,i&&i.InviteObject&&(r="",r=i.InviteObject.avatar?$avatarCDN+"/"+i.InviteObject.avatar:$avatarCDN+"/nopic.png",t='<div class="notifyChat"><img src="{avatar}"><div class="ctNotify"><p>'+CHAT_DANHXUNG_HOA+' có muốn chat với Tư Vấn Bán Hàng {name} để được hỗ trợ ngay không?<\/p><a class="btnRqChat" href="javascript:void(0)" onclick="requestChat(\'{username}\', \'{commentid}\');">CHAT NGAY<\/a><a class="seeCmt" href="javascript:void(0)" onclick="HideInviteChat();">Không, cảm ơn<\/a><\/div><\/div>',t=t.replace("{username}",i.InviteObject.ctvusername),t=t.replace("{name}",i.InviteObject.ctvname),t=t.replace("{avatar}",r),t=t.replace("{commentid}",i.InviteObject.commentid),$("#notifychatmsg").show(),$("#notifychatmsg").html(t),$("#notifychatmsg").focus(),u=Math.floor((new Date-i.InviteAt)/1e3),runTimmer=1,startTimer(90-u),invitetime=u)):invitetime=0});socket.on("chat reset",function(){chatSetCookie("chat.username","",-1,"www."+sitedomain);chatSetCookie("chat.username","",-1,"."+sitedomain);chatSetCookie("chat.username","",-1,"rtm."+sitedomain)});socket.on("chat deny",function(){CHAT_ISCONNECTED=!1;shochatwmsg(1,"Bạn đang chat với Tư vấn viên !");enablechat(0)});socket.on("chat waiting",function(){checkvisible("#chatclient .messages")&&shochatwmsg(1,"<span>"+getGender(gender)+" "+Customername+" vui lòng đợi trong giây lát...<\/span>")});socket.on("connect",function(){CHAT_SITEID==8&&"undefined"!=typeof GCH_ROOM&&(socket.emit("joingame",{room:GCH_ROOM,siteid:8}),console.log("joingame"));"undefined"!=typeof cmtroom&&(socket.emit("join",cmtroom),console.log("join="+cmtroom))});socket.on("gamenotify",function(n){try{console.log("Start display game");GameDisplayUI(n)}catch(t){}});socket.on("getalldata_gamegch",function(n){try{GetAllGameData(n)}catch(t){}});socket.on("rdata",function(n){chatshownotifycmt(n)});socket.on("chat admininvite",function(){isadmininvite=1});socket.on("chat onlinesupporter",function(n){var e,r,u,f;if(CHAT_BOT==1)ViewInviteChat(n);else{var o=(new Date).getHours(),t=0,s=n.isbusylist,i=n.list;if(!n.list)return;if(i&&i.length>0){e=[];r=[];for(u in i)f=i[u],r.push(f),t++}console.log("numCanChat="+t);typeof callbackchat!="undefined"&&typeof callbackchat=="function"&&callbackchat(t);t>0?ViewInviteChat(r):HideInviteChat()}getOnlineSupporterAuto("")});BE_GlobalNumBerCanChat=0;socket.on("chat onlinesupporter2018",function(n){var e,i,f,u;if(CHAT_BOT==1)ViewInviteChat(n);else{var o=(new Date).getHours(),t=0,s=n.isbusylist,r=n.list;if(!n.list)return;if(e=[],i=[],r&&r.length>0)for(f in r)u=r[f],u&&u.isbusy==!1&&(i.push(u),t++);if(BE_GlobalNumBerCanChat=t,console.log("numCanChat= "+t),typeof callbackchat!="undefined"&&typeof callbackchat=="function"&&callbackchat(t),CHAT_SITEID==8)if(typeof chathead=="function")try{chathead(i)}catch(h){}else t>0?ViewInviteChat(i):HideInviteChat();else t>0?ViewInviteChat(i):HideInviteChat()}getOnlineSupporterAuto("")});socket.on("connected-giut-co-hon",function(){console.log("connected-giut-co-hon")});socket.on("chat changechattoctv",function(n){if(console.log("chat changechattoctv",socket.id),n.name.length==0)return console.log("NameLoss"),!1;SetChatWithCTV(n)});(chatGetCookie("chat.username")==undefined||chatGetCookie("chat.username")==""||chatGetCookie("chat.username")=="undefined"||chatGetCookie("chat.username")=="undefine")&&deletecookiechat();setTimeout(function(){CheckIsAutoShowChat()},5e3);prepairUI();prepairUICMT();